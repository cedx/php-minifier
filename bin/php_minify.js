#!/usr/bin/env node
(function(ut){"use strict";var d=function(){return se.__string_rec(this,"")},T=T||{},u;class Oe{constructor(e,t){this.r=new RegExp(e,t.split("u").join(""))}match(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,this.r.m!=null}matched(e){if(this.r.m!=null&&e>=0&&e<this.r.m.length)return this.r.m[e];throw v.thrown("EReg::matched")}}Oe.__name__=!0;class F{static cca(e,t){let n=e.charCodeAt(t);if(n==n)return n}static substr(e,t,n){if(n==null)n=e.length;else if(n<0)if(t==0)n=e.length+n;else return"";return e.substr(t,n)}static now(){return Date.now()}}F.__name__=!0;class De{static fold(e,t,n){let r=nn(e);for(;r.hasNext();)n=t(r.next(),n);return n}static find(e,t){let n=nn(e);for(;n.hasNext();){let r=n.next();if(t(r))return r}return null}}De.__name__=!0,Math.__name__=!0;class U{static field(e,t){try{return e[t]}catch{return null}}static fields(e){let t=[];if(e!=null){let r=Object.prototype.hasOwnProperty;for(var n in e)n!="__id__"&&n!="hx__closures__"&&r.call(e,n)&&t.push(n)}return t}static compare(e,t){return e==t?0:e>t?1:-1}static isEnumValue(e){return e!=null?e.__enum__!=null:!1}static copy(e){if(e==null)return null;let t={},n=0,r=U.fields(e);for(;n<r.length;){let s=r[n];++n,t[s]=U.field(e,s)}return t}}U.__name__=!0;class B{static string(e){return se.__string_rec(e,"")}static parseInt(e){let t=parseInt(e);return isNaN(t)?null:t}static random(e){return e<=0?0:Math.floor(Math.random()*e)}}B.__name__=!0;class Ye{constructor(){this.b=""}}Ye.__name__=!0;class H{static isSpace(e,t){let n=F.cca(e,t);return n>8&&n<14?!0:n==32}static ltrim(e){let t=e.length,n=0;for(;n<t&&H.isSpace(e,n);)++n;return n>0?F.substr(e,n,t-n):e}static rtrim(e){let t=e.length,n=0;for(;n<t&&H.isSpace(e,t-n-1);)++n;return n>0?F.substr(e,0,t-n):e}static trim(e){return H.ltrim(H.rtrim(e))}static lpad(e,t,n){if(t.length<=0)return e;let r="";for(n-=e.length;r.length<n;)r+=t==null?"null":""+t;return r+=e==null?"null":""+e,r}static replace(e,t,n){return e.split(t).join(n)}}H.__name__=!0;class ct{static systemName(){let e=process.platform;switch(e){case"darwin":return"Mac";case"freebsd":return"BSD";case"linux":return"Linux";case"win32":return"Windows";default:return e}}}ct.__name__=!0;class $e{static enumParameters(e){let n=T[e.__enum__].__constructs__[e._hx_index].__params__;if(n!=null){let r=[],s=0;for(;s<n.length;){let l=n[s];++s,r.push(e[l])}return r}else return[]}}$e.__name__=!0;class Ge{static absolutePath(e){return C.isAbsolute(e)?e:C.join([process.cwd(),e])}}Ge.__name__=!0;class Ke{constructor(e,t){this.exitTrigger=new et,this.process=pt.spawn(e,t),this.stdin=we.wrap("stdin",this.process.stdin);let n=null;n={},this.stderr=J.wrap("stderr",this.process.stderr,n.chunkSize,n.onEnd);let r=null;r={},this.stdout=J.wrap("stdout",this.process.stdout,r.chunkSize,r.onEnd);let s=this;this.process.on("exit",function(l,i){s.exitTrigger.trigger(l)})}exitCode(){return this.exitTrigger}close(){}}Ke.__name__=!0;var be=T["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:d},Module:(u=function(a){return{_hx_index:1,m:a,__enum__:"haxe.StackItem",toString:d}},u._hx_name="Module",u.__params__=["m"],u),FilePos:(u=function(a,e,t,n){return{_hx_index:2,s:a,file:e,line:t,column:n,__enum__:"haxe.StackItem",toString:d}},u._hx_name="FilePos",u.__params__=["s","file","line","column"],u),Method:(u=function(a,e){return{_hx_index:3,classname:a,method:e,__enum__:"haxe.StackItem",toString:d}},u._hx_name="Method",u.__params__=["classname","method"],u),LocalFunction:(u=function(a){return{_hx_index:4,v:a,__enum__:"haxe.StackItem",toString:d}},u._hx_name="LocalFunction",u.__params__=["v"],u)};be.__constructs__=[be.CFunction,be.Module,be.FilePos,be.Method,be.LocalFunction];class v extends Error{constructor(e,t,n){super(e),this.message=e,this.__previousException=t,this.__nativeException=n??this}unwrap(){return this.__nativeException}get_native(){return this.__nativeException}static caught(e){return e instanceof v?e:e instanceof Error?new v(e.message,null,e):new Xe(e,null,e)}static thrown(e){return e instanceof v?e.get_native():e instanceof Error?e:new Xe(e)}}v.__name__=!0;class Ie{constructor(e){let t=this;this.id=setInterval(function(){t.run()},e)}stop(){this.id!=null&&(clearInterval(this.id),this.id=null)}run(){}static delay(e,t){let n=new Ie(t);return n.run=function(){n.stop(),e()},n}}Ie.__name__=!0;class Xe extends v{constructor(e,t,n){super(String(e),t,n),this.value=e}unwrap(){return this.value}}Xe.__name__=!0;class I{constructor(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}blit(e,t,n,r){if(e<0||n<0||r<0||e+r>this.length||n+r>t.length)throw v.thrown(re.OutsideBounds);n==0&&r==t.b.byteLength?this.b.set(t.b,e):this.b.set(t.b.subarray(n,n+r),e)}sub(e,t){if(e<0||t<0||e+t>this.length)throw v.thrown(re.OutsideBounds);return new I(this.b.buffer.slice(e+this.b.byteOffset,e+this.b.byteOffset+t))}getString(e,t,n){if(e<0||t<0||e+t>this.length)throw v.thrown(re.OutsideBounds);n==null&&(n=Pe.UTF8);let r="",s=this.b,l=e,i=e+t;switch(n._hx_index){case 0:for(;l<i;){let c=s[l++];if(c<128){if(c==0)break;r+=String.fromCodePoint(c)}else if(c<224){let _=(c&63)<<6|s[l++]&127;r+=String.fromCodePoint(_)}else if(c<240){let _=(c&31)<<12|(s[l++]&127)<<6|s[l++]&127;r+=String.fromCodePoint(_)}else{let _=(c&15)<<18|(s[l++]&127)<<12|(s[l++]&127)<<6|s[l++]&127;r+=String.fromCodePoint(_)}}break;case 1:for(;l<i;){let c=s[l++]|s[l++]<<8;r+=String.fromCodePoint(c)}break}return r}toString(){return this.getString(0,this.length)}static ofString(e,t){if(t==Pe.RawNative){let s=new Uint8Array(e.length<<1),l=0,i=e.length;for(;l<i;){let c=l++,_=e.charCodeAt(c);s[c<<1]=_&255,s[c<<1|1]=_>>8}return new I(s.buffer)}let n=[],r=0;for(;r<e.length;){let s=e.charCodeAt(r++);55296<=s&&s<=56319&&(s=s-55232<<10|e.charCodeAt(r++)&1023),s<=127?n.push(s):s<=2047?(n.push(192|s>>6),n.push(128|s&63)):s<=65535?(n.push(224|s>>12),n.push(128|s>>6&63),n.push(128|s&63)):(n.push(240|s>>18),n.push(128|s>>12&63),n.push(128|s>>6&63),n.push(128|s&63))}return new I(new Uint8Array(n).buffer)}static ofData(e){let t=e.hxBytes;return t??new I(e)}}I.__name__=!0;var Pe=T["haxe.io.Encoding"]={__ename__:!0,__constructs__:null,UTF8:{_hx_name:"UTF8",_hx_index:0,__enum__:"haxe.io.Encoding",toString:d},RawNative:{_hx_name:"RawNative",_hx_index:1,__enum__:"haxe.io.Encoding",toString:d}};Pe.__constructs__=[Pe.UTF8,Pe.RawNative];class _e{static encode(e,t){t==null&&(t=!0);let n=new _t(_e.BYTES).encodeBytes(e).toString();if(t)switch(e.length%3){case 1:n+="==";break;case 2:n+="=";break;default:}return n}}_e.__name__=!0;class _t{constructor(e){let t=e.length,n=1;for(;t>1<<n;)++n;if(n>8||t!=1<<n)throw v.thrown("BaseCode : base length must be a power of two.");this.base=e,this.nbits=n}encodeBytes(e){let t=this.nbits,n=this.base,r=e.length*8/t|0,s=new I(new ArrayBuffer(r+(e.length*8%t==0?0:1))),l=0,i=0,c=(1<<t)-1,_=0,h=0;for(;h<r;){for(;i<t;)i+=8,l<<=8,l|=e.b[_++];i-=t,s.b[h++]=n.b[l>>i&c]}return i>0&&(s.b[h++]=n.b[l<<t-i&c]),s}}_t.__name__=!0;class ot{constructor(){}set(e,t){this.root=this.setLoop(e,t,this.root)}get(e){let t=this.root;for(;t!=null;){let n=this.compare(e,t.key);if(n==0)return t.value;n<0?t=t.left:t=t.right}return null}exists(e){let t=this.root;for(;t!=null;){let n=this.compare(e,t.key);if(n==0)return!0;n<0?t=t.left:t=t.right}return!1}setLoop(e,t,n){if(n==null)return new j(null,e,t,null);let r=this.compare(e,n.key);if(r==0)return new j(n.left,e,t,n.right,n==null?0:n._height);if(r<0)return this.balance(this.setLoop(e,t,n.left),n.key,n.value,n.right);{let s=this.setLoop(e,t,n.right);return this.balance(n.left,n.key,n.value,s)}}balance(e,t,n,r){let s=e==null?0:e._height,l=r==null?0:r._height;if(s>l+2){let i=e.left,c=e.right;return(i==null?0:i._height)>=(c==null?0:c._height)?new j(e.left,e.key,e.value,new j(e.right,t,n,r)):new j(new j(e.left,e.key,e.value,e.right.left),e.right.key,e.right.value,new j(e.right.right,t,n,r))}else if(l>s+2){let i=r.right,c=r.left;return(i==null?0:i._height)>(c==null?0:c._height)?new j(new j(e,t,n,r.left),r.key,r.value,r.right):new j(new j(e,t,n,r.left.left),r.left.key,r.left.value,new j(r.left.right,r.key,r.value,r.right))}else return new j(e,t,n,r,(s>l?s:l)+1)}compare(e,t){return U.compare(e,t)}}ot.__name__=!0;class j{constructor(e,t,n,r,s){if(s==null&&(s=-1),this.left=e,this.key=t,this.value=n,this.right=r,s==-1){let l,i=this.left,c=this.right;if((i==null?0:i._height)>(c==null?0:c._height)){let _=this.left;l=_==null?0:_._height}else{let _=this.right;l=_==null?0:_._height}this._height=l+1}else this._height=s}}j.__name__=!0;class ht extends ot{constructor(){super()}compare(e,t){let n=e._hx_index-t._hx_index;if(n!=0)return n;let r=$e.enumParameters(e),s=$e.enumParameters(t);return r.length==0&&s.length==0?0:this.compareArgs(r,s)}compareArgs(e,t){let n=e.length-t.length;if(n!=0)return n;let r=0,s=e.length;for(;r<s;){let l=r++,i=this.compareArg(e[l],t[l]);if(i!=0)return i}return 0}compareArg(e,t){return U.isEnumValue(e)&&U.isEnumValue(t)?this.compare(e,t):e instanceof Array&&t instanceof Array?this.compareArgs(e,t):U.compare(e,t)}}ht.__name__=!0;var ne=T["haxe.ds.Option"]={__ename__:!0,__constructs__:null,Some:(u=function(a){return{_hx_index:0,v:a,__enum__:"haxe.ds.Option",toString:d}},u._hx_name="Some",u.__params__=["v"],u),None:{_hx_name:"None",_hx_index:1,__enum__:"haxe.ds.Option",toString:d}};ne.__constructs__=[ne.Some,ne.None];class ft{constructor(){this.h=Object.create(null)}}ft.__name__=!0;class dt{constructor(e){this.url=e,this.headers=[],this.params=[],this.emptyOnData=rn(this,this.onData)}setHeader(e,t){let n=0,r=this.headers.length;for(;n<r;){let s=n++;if(this.headers[s].name==e){this.headers[s]={name:e,value:t};return}}this.headers.push({name:e,value:t})}setPostData(e){this.postData=e,this.postBytes=null}onData(e){}onBytes(e){}onError(e){}onStatus(e){}hasOnData(){return rn(this,this.onData)!=this.emptyOnData}success(e){this.responseBytes=e,this.responseAsString=null,this.hasOnData()&&this.onData(this.get_responseData()),this.onBytes(this.responseBytes)}get_responseData(){return this.responseAsString==null&&this.responseBytes!=null&&(this.responseAsString=this.responseBytes.getString(0,this.responseBytes.length,Pe.UTF8)),this.responseAsString}}dt.__name__=!0;class mt extends dt{constructor(e){super(e)}request(e){this.responseAsString=null,this.responseBytes=null,this.responseHeaders=null;let t=new cn(this.url),n=t.protocol=="https:",r=t.hostname,s=t.pathname,l=t.port!=null?B.parseInt(t.port):n?443:80,i={},c=0,_=this.headers;for(;c<_.length;){let N=_[c];++c;let R=U.field(i,N.name);R==null&&(R=[],i[N.name]=R),R.push(N.value)}(this.postData!=null||this.postBytes!=null)&&(e=!0);let h=null,o=0,m=this.params;for(;o<m.length;){let N=m[o];++o,h==null?h="":h+="&";let R=N.name,X=encodeURIComponent(R)+"=",Q=N.value;h+=X+encodeURIComponent(Q)}let y=s.split("?").length<=1;h!=null&&(s+=(y?"?":"&")+h);let x={protocol:t.protocol,hostname:r,port:l,method:e?"POST":"GET",path:s,headers:i},p=this,P=function(N){N.setEncoding("binary");let R=N.statusCode;R!=null&&p.onStatus(R);let X=[];N.on("data",function(Q){X.push(ie.from(Q,"binary"))}),N.on("end",function(Q){let ye=X.length==1?X[0]:ie.concat(X),ce=ye.buffer.slice(ye.byteOffset,ye.byteOffset+ye.byteLength);p.responseBytes=I.ofData(ce),p.req=null,p.responseHeaders=new ft;let ke=0,Ve=U.fields(N.headers);for(;ke<Ve.length;){let Ce=Ve[ke];++ke,p.responseHeaders.h[Ce]=U.field(N.headers,Ce)}R!=null&&R>=200&&R<400?p.success(p.responseBytes):p.onError("Http Error #"+R)})};this.req=n?xt.request(x,P):wt.request(x,P),e&&(this.postData!=null?this.req.write(this.postData):this.postBytes!=null&&(this.req.setHeader("Content-Length",""+this.postBytes.length),this.req.write(ie.from(this.postBytes.b.bufferValue)))),this.req.end()}}mt.__name__=!0;var re=T["haxe.io.Error"]={__ename__:!0,__constructs__:null,Blocked:{_hx_name:"Blocked",_hx_index:0,__enum__:"haxe.io.Error",toString:d},Overflow:{_hx_name:"Overflow",_hx_index:1,__enum__:"haxe.io.Error",toString:d},OutsideBounds:{_hx_name:"OutsideBounds",_hx_index:2,__enum__:"haxe.io.Error",toString:d},Custom:(u=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:d}},u._hx_name="Custom",u.__params__=["e"],u)};re.__constructs__=[re.Blocked,re.Overflow,re.OutsideBounds,re.Custom];class C{constructor(e){switch(e){case".":case"..":this.dir=e,this.file="";return}let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");t<n?(this.dir=F.substr(e,0,n),e=F.substr(e,n+1,null),this.backslash=!0):n<t?(this.dir=F.substr(e,0,t),e=F.substr(e,t+1,null)):this.dir=null;let r=e.lastIndexOf(".");r!=-1?(this.ext=F.substr(e,r+1,null),this.file=F.substr(e,0,r)):(this.ext=null,this.file=e)}static directory(e){let t=new C(e);return t.dir==null?"":t.dir}static extension(e){let t=new C(e);return t.ext==null?"":t.ext}static join(e){let t=[],n=0;for(;n<e.length;){let i=e[n];++n,i!=null&&i!=""&&t.push(i)}if(t.length==0)return"";let r=t[0],s=1,l=t.length;for(;s<l;)r=C.addTrailingSlash(r),r+=t[s++];return C.normalize(r)}static normalize(e){let t="/";if(e=e.split("\\").join(t),e==t)return t;let n=[],r=0,s=e.split(t);for(;r<s.length;){let o=s[r];++r,o==".."&&n.length>0&&n[n.length-1]!=".."?n.pop():o==""?(n.length>0||F.cca(e,0)==47)&&n.push(o):o!="."&&n.push(o)}let l="",i=!1,c=!1,_=0,h=n.join(t);for(;_<h.length;){let o=h,m=_++,y=o.charCodeAt(m);y>=55296&&y<=56319&&(y=y-55232<<10|o.charCodeAt(m+1)&1023);let x=y;x>=65536&&++_;let p=x;switch(p){case 47:if(!i)c=!0;else{let N=p;i=!1,c&&(l+="/",c=!1),l+=String.fromCodePoint(N)}break;case 58:l+=":",i=!0;break;default:let P=p;i=!1,c&&(l+="/",c=!1),l+=String.fromCodePoint(P)}}return l}static addTrailingSlash(e){if(e.length==0)return"/";let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return t<n?n!=e.length-1?e+"\\":e:t!=e.length-1?e+"/":e}static isAbsolute(e){return!!(e.startsWith("/")||e.charAt(1)==":"||e.startsWith("\\\\"))}}C.__name__=!0;class gt{constructor(e){this.current=0,this.array=e}hasNext(){return this.current<this.array.length}next(){return this.array[this.current++]}}gt.__name__=!0;class ln{static fromCode(e){switch(e){case 100:return"Continue";case 101:return"Switching Protocols";case 102:return"Processing";case 200:return"OK";case 201:return"Created";case 202:return"Accepted";case 203:return"Non-Authoritative Information";case 204:return"No Content";case 205:return"Reset Content";case 206:return"Partial Content";case 207:return"Multi-Status";case 208:return"Already Reported";case 226:return"IM Used";case 300:return"Multiple Choices";case 301:return"Moved Permanently";case 302:return"Found";case 303:return"See Other";case 304:return"Not Modified";case 305:return"Use Proxy";case 306:return"Switch Proxy";case 307:return"Temporary Redirect";case 308:return"Permanent Redirect";case 400:return"Bad Request";case 401:return"Unauthorized";case 402:return"Payment Required";case 403:return"Forbidden";case 404:return"Not Found";case 405:return"Method Not Allowed";case 406:return"Not Acceptable";case 407:return"Proxy Authentication Required";case 408:return"Request Timeout";case 409:return"Conflict";case 410:return"Gone";case 411:return"Length Required";case 412:return"Precondition Failed";case 413:return"Payload Too Large";case 414:return"URI Too Long";case 415:return"Unsupported Media Type";case 416:return"Range Not Satisfiable";case 417:return"Expectation Failed";case 418:return"I'm a teapot";case 421:return"Misdirected Request";case 422:return"Unprocessable Entity";case 423:return"Locked";case 424:return"Failed Dependency";case 426:return"Upgrade Required";case 428:return"Precondition Required";case 429:return"Too Many Requests";case 431:return"Request Header Fields Too Large";case 451:return"Unavailable For Legal Reasons";case 500:return"Internal Server Error";case 501:return"Not Implemented";case 502:return"Bad Gateway";case 503:return"Service Unavailable";case 504:return"Gateway Timeout";case 505:return"HTTP Version Not Supported";case 506:return"Variant Also Negotiates";case 507:return"Insufficient Storage";case 508:return"Loop Detected";case 510:return"Not Extended";case 511:return"Network Authentication Required";default:return"Unknown Status"}}}class se{static __string_rec(e,t){if(e==null)return"null";if(t.length>=5)return"<...>";let n=typeof e;switch(n=="function"&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e.__enum__){let _=T[e.__enum__].__constructs__[e._hx_index],h=_._hx_name;return _.__params__?(t=t+"	",h+"("+function(o){var m;let y=[];{let x=0,p=_.__params__;for(;x<p.length;){let P=p[x];x=x+1,y.push(se.__string_rec(e[P],t))}}return m=y,m}(this).join(",")+")"):h}if(e instanceof Array){let c="[";t+="	";let _=0,h=e.length;for(;_<h;){let o=_++;c+=(o>0?",":"")+se.__string_rec(e[o],t)}return c+="]",c}let r;try{r=e.toString}catch{return"???"}if(r!=null&&r!=Object.toString&&typeof r=="function"){let c=e.toString();if(c!="[object Object]")return c}let s=`{
`;t+="	";let l=e.hasOwnProperty!=null,i=null;for(i in e)l&&!e.hasOwnProperty(i)||i=="prototype"||i=="__class__"||i=="__super__"||i=="__interfaces__"||i=="__properties__"||(s.length!=2&&(s+=`, 
`),s+=t+i+" : "+se.__string_rec(e[i],t));return t=t.substring(1),s+=`
`+t+"}",s;case"string":return e;default:return String(e)}}}se.__name__=!0;var pt=require("child_process"),oe=require("fs"),wt=require("http"),xt=require("https"),an=require("net"),un=require("path"),ie=require("buffer").Buffer;class St{static bytesOfBuffer(e){let t=Object.create(I.prototype);return t.length=e.byteLength,t.b=e,e.bufferValue=e,e.hxBytes=t,e.bytes=e,t}}St.__name__=!0;var cn=require("url").URL;class yt{constructor(e){e==null&&(e="php"),this.process=null,this.port=-1,this.executable=C.normalize(e)}transform(e){let t=this;return E.next(E.next(this.listen(),function(n){let r=new Zt().stringify({file:Ge.absolutePath(e)});return on.all(ee.fetch(q.fromString("http://127.0.0.1:"+t.port+"/index.php?"+r),null))}),function(n){return new S(new g(f.Success(n.body.toString())))})}getPort(){let e=an.createServer();e.unref();let t=new et;return e.on("error",function(n){let r=b.withData(503,"Unable to find an ephemeral TCP port.",n,{fileName:"src/php_minify/FastTransformer.hx",lineNumber:51,className:"php_minify.FastTransformer",methodName:"getPort"});return t.trigger(f.Failure(r))}),e.listen(0,"127.0.0.1",function(){let n=e.address().port;e.close(function(){t.trigger(f.Success(n))})}),t}listen(){let e=this;return this.process!=null?E.NOISE:E.next(this.getPort(),function(t){e.port=t;let n=e.executable,r="127.0.0.1:"+e.port,s=C.join([__dirname,"../www"]);return e.process=new Ke(n,["-S",r,"-t",s]),w.map(w.delay(1e3,V.NOISE),f.Success)})}}yt.__name__=!0;class Le{constructor(){this.version=!1,this.help=!1,this.silent=!1,this.mode="safe",this.extension="php",this.binary="php"}run(e){if(this.help||this.version){let o=this.version?ve.get_packageVersion():new Nt().format(Re.get());return process.stdout.write(B.string(o)),process.stdout.write(`
`),new S(new g(f.Success(null)))}let t=process.env.HAXELIB_RUN=="1";if(e.length<(t?2:1))return new S(new g(f.Failure(new b(400,"You must provide the path to the input directory.",{fileName:"src/php_minify/Program.hx",lineNumber:55,className:"php_minify.Program",methodName:"run"}))));let n=t?e.pop():process.cwd(),r=this.resolvePath(e.shift(),n);if(!Ne.exists(r))return new S(new g(f.Failure(new b(404,"The input directory was not found.",{fileName:"src/php_minify/Program.hx",lineNumber:59,className:"php_minify.Program",methodName:"run"}))));let s=C.addTrailingSlash(r).length,l=e.length>0?this.resolvePath(e.shift(),n):r,i=this.listDirectory(r),c=new Array(i.length),_=0,h=i.length;for(;_<h;){let o=_++;c[o]=i[o].substring(s)}return this.processFiles(r,l,c)}processFiles(e,t,n){let r=ct.systemName()=="Windows",s=this.mode=="fast"?new yt(this.binary):new kt(this.binary),l=new Array(n.length),i=0,c=n.length;for(;i<c;){let _=i++,h=n[_];if(!this.silent){let o=r?H.replace(h,"/","\\"):h;process.stdout.write(B.string("Minifying: "+o)),process.stdout.write(`
`)}l[_]=E.next(s.transform(C.join([e,h])),function(o){return new S(new g(b.catchExceptions(function(){let m=C.join([t,h]);return Ne.createDirectory(C.directory(m)),oe.writeFileSync(m,o),null},null,{fileName:"src/php_minify/Program.hx",lineNumber:76,className:"php_minify.Program",methodName:"processFiles"})))})}return E.noise(E.inSequence(l))}listDirectory(e){let t=[],n=0,r=oe.readdirSync(e);for(;n<r.length;){let s=r[n];++n;let l=C.join([e,s]);Ne.isDirectory(l)?t=t.concat(this.listDirectory(l)):C.extension(s)==this.extension&&t.push(l)}return t}resolvePath(e,t){return C.isAbsolute(e)?C.normalize(e):C.join([t,e])}static main(){new vt(new Le,new Ft(5)).process(process.argv.slice(2)).handle(bt.exit)}}Le.__name__=!0;class kt{constructor(e){e==null&&(e="php"),this.executable=C.normalize(e)}transform(e){let t=new Ke(this.executable,["-w",Ge.absolutePath(e)]);return E.next(w.flatMap(t.exitCode(),function(n){return n==0?He.all(t.stdout):new S(new g(f.Failure(new b(null,"The PHP process exited with a "+n+" code.",{fileName:"src/php_minify/SafeTransformer.hx",lineNumber:24,className:"php_minify.SafeTransformer",methodName:"transform"}))))}),function(n){return t.close(),new S(new g(f.Success(n.toString())))})}}kt.__name__=!0;class ve{static get_packageVersion(){return ve.packageVersion==null&&(ve.packageVersion="1.0.0"),ve.packageVersion}}ve.__name__=!0;class Ne{static exists(e){try{return oe.accessSync(e),!0}catch{return!1}}static isDirectory(e){try{return oe.statSync(e).isDirectory()}catch{return!1}}static createDirectory(e){try{oe.mkdirSync(e)}catch(t){let n=v.caught(t).unwrap();if(n.code=="ENOENT")Ne.createDirectory(un.dirname(e)),oe.mkdirSync(e);else{let r;try{r=oe.statSync(e)}catch{throw n}if(!r.isDirectory())throw n}}}}Ne.__name__=!0;class qe{getCursor(){return this.flattened==null&&this.flatten(this.flattened=[]),Me.create(this.flattened.slice())}flatten(e){}}qe.__name__=!0;class Ae extends qe{constructor(){super()}getLength(){return 0}blitTo(e,t){}toString(){return""}toBytes(){return Ae.EMPTY}}Ae.__name__=!0;class L{static concat(e,t){return z.cons(e,t)}static join(e){if(e==null)return L.EMPTY;switch(e.length){case 0:return L.EMPTY;case 1:return e[0];default:let t=L.concat(e[0],e[1]),n=2,r=e.length;for(;n<r;)t=L.concat(t,e[n++]);return t}}}class bt{static exit(e){switch(e._hx_index){case 0:process.exit(0);break;case 1:let t=e.failure,n=t.message;t.data!=null&&(n+=", "+(t.data==null?"null":B.string(t.data))),process.stdout.write(B.string(n)),process.stdout.write(`
`);let r=t.code;process.exit(r);break}}}bt.__name__=!0;class q{static resolve(e,t){if(t.scheme!=null)return t;if(t.hosts[0]!=null){if(t.scheme!=null)return t;{let n=U.copy(t);return n.scheme=e.scheme,n}}else{let n={path:Te.join(e.path,t.path),payload:"",scheme:e.scheme,query:t.query,auth:e.auth,hosts:e.hosts,hash:t.hash};return q.makePayload(n),n}}static makePayload(e){let t="",n=e.auth,r=e.hosts;n==null?r.length!=0&&(t="//"+r.join(",")):r.length==0?t="//"+(n==null?"null":n==null?"":""+n+"@"):t="//"+(n==null?"null":n==null?"":""+n+"@")+r.join(","),t+=e.path==null?"null":e.path;let s=e.query;s!=null&&(t+="?"+(s??"null"));let l=e.hash;l!=null&&(t+="#"+l),e.payload=t.toString()}static toString(e){return e.scheme==null?e.payload:""+e.scheme+":"+e.payload}static fromString(e){return q.parse(e)}static noop(e){}static parse(e,t){for(;;){if(e==null){e="",t=null;continue}if(t==null&&(t=q.noop),e=H.trim(e),e.startsWith("data:"))return{scheme:"data",payload:F.substr(e,5,null),hosts:[]};let n=new Oe("^(([a-zA-Z][a-zA-Z0-9\\-+.]*):)?((//(([^@/]+)@)?([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?)$",""),r=new Oe("^(\\[(.*)\\]|([^:]*))(:(.*))?$","");n.match(e);let s,l=n.matched(7);if(l==null)s=[];else{let c=[],_=0,h=l.split(",");for(;_<h.length;){let o=h[_];++_,r.match(o);let m,y=r.matched(3),x=r.matched(2);x==null?m=y:y==null?m="["+x+"]":(t("invalid host "+o),m=null);let p,P=r.matched(5);if(P==null)p=null;else{let N=B.parseInt(P);N==null?(t("invalid port "+P),p=null):p=N}c.push(at._new(m,p))}s=c}let i=n.matched(8);return s.length>0&&i.charAt(0)!="/"&&(i="/"+i),{scheme:n.matched(2),payload:n.matched(3),hosts:s,auth:n.matched(6),path:Te.ofString(i),query:n.matched(10),hash:n.matched(12)}}}static make(e){let t={payload:"",path:e.path,query:e.query,hosts:e.hosts,auth:e.auth,scheme:e.scheme,hash:e.hash};return q.makePayload(t),t}}class he extends qe{constructor(e,t,n){super(),this.data=e,this.from=t,this.to=n}flatten(e){e.push(this)}getLength(){return this.to-this.from}getSlice(e,t){return t>this.to-this.from&&(t=this.to-this.from),e<0&&(e=0),t<=e?null:t==this.to-this.from&&e==0?this:new he(this.data,this.from+e,t+this.from)}slice(e,t){let n=this.getSlice(e,t);return n??L.EMPTY}blitTo(e,t){this.wrapped==null&&(this.wrapped=I.ofData(this.data)),e.blit(t,this.wrapped,this.from,this.to-this.from)}toBytes(){return this.wrapped==null&&(this.wrapped=I.ofData(this.data)),this.wrapped.sub(this.from,this.to-this.from)}toString(){return this.wrapped==null&&(this.wrapped=I.ofData(this.data)),this.wrapped.getString(this.from,this.to-this.from)}static of(e){if(e.length==0)return L.EMPTY;let t=new he(e.b.bufferValue,0,e.length);return t.wrapped=e,t}}he.__name__=!0;class Me{constructor(){this.currentByte=-1,this.currentPos=0,this.length=0,this.curLength=0,this.curOffset=0,this.curPartIndex=0}reset(){this.length=0,this.currentPos=0,this.currentByte=-1,this.curOffset=0;let e=0,t=this.parts;for(;e<t.length;){let n=t[e];++e,this.length+=n.to-n.from}if(this.curPartIndex=0,this.curPart=this.parts[0],this.curPart!=null){let n=this.curPart;this.curLength=n.to-n.from;let r=this.curPart;this.currentByte=r.data.bytes[r.from]}}flush(){let e=this.left();return this.shift(),e}add(e){e.flatten(this.parts),this.reset()}shift(e){this.parts.splice(0,this.curPartIndex);let t=this.parts[0];if(t!=null){let n=t.getSlice(this.curOffset,this.curLength);n==null?this.parts.shift():this.parts[0]=n}e!=null?this.add(e):this.reset()}left(){if(this.curPart==null)return L.EMPTY;let e=[],t=0,n=this.curPartIndex;for(;t<n;)e.push(this.parts[t++]);return e.push(this.curPart.slice(0,this.curOffset)),L.join(e)}right(){if(this.curPart==null)return L.EMPTY;let e=[],t=this.curPartIndex,n=this.parts.length;for(;t<n;)e.push(this.parts[t++]);return e.length>0&&(e[0]=this.curPart.slice(this.curOffset,this.curLength)),L.join(e)}ffwd(){this.currentByte=-1,this.curLength=0,this.curOffset=0,this.curPart=null,this.curPartIndex=this.parts.length}next(){if(this.currentPos==this.length)return!1;if(this.currentPos++,this.currentPos==this.length)return this.ffwd(),!1;if(this.curOffset==this.curLength-1){this.curOffset=0,this.curPart=this.parts[++this.curPartIndex];let e=this.curPart;this.curLength=e.to-e.from;let t=this.curPart;this.currentByte=t.data.bytes[t.from]}else{let e=this.curPart;this.currentByte=e.data.bytes[e.from+ ++this.curOffset]}return!0}static create(e){let t=new Me;return t.parts=e,t.reset(),t}}Me.__name__=!0;class z extends qe{constructor(){super()}getLength(){return this.length}flatten(e){let t=0,n=this.chunks;for(;t<n.length;)n[t++].flatten(e)}blitTo(e,t){let n=0,r=this.chunks.length;for(;n<r;){let s=n++;this.chunks[s].blitTo(e,t+this.offsets[s])}}toString(){return this.toBytes().toString()}toBytes(){let e=new I(new ArrayBuffer(this.length));return this.blitTo(e,0),e}static asCompound(e){return e instanceof z?e:null}static cons(e,t){let n=e.getLength(),r=t.getLength();if(n==0)return r==0?L.EMPTY:t;if(r==0)return e;{let s=z.asCompound(e),l=z.asCompound(t);if(s==null){if(l==null)return z.create([e,t],2);if(l.depth<100)return z.create([e,t],l.depth+1);{let i=[];return l.flatten(i),t.flatten(i),z.create(i,2)}}else if(l==null){if(s.depth<100)return z.create([e,t],s.depth+1);{let i=[];return s.flatten(i),t.flatten(i),z.create(i,2)}}else{let i=s.depth>l.depth?s.depth:l.depth;return z.create(s.chunks.concat(l.chunks),i)}}}static create(e,t){let n=new z,r=[0],s=0,l=0;for(;l<e.length;)r.push(s+=e[l++].getLength());return n.chunks=e,n.offsets=r,n.length=s,n.depth=t,n}}z.__name__=!0;class Pt{constructor(e){this.buffer=e}getCursor(){return he.of(this.toBytes()).getCursor()}flatten(e){he.of(this.toBytes()).flatten(e)}getLength(){return this.buffer.length}toString(){return this.buffer.toString()}toBytes(){let e=ie.allocUnsafe(this.buffer.length);return this.buffer.copy(e),St.bytesOfBuffer(e)}blitTo(e,t){let n=e.b;this.buffer.copy(ie.from(n.buffer,n.byteOffset,e.length),t)}}Pt.__name__=!0;class Re{static get(){return Re.doc==null&&(Re.doc={doc:`\r
	Minify PHP source code by removing comments and whitespace.\r
\r
	> php_minify [flags] <input> [output]\r
`,commands:[{isDefault:!0,isSub:!1,names:[],doc:`\r
		input  : The input directory.\r
		output : The output directory.\r
	`}],flags:[{names:["--binary"],aliases:["b"],doc:" The path to the PHP executable. "},{names:["--extension"],aliases:["e"],doc:' The extension of the PHP files to process. Defaults to "php". '},{names:["--mode"],aliases:["m"],doc:' The operation mode of the minifier. Defaults to "safe". '},{names:["--silent"],aliases:["s"],doc:" Value indicating whether to silence the minifier output. "},{names:["--help"],aliases:["h"],doc:" Display this help. "},{names:["--version"],aliases:["v"],doc:" Output the version number. "}]}),Re.doc}}Re.__name__=!0;class je{constructor(e,t,n){this.command=e,this.prompt=t,this.hasFlags=n}processArgs(e){let t=this;return this.hasFlags?b.catchExceptions(function(){let n=je.expandAssignments(e),r=[],s=0,l=!1;for(;s<n.length;){let i=n[s];if(i=="--")l=!0,++s;else if(!l&&F.cca(i,0)==45){let c=t.processFlag(n,s);if(c==-1)if(F.cca(i,1)!=45){let _=t.processAlias(n,s);if(_==-1)throw v.thrown('Unrecognized alias "'+i+'"');s+=_+1}else throw v.thrown('Unrecognized flag "'+i+'"');else s+=c+1}else r.push(i),++s}return r},null,{fileName:"tink/cli/Router.hx",lineNumber:25,className:"tink.cli.Router",methodName:"processArgs"}):f.Success(e)}processFlag(e,t){return-1}processAlias(e,t){return-1}static expandAssignments(e){let t=[],n=!0,r=0;for(;r<e.length;){let s=e[r];if(++r,s=="--"&&(n=!1),!n)t.push(s);else{let l=F.cca(s,0),i=F.cca(s,1),c=s.indexOf("=");l==null?t.push(s):l==45?i==null?t.push(s):i==45&&c!=-1?(t.push(F.substr(s,0,c)),t.push(F.substr(s,c+1,null))):t.push(s):t.push(s)}}return t}}je.__name__=!0;class vt extends je{constructor(e,t){super(e,t,!0)}process(e){let t=this;if(e[0]==null){let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new S(new g(f.Failure(r.failure)))}return E.next(this.promptRequired(),function(s){return t.run_run(n)})}else{let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new S(new g(f.Failure(r.failure)))}return E.next(this.promptRequired(),function(s){return t.run_run(n)})}}processFlag(e,t){let n=t;switch(e[t]){case"--binary":n=t+1,this.command.binary=e[n];break;case"--extension":n=t+1,this.command.extension=e[n];break;case"--help":this.command.help=!0;break;case"--mode":n=t+1,this.command.mode=e[n];break;case"--silent":this.command.silent=!0;break;case"--version":this.command.version=!0;break;default:return-1}return n-t}processAlias(e,t){let n=t,r=e[t],s=1,l=r.length;for(;s<l;){let i=s++,c=F.cca(r,i);if(c==null)throw v.thrown("Invalid alias '-"+r.charAt(i)+"'");switch(c){case 98:this.command.binary=e[++n];break;case 101:this.command.extension=e[++n];break;case 104:this.command.help=!0;break;case 109:this.command.mode=e[++n];break;case 115:this.command.silent=!0;break;case 118:this.command.version=!0;break;default:throw v.thrown("Invalid alias '-"+r.charAt(i)+"'")}}return n-t}promptRequired(){return w.async(function(e){e(f.Success(null))})}run_run(e){return e.length<0?new S(new g(f.Failure(new b(null,"Insufficient arguments. Expected: 0, Got: "+e.length,{fileName:"src/php_minify/Program.hx",lineNumber:47,className:"tink.cli.Router0",methodName:"run_run"})))):this.command.run(e.slice(0,e.length))}}vt.__name__=!0;class Nt{constructor(e){this.re=new Oe("^\\s*\\*?\\s{0,2}(.*)$",""),this.root=e}format(e){let t="";t+=`
`;let n=this.formatDoc(e.doc);n!=null&&(t+=B.string(""+n+`

`));let r=e.commands,s=[],l=0;for(;l<r.length;){let _=r[l];++l,_.isDefault||s.push(_)}this.root!=null&&(t+=B.string("  Usage: "+this.root+`
`));let i=De.find(e.commands,function(_){return _.isDefault});if(i!=null){let _=this.formatDoc(i.doc);_!=null&&(t+=B.string(this.indent(_,4)+`

`))}let c=this;if(s.length>0){let _=De.fold(s,function(m,y){let x=0,p=m.names;for(;x<p.length;){let P=p[x];++x,P.length>y&&(y=P.length)}return y},0);this.root!=null&&(t+=B.string("  Usage: "+this.root+` <subcommand>
`)),t+=B.string(`    Subcommands:
`);let h=function(m,y){y==null&&(y="(doc missing)"),t+=B.string(c.indent(H.lpad(m," ",_)+" : "+H.trim(c.indent(y,_+3)),6)+`
`)},o=0;for(;o<s.length;){let m=s[o];++o;let y=m.names[0];if(h(y,this.formatDoc(m.doc)),m.names.length>1){let x=1,p=m.names.length;for(;x<p;)h(m.names[x++],"Alias of "+y)}}}if(e.flags.length>0){let _=function(x){let p=x.names.join(", ");if(x.aliases.length>0){let P=x.aliases,N=new Array(P.length),R=0,X=P.length;for(;R<X;){let Q=R++;N[Q]="-"+P[Q]}p+=", "+N.join(", ")}return p},h=De.fold(e.flags,function(x,p){let P=_(x);return P.length>p&&(p=P.length),p},0),o=function(x,p){p==null&&(p=""),t+=B.string(c.indent(H.lpad(x," ",h)+" : "+H.trim(c.indent(p,h+3)),6)+`
`)};t=(t+=`
`)+B.string(`  Flags:
`);let m=0,y=e.flags;for(;m<y.length;){let x=y[m];++m,o(_(x),this.formatDoc(x.doc))}}return t}indent(e,t){let n=e.split(`
`),r=new Array(n.length),s=0,l=n.length;for(;s<l;){let i=s++;r[i]=H.lpad(""," ",t)+n[i]}return r.join(`
`)}formatDoc(e){if(e==null)return null;let t=e.split(`
`),n=H.trim,r=new Array(t.length),s=0,l=t.length;for(;s<l;){let o=s++;r[o]=n(t[o])}let i=r;for(;i[0]=="";)i=i.slice(1);for(;i[i.length-1]=="";)i.pop();let c=new Array(i.length),_=0,h=i.length;for(;_<h;){let o=_++,m=i[o];c[o]=this.re.match(m)?this.re.matched(1):m}return c.join(`
`)}}Nt.__name__=!0;class Rt{constructor(e,t){this.source=e,this.sink=t}}Rt.__name__=!0;class Et extends Rt{constructor(){let e=process.stdin,t=null;t={},super(J.wrap("stdin",e,t.chunkSize,t.onEnd),we.wrap("stdout",process.stdout))}}Et.__name__=!0;class Ft{constructor(e,t){this.trials=e,this.proxy=t??new Et}}Ft.__name__=!0;class k{static invoke(e,t){k.depth<500?(k.depth++,e(t),k.depth--):k.defer(function(){e(t)})}static defer(e){global.setImmediate(e)}}class Tt{constructor(){}cancel(){let e=this.link;e?.cancel()}}Tt.__name__=!0;class _n{static fromMany(e){return new Ct(function(){if(e!=null){let t=0;for(;t<e.length;){let n=e[t];++t,n?.cancel()}}else e=null})}}class Ct{constructor(e){this.f=e}cancel(){this.f!=null&&(this.f(),this.f=null)}}Ct.__name__=!0;class Ze{constructor(e,t){this.dissolved=!1,this.a=e,this.b=t}cancel(){if(!this.dissolved){this.dissolved=!0;let e=this.a;e?.cancel();let t=this.b;t?.cancel(),this.a=null,this.b=null}}}Ze.__name__=!0;class Je{constructor(e,t){if(e==null)throw v.thrown("callback expected but null received");this.cb=e,this.list=t}cancel(){if(this.list!=null){let e=this.list;this.cb=null,this.list=null,--e.used<=e.cells.length>>1&&e.compact()}}}Je.__name__=!0;class le{constructor(e){le._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.disposeHandlers=[],this.f=e}dispose(){let e=this.disposeHandlers;if(e!=null){this.disposeHandlers=null;let t=this.f;this.f=le.noop,t();let n=0;for(;n<e.length;)e[n++]()}}static noop(){}}le.__name__=!0;class Qe extends le{constructor(e){le._hx_skip_constructor=!0,super(),le._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){e==null&&(e=!1),this.onfill=function(){},this.ondrain=function(){},this.busy=!1,this.queue=[],this.used=0;let t=this;super._hx_constructor(function(){t.busy||t.destroy()}),this.destructive=e,this.cells=[]}destroy(){let e=0,t=this.cells;for(;e<t.length;){let n=t[e];++e,n.cb=null,n.list=null}if(this.queue=null,this.cells=null,this.used>0){this.used=0;let n=this.ondrain;k.depth<500?(k.depth++,n(),k.depth--):k.defer(n)}}invoke(e){let t=this;if(k.depth<500){if(k.depth++,t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let s=t.cells[r++];s.list!=null&&s.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}k.depth--}else k.defer(function(){if(t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let s=t.cells[r++];s.list!=null&&s.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}})}compact(){if(!this.busy)if(this.used==0){this.resize(0);let e=this.ondrain;k.depth<500?(k.depth++,e(),k.depth--):k.defer(e)}else{let e=0,t=0,n=this.cells.length;for(;t<n;){let r=t++,s=this.cells[r];if(s.cb!=null&&(e!=r&&(this.cells[e]=s),++e==this.used))break}this.resize(this.used)}}resize(e){this.cells.length=e}}Qe.__name__=!0;class b{constructor(e,t,n){e==null&&(e=500),this.isTinkError=!0,this.code=e,this.message=t,this.pos=n,this.exceptionStack=[],this.callStack=[]}static withData(e,t,n,r){return b.typed(e,t,n,r)}static typed(e,t,n,r){let s=new b(e,t,r);return s.data=n,s}static asError(e){return e!=null&&e.isTinkError?e:null}static catchExceptions(e,t,n){try{return f.Success(e())}catch(r){let s=v.caught(r).unwrap(),l=b.asError(s);return f.Failure(l??(t==null?b.withData(null,"Unexpected Error",s,n):t(s)))}}}b.__name__=!0;class W{constructor(){W._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){}getStatus(){return O.NeverEver}handle(e){return null}eager(){}}W.__name__=!0;class g{constructor(e){this.value=e}isComputed(){return!0}get(){return this.value}compute(){}underlying(){return null}}g.__name__=!0;class S extends W{constructor(e){super(),this.value=e}getStatus(){return O.Ready(this.value)}handle(e){return k.invoke(e,V.get(this.value)),null}eager(){this.value.isComputed()||V.get(this.value)}}S.__name__=!0;class w{static never(){return w.NEVER_INST}static first(e,t){let n=e;switch(n.getStatus()._hx_index){case 3:switch(t.getStatus()._hx_index){case 3:return n;case 4:return n;default:return n}break;case 4:return t;default:switch(t.getStatus()._hx_index){case 3:return t;case 4:return n;default:return new fe(function(r){return new Ze(e.handle(r),t.handle(r))})}}}static map(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let s=r.result,l=t;return new S(new tt(function(){return l(s.get())},s));case 4:return w.never();default:return new fe(function(i){return e.handle(function(c){i(t(c))})})}}static flatMap(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let s=r.result;return new fe(function(l){return t(V.get(s)).handle(function(i){l(i)})});case 4:return w.never();default:return new fe(function(l){let i=new Tt;return new Ze(e.handle(function(c){let _=t(c).handle(l),h=i.link;h?.cancel(),i.link=_}),i)})}}static processMany(e,t,n,r){return e.length==0?new S(new g(r(f.Success([])))):new fe(function(s){let l=[],i=[],c=0;for(;c<e.length;)++c,i.push(null);let _=i,h=0,o=0,m=!1,y;if(t==null)y=e.length;else{let R=t;y=R<1?1:R>e.length?e.length:R}let x=function(){if(h==_.length)if(o==0){let R=r(f.Success(_));return m=!0,s(R),!0}else return!1;else return!1},p=null;p=function(){if(!m&&!x())for(;h<_.length;){h+=1;let R=h-1,X=e[R],Q=function(ce){let ke=n(ce);switch(ke._hx_index){case 0:_[R]=ke.data,x();break;case 1:let Ve=ke.failure,Ce=0;for(;Ce<l.length;){let sn=l[Ce];++Ce,sn?.cancel()}let gn=r(f.Failure(Ve));m=!0,s(gn);break}},ye=X.getStatus();if(ye._hx_index==3){let ce;if(ce=V.get(ye.result),Q(ce),!m)continue}else o+=1,l.push(X.handle(function(ce){o-=1,Q(ce),m||p()}));break}};let P=0,N=y;for(;P<N;)++P,p();return _n.fromMany(l)})}static async(e,t){t==null&&(t=!1);let n=w.irreversible(e);return t||n.eager(),n}static irreversible(e){return new fe(function(t){return e(t),null})}static delay(e,t){let n=w.irreversible(function(r){Ie.delay(function(){r(V.get(t))},e)});return n.eager(),n}}var O=T["tink.core.FutureStatus"]={__ename__:!0,__constructs__:null,Suspended:{_hx_name:"Suspended",_hx_index:0,__enum__:"tink.core.FutureStatus",toString:d},Awaited:{_hx_name:"Awaited",_hx_index:1,__enum__:"tink.core.FutureStatus",toString:d},EagerlyAwaited:{_hx_name:"EagerlyAwaited",_hx_index:2,__enum__:"tink.core.FutureStatus",toString:d},Ready:(u=function(a){return{_hx_index:3,result:a,__enum__:"tink.core.FutureStatus",toString:d}},u._hx_name="Ready",u.__params__=["result"],u),NeverEver:{_hx_name:"NeverEver",_hx_index:4,__enum__:"tink.core.FutureStatus",toString:d}};O.__constructs__=[O.Suspended,O.Awaited,O.EagerlyAwaited,O.Ready,O.NeverEver];class et extends W{constructor(){W._hx_skip_constructor=!0,super(),W._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.status=O.Awaited,super._hx_constructor(),this.list=new Qe(!0)}getStatus(){return this.status}handle(e){let t=this.status;if(t._hx_index==3)return k.invoke(e,V.get(t.result)),null;{let n=this.list;if(n.disposeHandlers==null)return null;{let r=new Je(e,n);if(n.cells.push(r),n.used++==0){let s=n.onfill;k.depth<500?(k.depth++,s(),k.depth--):k.defer(s)}return r}}}trigger(e){return this.status._hx_index==3?!1:(this.status=O.Ready(new g(e)),this.list.invoke(e),!0)}}et.__name__=!0;class fe extends W{constructor(e){W._hx_skip_constructor=!0,super(),W._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.status=O.Suspended,super._hx_constructor(),this.wakeup=e,this.callbacks=new Qe(!0);let t=this;this.callbacks.ondrain=function(){if(t.status==O.Awaited){t.status=O.Suspended;let n=t.link;n?.cancel(),t.link=null}},this.callbacks.onfill=function(){t.status==O.Suspended&&(t.status=O.Awaited,t.arm())}}getStatus(){return this.status}trigger(e){if(this.status._hx_index!=3){this.status=O.Ready(new g(e));let t=this.link;this.link=null,this.wakeup=null,this.callbacks.invoke(e),t?.cancel()}}handle(e){let t=this.status;if(t._hx_index==3)return k.invoke(e,V.get(t.result)),null;{let n=this.callbacks;if(n.disposeHandlers==null)return null;{let r=new Je(e,n);if(n.cells.push(r),n.used++==0){let s=n.onfill;k.depth<500?(k.depth++,s(),k.depth--):k.defer(s)}return r}}}arm(){let e=this;this.link=this.wakeup(function(t){e.trigger(t)})}eager(){switch(this.status._hx_index){case 0:this.status=O.EagerlyAwaited,this.arm();break;case 1:this.status=O.EagerlyAwaited;break;default:}}}fe.__name__=!0;class V{static get(e){return e.compute(),e.get()}}class tt{constructor(e,t){this.f=e,this.from=t}underlying(){return this.from}isComputed(){return this.f==null}get(){return this.result}compute(){let e=this.f;if(e!=null){this.f=null;let t=this.from;if(t!=null){let n=t;this.from=null;let r=[];for(;n!=null&&!n.isComputed();)r.push(n),n=n.underlying();r.reverse();let s=0;for(;s<r.length;)r[s++].compute()}this.result=e()}}}tt.__name__=!0;class At{constructor(e,t){this.name=e,this.value=t}}At.__name__=!0;var f=T["tink.core.Outcome"]={__ename__:!0,__constructs__:null,Success:(u=function(a){return{_hx_index:0,data:a,__enum__:"tink.core.Outcome",toString:d}},u._hx_name="Success",u.__params__=["data"],u),Failure:(u=function(a){return{_hx_index:1,failure:a,__enum__:"tink.core.Outcome",toString:d}},u._hx_name="Failure",u.__params__=["failure"],u)};f.__constructs__=[f.Success,f.Failure];class Bt{constructor(e,t){this.a=e,this.b=t}}Bt.__name__=!0;class E{static never(){return w.never()}static noise(e){return e.getStatus()._hx_index==4?E.never():E.next(e,function(t){return new S(new g(f.Success(null)))})}static next(e,t,n){return w.flatMap(e,function(r){switch(r._hx_index){case 0:return t(r.data);case 1:return new S(new g(f.Failure(r.failure)))}})}static many(e,t){return w.processMany(e,t,function(n){return n},function(n){return n})}static inSequence(e){return E.many(e,1)}}class ae{constructor(e,t,n){this.preprocessors=e,this.postprocessors=t,this.real=n}pipe(e,t,n){if(n==null&&(n=0),t!=null&&n<t.length){let r=this,s=t,l=n+1,i=function(c){return r.pipe(c,s,l)};return E.next(t[n](e),i)}else return new S(new g(f.Success(e)))}request(e){let t=this;return E.next(this.pipe(e,this.preprocessors),function(n){let r=t.real.request(n),s=t,l;if(t.postprocessors==null)l=null;else{let i=[],c=0,_=t.postprocessors;for(;c<_.length;)i.push(_[c++](n));l=i}return E.next(r,function(i){return s.pipe(i,l)})})}static concat(e,t){return e==null?t:t==null?e:e.concat(t)}static create(e,t,n){let r=e instanceof ae?e:null;if(r==null)return new ae(t,n,e);{let s=r;return new ae(ae.concat(t,s.preprocessors),ae.concat(s.postprocessors,n),s.real)}}}ae.__name__=!0;class ee{static fetch(e,t){return w.async(function(n){let r="GET",s=null,l=$.EMPTY,i=de.Default,c=!0;t!=null&&(t.method!=null&&(r=t.method),t.headers!=null&&(s=t.headers),t.body!=null&&(l=t.body),t.client!=null&&(i=t.client),t.followRedirect==!1&&(c=!1));let _=ee.getClient(i);if(t!=null&&t.augment!=null){let h=t.augment;_=ae.create(_,h.before,h.after)}_.request(new It(new Ue(r,e,null,s),l)).handle(function(h){switch(h._hx_index){case 0:let o=h.data,m=o.header.statusCode;switch(m){case 301:case 302:case 303:case 307:case 308:let y=m;c?E.next(new S(new g(o.header.byName("location".toLowerCase()))),function(x){let p=q.resolve(e,q.fromString(x)),P;if(y==303){let N=U.copy(t);N.method="GET",P=N}else P=t;return ee.fetch(p,P)}).handle(n):n(f.Success(o));break;default:n(f.Success(o))}break;case 1:n(f.Failure(h.failure));break}})})}static getClient(e){if(!ee.cache.exists(e)){let t;switch(e._hx_index){case 0:t=new Ut;break;case 1:t=new jt(e.container);break;case 2:t=new Mt;break;case 3:t=new zt;break;case 4:t=e.v;break}ee.cache.set(e,t)}return ee.cache.get(e)}}ee.__name__=!0;var de=T["tink.http.ClientType"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"tink.http.ClientType",toString:d},Local:(u=function(a){return{_hx_index:1,container:a,__enum__:"tink.http.ClientType",toString:d}},u._hx_name="Local",u.__params__=["container"],u),Curl:{_hx_name:"Curl",_hx_index:2,__enum__:"tink.http.ClientType",toString:d},StdLib:{_hx_name:"StdLib",_hx_index:3,__enum__:"tink.http.ClientType",toString:d},Custom:(u=function(a){return{_hx_index:4,v:a,__enum__:"tink.http.ClientType",toString:d}},u._hx_name="Custom",u.__params__=["v"],u)};de.__constructs__=[de.Default,de.Local,de.Curl,de.StdLib,de.Custom];class on{static all(e){return E.next(e,function(t){return E.next(He.all(t.body),function(n){return t.header.statusCode>=400?new S(new g(f.Failure(b.withData(t.header.statusCode,t.header.reason,n.toString(),{fileName:"tink/http/Fetch.hx",lineNumber:124,className:"tink.http._Fetch.FetchResponse_Impl_",methodName:"all"})))):new S(new g(f.Success(new Y(t.header,n))))})})}}class Z{constructor(e){Z._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.fields=e??[]}get(e){let t=[],n=0,r=this.fields;for(;n<r.length;){let s=r[n];++n,s.name==e&&t.push(s.value)}return t}byName(e){let t=this.get(e);switch(t.length){case 0:return f.Failure(new b(422,"No "+e+" header found",{fileName:"tink/http/Header.hx",lineNumber:91,className:"tink.http.Header",methodName:"byName"}));case 1:return f.Success(t[0]);default:return f.Failure(new b(422,"Multiple entries for "+e+" header",{fileName:"tink/http/Header.hx",lineNumber:95,className:"tink.http.Header",methodName:"byName"}))}}}Z.__name__=!0;class hn{static basicAuth(e,t){return"Basic "+_e.encode(I.ofString(""+e+":"+t)).toString()}}class me extends At{constructor(e,t){super(e,t)}static ofString(e){let t=e.indexOf(":");return t==-1?new me(e.toLowerCase(),null):new me(F.substr(e,0,t).toLowerCase(),H.trim(F.substr(e,t+1,null)))}}me.__name__=!0;class Ht{read(e){throw v.thrown("abstract")}progress(e){do{let t=this.read(e.currentByte);switch(t._hx_index){case 0:break;case 1:return e.next(),D.Done(t.r);case 2:return D.Failed(t.e)}}while(e.next());return D.Progressed}eof(e){let t=this.read(-1);switch(t._hx_index){case 0:return f.Failure(new b(422,"Unexpected end of input",{fileName:"tink/io/StreamParser.hx",lineNumber:180,className:"tink.io.BytewiseParser",methodName:"eof"}));case 1:return f.Success(t.r);case 2:return f.Failure(t.e)}}}Ht.__name__=!0;var D=T["tink.io.ParseStep"]={__ename__:!0,__constructs__:null,Progressed:{_hx_name:"Progressed",_hx_index:0,__enum__:"tink.io.ParseStep",toString:d},Done:(u=function(a){return{_hx_index:1,r:a,__enum__:"tink.io.ParseStep",toString:d}},u._hx_name="Done",u.__params__=["r"],u),Failed:(u=function(a){return{_hx_index:2,e:a,__enum__:"tink.io.ParseStep",toString:d}},u._hx_name="Failed",u.__params__=["e"],u)};D.__constructs__=[D.Progressed,D.Done,D.Failed];class Ot extends Ht{constructor(e){super(),this.last=-1,this.buf=new Ye,this.makeHeader=e}read(e){let t=this.last;switch(e){case-1:return this.nextLine();case 10:if(t==13)return this.nextLine();{let n=e;return this.last=n,this.buf.b+=String.fromCodePoint(n),D.Progressed}break;case 13:if(t==13){let n=this.last;return this.buf.b+=String.fromCodePoint(n),D.Progressed}else return this.last=13,D.Progressed;break;default:if(t==13){let n=e,r=this.last;return this.buf.b+=String.fromCodePoint(r),this.buf.b+=String.fromCodePoint(n),this.last=-1,D.Progressed}else{let n=e;return this.last=n,this.buf.b+=String.fromCodePoint(n),D.Progressed}}}nextLine(){let e=this.buf.b;if(this.buf=new Ye,this.last=-1,e=="")return this.header==null?D.Progressed:D.Done(this.header);if(this.header==null){let t=this.makeHeader(e,this.fields=[]);switch(t._hx_index){case 0:let n=t.data;return n==null?D.Done(this.header=null):(this.header=n,D.Progressed);case 1:return D.Failed(t.failure)}}else return this.fields.push(me.ofString(e)),D.Progressed}}Ot.__name__=!0;class Y{constructor(e,t){Y._hx_skip_constructor||this._hx_constructor(e,t)}_hx_constructor(e,t){this.header=e,this.body=t}}Y.__name__=!0;class nt extends Z{constructor(e,t,n,r){Z._hx_skip_constructor=!0,super(),Z._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){n==null&&(n="HTTP/1.1"),this.method=e,this.url=t,this.protocol=n,super._hx_constructor(r)}}nt.__name__=!0;class Dt extends nt{constructor(e,t,n,r){super(e,t,n,r)}}Dt.__name__=!0;class Ue extends nt{constructor(e,t,n,r){n==null&&(n="HTTP/1.1");let s=Ue.extractAuth(t);if(s._hx_index==0){let l=s.v;t=l.url,r=r.concat(l.headers)}super(e,t,n,r)}static extractAuth(e){let t=e.auth;if(t==null)return ne.None;{let n=[new me("authorization",hn.basicAuth(t==null?null:t.split(":")[0],t==null?null:t.split(":")[1]))],r=e.scheme,s=[],l=0,i=e.hosts;for(;l<i.length;)s.push(i[l++]);return ne.Some({headers:n,url:q.make({scheme:r,hosts:s,path:e.path,query:e.query})})}}}Ue.__name__=!0;class It extends Y{constructor(e,t){super(e,t)}}It.__name__=!0;class Lt extends Y{constructor(e,t,n){Y._hx_skip_constructor=!0,super(),Y._hx_skip_constructor=!1,this._hx_constructor(e,t,n)}_hx_constructor(e,t,n){this.clientIp=e,super._hx_constructor(t,n)}}Lt.__name__=!0;var ze=T["tink.http.IncomingRequestBody"]={__ename__:!0,__constructs__:null,Plain:(u=function(a){return{_hx_index:0,source:a,__enum__:"tink.http.IncomingRequestBody",toString:d}},u._hx_name="Plain",u.__params__=["source"],u),Parsed:(u=function(a){return{_hx_index:1,parts:a,__enum__:"tink.http.IncomingRequestBody",toString:d}},u._hx_name="Parsed",u.__params__=["parts"],u)};ze.__constructs__=[ze.Plain,ze.Parsed];class ge extends Z{constructor(e,t,n,r){Z._hx_skip_constructor=!0,super(),Z._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){r==null&&(r="HTTP/1.1"),this.statusCode=e,this.reason=t??ln.fromCode(e),this.protocol=r,super._hx_constructor(n)}static parser(){return new Ot(function(e,t){let n=e.split(" ");if(n.length>=3){let r=B.parseInt(n[1]),s=n.slice(2).join(" "),l=n[0];return l==null&&(l="HTTP/1.1"),f.Success(new ge(r,s,t,l))}else return f.Failure(new b(422,"Invalid HTTP response header",{fileName:"tink/http/Response.hx",lineNumber:56,className:"tink.http.ResponseHeaderBase",methodName:"parser"}))})}}ge.__name__=!0;class qt extends Y{constructor(e,t){super(e,t)}}qt.__name__=!0;class Be extends Y{constructor(e,t){super(e,t)}}Be.__name__=!0;var rt=T["tink.http.BodyPart"]={__ename__:!0,__constructs__:null,Value:(u=function(a){return{_hx_index:0,v:a,__enum__:"tink.http.BodyPart",toString:d}},u._hx_name="Value",u.__params__=["v"],u),File:(u=function(a){return{_hx_index:1,handle:a,__enum__:"tink.http.BodyPart",toString:d}},u._hx_name="File",u.__params__=["handle"],u)};rt.__constructs__=[rt.Value,rt.File];class Mt{constructor(e,t){e!=null&&(this.curl=e),this.extraArgs=t}request(e){let t=st.checkScheme(e.header.url);switch(t._hx_index){case 0:return new S(new g(f.Failure(t.v)));case 1:let n=this.extraArgs,r=n==null?[]:n.slice();switch(r.push("-isS"),r.push("-X"),r.push(e.header.method),e.header.protocol){case"HTTP/1.0":r.push("--http1.0");break;case"HTTP/1.1":r.push("--http1.1");break;case"HTTP/2":r.push("--http2");break;default:}let s=e.header.fields,l=0;for(;l<s.length;){let i=s[l++];r.push("-H"),r.push(""+i.name+": "+i.value)}return r.push(q.toString(e.header.url)),E.next(He.parse(this.curl(r,e.body),ge.parser()),function(i){return new S(new g(f.Success(new Be(i.a,i.b))))})}}curl(e,t){e.push("--data-binary"),e.push("@-");let n=pt.spawn("curl",e),r=we.wrap("stdin",n.stdin),s=null;s={};let l=J.wrap("stdout",n.stdout,s.chunkSize,s.onEnd),i=null;i={};let c=J.wrap("stderr",n.stderr,i.chunkSize,i.onEnd);return $.pipeTo(t,r,{end:!0}).eager(),$.ofPromised(w.flatMap(w.async(function(_){n.once("exit",function(h,o){_(h)})}),function(_){if(_==0)return new S(new g(f.Success(l)));{let h=_;return E.next(He.all(c),function(o){return new S(new g(f.Failure(new b(h,o.toString(),{fileName:"tink/http/clients/CurlClient.hx",lineNumber:70,className:"tink.http.clients.CurlClient",methodName:"curl"}))))})}}))}}Mt.__name__=!0;class st{static checkScheme(e){let t=e.scheme;if(t==null)return ne.Some(new b(400,"Missing Scheme (expected http/https) in URL: "+q.toString(e),{fileName:"tink/http/clients/Helpers.hx",lineNumber:16,className:"tink.http.clients.Helpers",methodName:"missingSchemeError"}));switch(t){case"http":case"https":return ne.None;default:let n=q.fromString(t);return ne.Some(new b(400,'Invalid Scheme "'+n.scheme+'" (expected http/https) in URL: '+q.toString(n),{fileName:"tink/http/clients/Helpers.hx",lineNumber:19,className:"tink.http.clients.Helpers",methodName:"invalidSchemeError"}))}}}st.__name__=!0;class jt{constructor(e){this.container=e}request(e){let t=e.header.url;return w.flatMap(this.container.serve(new Lt("127.0.0.1",new Dt(e.header.method,q.fromString(t.query==null?t.path:(t.path==null?"null":t.path)+"?"+(t.query==null?"null":t.query)),"HTTP/1.1",e.header.fields),ze.Plain(e.body))),function(n){return new S(new g(f.Success(new Be(n.header,n.body))))})}}jt.__name__=!0;class Ut{constructor(e){this.agent=e}request(e){let t=st.checkScheme(e.header.url);switch(t._hx_index){case 0:return new S(new g(f.Failure(t.v)));case 1:let n=this.getNodeOptions(e.header);return e.header.url.scheme=="https"?this.nodeRequest(xt,n,e):this.nodeRequest(wt,n,e)}}getNodeOptions(e){let t=this.agent,n=e.method,r=e.url,s=r.query==null?r.path:(r.path==null?"null":r.path)+"?"+(r.query==null?"null":r.query),l=at.get_name(e.url.hosts[0]),i=at.get_port(e.url.hosts[0]),c={},_=e.fields,h=0;for(;h<_.length;){let o=_[h++];if(o.name=="host")c[o.name]=o.value;else{let m=c[o.name];(m??(c[o.name]=[])).push(o.value)}}return{agent:t,method:n,path:s,host:l,port:i,headers:c}}nodeRequest(e,t,n){return w.async(function(r){let s=e.request(t,function(i){let c=r,_=i.statusCode,h=i.statusMessage,o=[],m=0,y=i.rawHeaders.length>>1;for(;m<y;){let p=m++;o.push(new me(i.rawHeaders[2*p].toLowerCase(),i.rawHeaders[2*p+1]))}let x=null;x={},c(f.Success(new Be(new ge(_,h,o,"HTTP/1.1"),J.wrap("Response from "+(n.header.url==null?"null":q.toString(n.header.url)),i,x.chunkSize,x.onEnd))))}),l=function(i){r(f.Failure(i))};s.on("error",function(i){l(b.withData(null,i.message,i,{fileName:"tink/http/clients/NodeClient.hx",lineNumber:87,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}))}),$.pipeTo(n.body,we.wrap("Request to "+(n.header.url==null?"null":q.toString(n.header.url)),s)).handle(function(i){switch(s.end(),i._hx_index){case 0:break;case 1:l(new b(502,"Gateway Error",{fileName:"tink/http/clients/NodeClient.hx",lineNumber:96,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}));break;case 2:l(i.e);break}})})}}Ut.__name__=!0;class zt{constructor(e){this.worker=K.ensure(e)}request(e){let t=this;return w.async(function(n){let r=new mt(q.toString(e.header.url)),s=function(c){let _=200;r.onStatus=function(o){_=o};let h=function(){return[]};r.onError=function(o){_==200&&(_=500),K.work(t.worker,new g(!0)).handle(function(){n(f.Failure(new b(_,o,{fileName:"tink/http/clients/StdClient.hx",lineNumber:44,className:"tink.http.clients.StdClient",methodName:"request"})))})},r.onData=function(o){K.work(t.worker,new g(!0)).handle(function(){let m=n,y=h();m(f.Success(new Be(new ge(_,"OK",y,"HTTP/1.1"),new Fe(new g(he.of(I.ofString(o)))))))})},K.work(t.worker,new tt(function(){r.request(c)}))},l=e.header.fields,i=0;for(;i<l.length;){let c=l[i++];r.setHeader(c.name,c.value)}switch(e.header.method){case"GET":case"HEAD":case"OPTIONS":s(!1);break;default:Yt.all(e.body).handle(function(c){r.setPostData(c.toString()),s(!0)})}})}}zt.__name__=!0;class fn{constructor(){}serve(e){return this.running?this.handler.process(e):new S(new g(new qt(new ge(503,"Server stopped",[],"HTTP/1.1"),$.EMPTY)))}}fn.__name__=!0;var te=T["tink.io.PipeResult"]={__ename__:!0,__constructs__:null,AllWritten:{_hx_name:"AllWritten",_hx_index:0,__enum__:"tink.io.PipeResult",toString:d},SinkEnded:(u=function(a,e){return{_hx_index:1,result:a,rest:e,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SinkEnded",u.__params__=["result","rest"],u),SinkFailed:(u=function(a,e){return{_hx_index:2,e:a,rest:e,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SinkFailed",u.__params__=["e","rest"],u),SourceFailed:(u=function(a){return{_hx_index:3,e:a,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SourceFailed",u.__params__=["e"],u)};te.__constructs__=[te.AllWritten,te.SinkEnded,te.SinkFailed,te.SourceFailed];class Wt{static toResult(e,t,n){let r=function(s){return n==null?s:s.prepend(new Fe(new g(n)))};switch(e._hx_index){case 0:return te.SinkEnded(t,r(e.rest));case 1:return te.SinkFailed(e.error,r(e.at));case 2:return te.SourceFailed(e.error);case 3:return te.AllWritten}}}Wt.__name__=!0;class Vt{consume(e,t){throw v.thrown("not implemented")}}Vt.__name__=!0;class pe{constructor(){}get_depleted(){return!1}prepend(e){return this.get_depleted()?e:ue.of([e,this])}decompose(e){this.get_depleted()||e.push(this)}reduce(e,t){let n=this;return w.async(function(r){n.forEach(lt.ofUnknown(function(s){return w.map(t(e,s),function(l){switch(l._hx_index){case 0:return e=l.result,M.Resume;case 1:return M.Clog(l.e)}})})).handle(function(s){switch(s._hx_index){case 0:throw v.thrown("assert");case 1:r(xe.Crashed(s.error,s.at));break;case 2:r(xe.Failed(s.error));break;case 3:r(xe.Reduced(e));break}})})}forEach(e){throw v.thrown("not implemented")}}pe.__name__=!0;class Ee extends pe{constructor(){super()}get_depleted(){return!0}forEach(e){return new S(new g(A.Depleted))}}Ee.__name__=!0;class ${static concatAll(e){return e.reduce(L.EMPTY,mn.ofSafeSync(function(t,n){return We.Progress(L.concat(t,n))}))}static pipeTo(e,t,n){return t.consume(e,n)}static ofError(e){return Jt.ofError(e)}static ofPromised(e){return Jt.future(w.map(e,function(t){switch(t._hx_index){case 0:return t.data;case 1:return $.ofError(t.failure)}}))}}class He{static all(e){return w.map($.concatAll(e),function(t){switch(t._hx_index){case 1:return f.Failure(t.error);case 2:return f.Success(t.result)}})}static parse(e,t){return w.map(it.parse(e,t),function(n){switch(n._hx_index){case 0:return f.Success(new Bt(n.data,n.rest));case 1:return f.Failure(n.e);case 2:return f.Failure(n.e)}})}}He.__name__=!0;class Yt{static all(e){return w.map($.concatAll(e),function(t){return t.result})}}Yt.__name__=!0;var G=T["tink.io.ParseResult"]={__ename__:!0,__constructs__:null,Parsed:(u=function(a,e){return{_hx_index:0,data:a,rest:e,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Parsed",u.__params__=["data","rest"],u),Invalid:(u=function(a,e){return{_hx_index:1,e:a,rest:e,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Invalid",u.__params__=["e","rest"],u),Broke:(u=function(a){return{_hx_index:2,e:a,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Broke",u.__params__=["e"],u)};G.__constructs__=[G.Parsed,G.Invalid,G.Broke];class it{static doParse(e,t,n,r){let s=L.EMPTY.getCursor(),l=!0,i=function(_){return s.currentPos<s.length?_.prepend(new Fe(new g(s.right()))):_},c=function(){let _=s.flush();return _.getLength()==0?$.EMPTY:new Fe(new g(_))};return w.flatMap(e.forEach(lt.ofUnknown(function(_){return _.getLength()==0?new S(new g(M.Resume)):(s.shift(_),w.async(function(h){let o=null;o=function(){s.shift();let m=s.currentPos,y=t.progress(s);switch(y._hx_index){case 0:m!=s.currentPos&&s.currentPos<s.length?o():h(M.Resume);break;case 1:n(y.r).handle(function(x){l=x.resume,l?m!=s.currentPos&&s.currentPos<s.length?o():h(M.Resume):h(M.Finish)});break;case 2:h(M.Clog(y.e));break}},o()}))})),function(_){switch(_._hx_index){case 0:return new S(new g(G.Parsed(r(),i(_.rest))));case 1:return new S(new g(G.Invalid(_.error,i(_.at))));case 2:return new S(new g(G.Broke(_.error)));case 3:if(s.currentPos<s.length)return new S(new g(G.Parsed(r(),i(new Fe(new g(L.EMPTY))))));if(l){let h=t.eof(s);switch(h._hx_index){case 0:return w.map(n(h.data),function(o){return G.Parsed(r(),c())});case 1:return new S(new g(G.Invalid(h.failure,c())))}}else return new S(new g(G.Parsed(r(),c())));break}})}static parse(e,t){let n=null;return it.doParse(e,t,function(r){return n=r,new S(new g({resume:!1}))},function(){return n})}}class $t{constructor(){}work(e){return new S(new g(V.get(e)))}}$t.__name__=!0;class K{static ensure(e){return e??K.get()}static get(){return K.pool[B.random(K.pool.length)]}static work(e,t){return e.work(t)}}class Gt extends pe{constructor(e){super(),this.upcoming=e}forEach(e){let t=this;return w.async(function(n){t.upcoming.handle(function(r){switch(r._hx_index){case 0:let s=r.next;e(r.value).handle(function(l){switch(l._hx_index){case 0:n(A.Halted(t));break;case 1:n(A.Halted(s));break;case 2:s.forEach(e).handle(n);break;case 3:n(A.Clogged(l.e,t));break}});break;case 1:n(A.Failed(r.e));break;case 2:n(A.Depleted);break}})})}}Gt.__name__=!0;class we extends Vt{constructor(e){super(),this.target=e}consume(e,t){let n=this,r=e.forEach(lt.ofUnknown(function(s){return w.map(n.target.write(s),function(l){switch(l._hx_index){case 0:return l.data?M.Resume:M.BackOff;case 1:return M.Clog(l.failure)}})}));return t!=null&&t.end&&r.handle(function(s){n.target.end()}),w.map(r,function(s){return Wt.toResult(s,null)})}static wrap(e,t){return new we(new Xt(e,t))}}we.__name__=!0;class J extends Gt{constructor(e){super(w.async(function(t){e.read().handle(function(n){let r=t,s;switch(n._hx_index){case 0:let l=n.data;s=l==null?Se.End:Se.Link(l,new J(e));break;case 1:s=Se.Fail(n.failure);break}r(s)})},!0))}static wrap(e,t,n,r){return new J(new Kt(e,t,n,r))}}J.__name__=!0;class Kt{constructor(e,t,n,r){this.name=e,this.native=t,this.chunkSize=n;let s=w.async(function(l){t.once("end",function(){l(f.Success(null))}),t.once("error",function(i){l(f.Failure(new b(null,""+i.code+" - Failed reading from "+e+" because "+i.message,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:22,className:"tink.io.nodejs.WrappedReadable",methodName:"new"})))})});s.eager(),this.end=s,r!=null&&this.end.handle(function(){process.nextTick(r)})}read(){let e=this;return w.first(w.async(function(t){let n=null;n=function(){try{let r=e.native.read(e.chunkSize);if(r==null)e.native.once("readable",n);else{let s=typeof r=="string"?new ie(r):r;t(f.Success(new Pt(s)))}}catch(r){let s=v.caught(r).unwrap();t(f.Failure(b.withData(null,"Error while reading from "+e.name,s,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:48,className:"tink.io.nodejs.WrappedReadable",methodName:"read"})))}},n()}),this.end)}}Kt.__name__=!0;class Xt{constructor(e,t){this.name=e,this.native=t,this.ended=w.async(function(n){t.once("end",function(){n(f.Success(!1))}),t.once("finish",function(){n(f.Success(!1))}),t.once("close",function(){n(f.Success(!1))}),t.on("error",function(r){n(f.Failure(new b(null,""+r.code+": "+r.message,{fileName:"tink/io/nodejs/WrappedWritable.hx",lineNumber:24,className:"tink.io.nodejs.WrappedWritable",methodName:"new"})))})})}end(){let e=!1,t=this.ended.handle(function(){e=!0});return t?.cancel(),e?new S(new g(f.Success(!1))):(this.native.end(),E.next(this.ended,function(n){return new S(new g(f.Success(!0)))}))}write(e){let t=this;return w.first(w.async(function(n){if(e.getLength()==0){n(f.Success(!0));return}let r;if(ie.isBuffer(e.buffer))r=e.buffer;else{let c=e.toBytes(),_=c.b;r=ie.from(_.buffer,_.byteOffset,c.length)}let s=n,l=f.Success(!0),i=function(){s(l)};t.native.write(r,null,i)}),this.ended)}}Xt.__name__=!0;class dn{static flush(e){return e.join("&")}}class Zt{constructor(){}stringify(e){let t=[];return this.process0("",t,e),dn.flush(t)}process0(e,t,n){let r=n.file;t.push(tn.ofString(e==""?"file":e+".file")+"="+tn.ofString(r))}}Zt.__name__=!0;class Jt{static future(e){return new en(e)}static ofError(e){return new Qt(e)}}class ue extends pe{constructor(e){super(),this.parts=e}get_depleted(){switch(this.parts.length){case 0:return!0;case 1:return this.parts[0].get_depleted();default:return!1}}decompose(e){let t=0,n=this.parts;for(;t<n.length;)n[t++].decompose(e)}forEach(e){let t=this.parts,n=e;return w.async(function(r){ue.consumeParts(t,n,r)})}static consumeParts(e,t,n){e.length==0?n(A.Depleted):e[0].forEach(t).handle(function(r){switch(r._hx_index){case 0:e=e.slice(),e[0]=r.rest,n(A.Halted(new ue(e)));break;case 1:let s=r.at;s.get_depleted()?e=e.slice(1):(e=e.slice(),e[0]=s),n(A.Clogged(r.error,new ue(e)));break;case 2:n(A.Failed(r.error));break;case 3:ue.consumeParts(e.slice(1),t,n);break}})}static of(e){let t=[],n=0;for(;n<e.length;)e[n++].decompose(t);return t.length==0?Ee.inst:new ue(t)}}ue.__name__=!0;var M=T["tink.streams.Handled"]={__ename__:!0,__constructs__:null,BackOff:{_hx_name:"BackOff",_hx_index:0,__enum__:"tink.streams.Handled",toString:d},Finish:{_hx_name:"Finish",_hx_index:1,__enum__:"tink.streams.Handled",toString:d},Resume:{_hx_name:"Resume",_hx_index:2,__enum__:"tink.streams.Handled",toString:d},Clog:(u=function(a){return{_hx_index:3,e:a,__enum__:"tink.streams.Handled",toString:d}},u._hx_name="Clog",u.__params__=["e"],u)};M.__constructs__=[M.BackOff,M.Finish,M.Resume,M.Clog];var A=T["tink.streams.Conclusion"]={__ename__:!0,__constructs__:null,Halted:(u=function(a){return{_hx_index:0,rest:a,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Halted",u.__params__=["rest"],u),Clogged:(u=function(a,e){return{_hx_index:1,error:a,at:e,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Clogged",u.__params__=["error","at"],u),Failed:(u=function(a){return{_hx_index:2,error:a,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Failed",u.__params__=["error"],u),Depleted:{_hx_name:"Depleted",_hx_index:3,__enum__:"tink.streams.Conclusion",toString:d}};A.__constructs__=[A.Halted,A.Clogged,A.Failed,A.Depleted];var We=T["tink.streams.ReductionStep"]={__ename__:!0,__constructs__:null,Progress:(u=function(a){return{_hx_index:0,result:a,__enum__:"tink.streams.ReductionStep",toString:d}},u._hx_name="Progress",u.__params__=["result"],u),Crash:(u=function(a){return{_hx_index:1,e:a,__enum__:"tink.streams.ReductionStep",toString:d}},u._hx_name="Crash",u.__params__=["e"],u)};We.__constructs__=[We.Progress,We.Crash];var xe=T["tink.streams.Reduction"]={__ename__:!0,__constructs__:null,Crashed:(u=function(a,e){return{_hx_index:0,error:a,at:e,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Crashed",u.__params__=["error","at"],u),Failed:(u=function(a){return{_hx_index:1,error:a,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Failed",u.__params__=["error"],u),Reduced:(u=function(a){return{_hx_index:2,result:a,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Reduced",u.__params__=["result"],u)};xe.__constructs__=[xe.Crashed,xe.Failed,xe.Reduced];class Qt extends pe{constructor(e){super(),this.error=e}forEach(e){return new S(new g(A.Failed(this.error)))}}Qt.__name__=!0;class Fe extends pe{constructor(e){super(),this.value=e}forEach(e){let t=this;return w.map(e(V.get(this.value)),function(n){switch(n._hx_index){case 0:return A.Halted(t);case 1:return A.Halted(Ee.inst);case 2:return A.Depleted;case 3:return A.Clogged(n.e,t)}})}}Fe.__name__=!0;class lt{static ofUnknown(e){return e}}class mn{static ofSafeSync(e){return function(t,n){return new S(new g(e(t,n)))}}}class en extends pe{constructor(e){super(),this.f=e}forEach(e){let t=this;return w.async(function(n){t.f.handle(function(r){r.forEach(e).handle(n)})})}}en.__name__=!0;var Se=T["tink.streams.Step"]={__ename__:!0,__constructs__:null,Link:(u=function(a,e){return{_hx_index:0,value:a,next:e,__enum__:"tink.streams.Step",toString:d}},u._hx_name="Link",u.__params__=["value","next"],u),Fail:(u=function(a){return{_hx_index:1,e:a,__enum__:"tink.streams.Step",toString:d}},u._hx_name="Fail",u.__params__=["e"],u),End:{_hx_name:"End",_hx_index:2,__enum__:"tink.streams.Step",toString:d}};Se.__constructs__=[Se.Link,Se.Fail,Se.End];class at{static _new(e,t){let n;if(t==null)n=e;else{if(t>65535||t<=0)throw v.thrown("Invalid port");n=""+e+":"+t}return n}static get_name(e){if(e==null)return null;{let t=e.split("]");switch(t.length){case 1:return t[0].split(":")[0];case 2:return t[0]+"]";default:throw v.thrown("assert")}}}static get_port(e){if(e==null)return null;{let t=e.split("]");switch(t.length){case 1:let n=t[0].split(":")[1];return n==null?null:B.parseInt(n);case 2:let r=t[1].split(":")[1];return r==null?null:B.parseInt(r);default:throw v.thrown("assert")}}}}class Te{static join(e,t){if(t=="")return e;if(t.charAt(0)=="/")return t;if(e.charAt(e.length-1)=="/")return Te.ofString(e+t);{let n=e.lastIndexOf("/");return n==-1?t:Te.ofString(F.substr(e,0,n+1)+(t??"null"))}}static ofString(e){return Te.normalize(e)}static normalize(e){if(e=H.trim(H.replace(e,"\\","/")),e==".")return"./";let t=e.endsWith("/..")||e.endsWith("/")||e.endsWith("/."),n=[],r=e.startsWith("/"),s=0,l=0,i=e.split("/");for(;l<i.length;){let c=H.trim(i[l++]);switch(c){case"":break;case".":break;case"..":n.pop()==null&&++s;break;default:n.push(c)}}if(r)n.unshift("");else{let c=0,_=s;for(;c<_;)++c,n.unshift("..")}return t&&n.push(""),n.join("/")}}class tn{static ofString(e){return e==null?"":encodeURIComponent(e)}}function nn(a){return a instanceof Array?new gt(a):a.iterator()}function rn(a,e){if(e==null)return null;e.__id__==null&&(e.__id__=ut.$haxeUID++);var t;return a.hx__closures__==null?a.hx__closures__={}:t=a.hx__closures__[e.__id__],t==null&&(t=e.bind(a),a.hx__closures__[e.__id__]=t),t}ut.$haxeUID|=0,typeof performance<"u"&&typeof performance.now=="function"&&(F.now=performance.now.bind(performance)),String.fromCodePoint==null&&(String.fromCodePoint=function(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)}),String.__name__=!0,Array.__name__=!0,se.__toStr={}.toString,_e.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_e.BYTES=I.ofString(_e.CHARS),Ae.EMPTY=new I(new ArrayBuffer(0)),L.EMPTY=new Ae,k.depth=0,le._hx_skip_constructor=!1,W._hx_skip_constructor=!1,w.NEVER_INST=new W,V.NOISE=new g(null),E.NOISE=new S(new g(f.Success(null))),ee.cache=new ht,Z._hx_skip_constructor=!1,Y._hx_skip_constructor=!1,Ee.inst=new Ee,$.EMPTY=Ee.inst,K.EAGER=new $t,K.pool=[K.EAGER],Le.main()})(global);
