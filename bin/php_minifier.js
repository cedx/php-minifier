#!/usr/bin/env node
(function(ut){"use strict";var d=function(){return ie.__string_rec(this,"")},C=C||{},u;class De{constructor(e,t){this.r=new RegExp(e,t.split("u").join(""))}match(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,this.r.m!=null}matched(e){if(this.r.m!=null&&e>=0&&e<this.r.m.length)return this.r.m[e];throw E.thrown("EReg::matched")}}De.__name__=!0;class F{static cca(e,t){let n=e.charCodeAt(t);if(n==n)return n}static substr(e,t,n){if(n==null)n=e.length;else if(n<0)if(t==0)n=e.length+n;else return"";return e.substr(t,n)}static now(){return Date.now()}}F.__name__=!0;class Ie{static fold(e,t,n){let r=rn(e);for(;r.hasNext();)n=t(r.next(),n);return n}static find(e,t){let n=rn(e);for(;n.hasNext();){let r=n.next();if(t(r))return r}return null}}Ie.__name__=!0,Math.__name__=!0;class U{static field(e,t){try{return e[t]}catch{return null}}static fields(e){let t=[];if(e!=null){let r=Object.prototype.hasOwnProperty;for(var n in e)n!="__id__"&&n!="hx__closures__"&&r.call(e,n)&&t.push(n)}return t}static compare(e,t){return e==t?0:e>t?1:-1}static isEnumValue(e){return e!=null?e.__enum__!=null:!1}static copy(e){if(e==null)return null;let t={},n=0,r=U.fields(e);for(;n<r.length;){let s=r[n];++n,t[s]=U.field(e,s)}return t}}U.__name__=!0;class B{static string(e){return ie.__string_rec(e,"")}static parseInt(e){let t=parseInt(e);return isNaN(t)?null:t}static random(e){return e<=0?0:Math.floor(Math.random()*e)}}B.__name__=!0;class $e{constructor(){this.b=""}}$e.__name__=!0;class O{static isSpace(e,t){let n=F.cca(e,t);return n>8&&n<14?!0:n==32}static ltrim(e){let t=e.length,n=0;for(;n<t&&O.isSpace(e,n);)++n;return n>0?F.substr(e,n,t-n):e}static rtrim(e){let t=e.length,n=0;for(;n<t&&O.isSpace(e,t-n-1);)++n;return n>0?F.substr(e,0,t-n):e}static trim(e){return O.ltrim(O.rtrim(e))}static lpad(e,t,n){if(t.length<=0)return e;let r="";for(n-=e.length;r.length<n;)r+=t==null?"null":""+t;return r+=e==null?"null":""+e,r}static replace(e,t,n){return e.split(t).join(n)}}O.__name__=!0;class ct{static systemName(){let e=process.platform;switch(e){case"darwin":return"Mac";case"freebsd":return"BSD";case"linux":return"Linux";case"win32":return"Windows";default:return e}}}ct.__name__=!0;class Ge{static enumParameters(e){let n=C[e.__enum__].__constructs__[e._hx_index].__params__;if(n!=null){let r=[],s=0;for(;s<n.length;){let i=n[s];++s,r.push(e[i])}return r}else return[]}}Ge.__name__=!0;class ee{static absolutePath(e){return T.isAbsolute(e)?e:T.join([T.addTrailingSlash(process.cwd()),e])}static isDirectory(e){let t=new Be;return Ne.stat(e,function(n,r){t.trigger(n==null&&r.isDirectory())}),t}static mkdir(e){return x.async(function(t){Ne.mkdir(e,function(n){t(n==null||n.code=="EEXIST"?h.Success(null):h.Failure(P.withData(500,n.message,n,{fileName:"asys/FileSystem.hx",lineNumber:92,className:"asys.FileSystem",methodName:"mkdir"})))})})}static createDirectory(e){let t=x.async(function(n){ee.isDirectory(e).handle(function(r){r?n(h.Success(null)):ee.mkdir(e).handle(function(s){s._hx_index==1&&s.failure.data.code=="ENOENT"?N.next(ee.createDirectory(cn.dirname(e)),function(i){return ee.mkdir(e)}).handle(n):n(s)})})});return t.eager(),t}}ee.__name__=!0;class _t{static saveContent(e,t){let n=new Be;return Ne.writeFile(e,t,"utf8",function(r){n.trigger(r==null?h.Success(null):h.Failure(P.withData(null,r.message,r,{fileName:"asys/io/File.hx",lineNumber:53,className:"asys.io.File",methodName:"saveContent"})))}),n}}_t.__name__=!0;class Xe{constructor(e,t){this.exitTrigger=new Be,this.process=wt.spawn(e,t),this.stdin=we.wrap("stdin",this.process.stdin);let n=null;n={},this.stderr=J.wrap("stderr",this.process.stderr,n.chunkSize,n.onEnd);let r=null;r={},this.stdout=J.wrap("stdout",this.process.stdout,r.chunkSize,r.onEnd);let s=this;this.process.on("exit",function(i,l){s.exitTrigger.trigger(i)})}exitCode(){return this.exitTrigger}close(){}kill(){this.process.kill()}}Xe.__name__=!0;var ye=C["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:d},Module:(u=function(a){return{_hx_index:1,m:a,__enum__:"haxe.StackItem",toString:d}},u._hx_name="Module",u.__params__=["m"],u),FilePos:(u=function(a,e,t,n){return{_hx_index:2,s:a,file:e,line:t,column:n,__enum__:"haxe.StackItem",toString:d}},u._hx_name="FilePos",u.__params__=["s","file","line","column"],u),Method:(u=function(a,e){return{_hx_index:3,classname:a,method:e,__enum__:"haxe.StackItem",toString:d}},u._hx_name="Method",u.__params__=["classname","method"],u),LocalFunction:(u=function(a){return{_hx_index:4,v:a,__enum__:"haxe.StackItem",toString:d}},u._hx_name="LocalFunction",u.__params__=["v"],u)};ye.__constructs__=[ye.CFunction,ye.Module,ye.FilePos,ye.Method,ye.LocalFunction];class E extends Error{constructor(e,t,n){super(e),this.message=e,this.__previousException=t,this.__nativeException=n??this}unwrap(){return this.__nativeException}get_native(){return this.__nativeException}static caught(e){return e instanceof E?e:e instanceof Error?new E(e.message,null,e):new Ke(e,null,e)}static thrown(e){return e instanceof E?e.get_native():e instanceof Error?e:new Ke(e)}}E.__name__=!0;class Le{constructor(e){let t=this;this.id=setInterval(function(){t.run()},e)}stop(){this.id!=null&&(clearInterval(this.id),this.id=null)}run(){}static delay(e,t){let n=new Le(t);return n.run=function(){n.stop(),e()},n}}Le.__name__=!0;class Ke extends E{constructor(e,t,n){super(String(e),t,n),this.value=e}unwrap(){return this.value}}Ke.__name__=!0;class I{constructor(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}blit(e,t,n,r){if(e<0||n<0||r<0||e+r>this.length||n+r>t.length)throw E.thrown(se.OutsideBounds);n==0&&r==t.b.byteLength?this.b.set(t.b,e):this.b.set(t.b.subarray(n,n+r),e)}sub(e,t){if(e<0||t<0||e+t>this.length)throw E.thrown(se.OutsideBounds);return new I(this.b.buffer.slice(e+this.b.byteOffset,e+this.b.byteOffset+t))}getString(e,t,n){if(e<0||t<0||e+t>this.length)throw E.thrown(se.OutsideBounds);n==null&&(n=Pe.UTF8);let r="",s=this.b,i=e,l=e+t;switch(n._hx_index){case 0:for(;i<l;){let c=s[i++];if(c<128){if(c==0)break;r+=String.fromCodePoint(c)}else if(c<224){let _=(c&63)<<6|s[i++]&127;r+=String.fromCodePoint(_)}else if(c<240){let _=(c&31)<<12|(s[i++]&127)<<6|s[i++]&127;r+=String.fromCodePoint(_)}else{let _=(c&15)<<18|(s[i++]&127)<<12|(s[i++]&127)<<6|s[i++]&127;r+=String.fromCodePoint(_)}}break;case 1:for(;i<l;){let c=s[i++]|s[i++]<<8;r+=String.fromCodePoint(c)}break}return r}toString(){return this.getString(0,this.length)}static ofString(e,t){if(t==Pe.RawNative){let s=new Uint8Array(e.length<<1),i=0,l=e.length;for(;i<l;){let c=i++,_=e.charCodeAt(c);s[c<<1]=_&255,s[c<<1|1]=_>>8}return new I(s.buffer)}let n=[],r=0;for(;r<e.length;){let s=e.charCodeAt(r++);55296<=s&&s<=56319&&(s=s-55232<<10|e.charCodeAt(r++)&1023),s<=127?n.push(s):s<=2047?(n.push(192|s>>6),n.push(128|s&63)):s<=65535?(n.push(224|s>>12),n.push(128|s>>6&63),n.push(128|s&63)):(n.push(240|s>>18),n.push(128|s>>12&63),n.push(128|s>>6&63),n.push(128|s&63))}return new I(new Uint8Array(n).buffer)}static ofData(e){let t=e.hxBytes;return t??new I(e)}}I.__name__=!0;var Pe=C["haxe.io.Encoding"]={__ename__:!0,__constructs__:null,UTF8:{_hx_name:"UTF8",_hx_index:0,__enum__:"haxe.io.Encoding",toString:d},RawNative:{_hx_name:"RawNative",_hx_index:1,__enum__:"haxe.io.Encoding",toString:d}};Pe.__constructs__=[Pe.UTF8,Pe.RawNative];class oe{static encode(e,t){t==null&&(t=!0);let n=new ot(oe.BYTES).encodeBytes(e).toString();if(t)switch(e.length%3){case 1:n+="==";break;case 2:n+="=";break;default:}return n}}oe.__name__=!0;class ot{constructor(e){let t=e.length,n=1;for(;t>1<<n;)++n;if(n>8||t!=1<<n)throw E.thrown("BaseCode : base length must be a power of two.");this.base=e,this.nbits=n}encodeBytes(e){let t=this.nbits,n=this.base,r=e.length*8/t|0,s=new I(new ArrayBuffer(r+(e.length*8%t==0?0:1))),i=0,l=0,c=(1<<t)-1,_=0,f=0;for(;f<r;){for(;l<t;)l+=8,i<<=8,i|=e.b[_++];l-=t,s.b[f++]=n.b[i>>l&c]}return l>0&&(s.b[f++]=n.b[i<<t-l&c]),s}}ot.__name__=!0;class ht{constructor(){}set(e,t){this.root=this.setLoop(e,t,this.root)}get(e){let t=this.root;for(;t!=null;){let n=this.compare(e,t.key);if(n==0)return t.value;n<0?t=t.left:t=t.right}return null}exists(e){let t=this.root;for(;t!=null;){let n=this.compare(e,t.key);if(n==0)return!0;n<0?t=t.left:t=t.right}return!1}setLoop(e,t,n){if(n==null)return new j(null,e,t,null);let r=this.compare(e,n.key);if(r==0)return new j(n.left,e,t,n.right,n==null?0:n._height);if(r<0)return this.balance(this.setLoop(e,t,n.left),n.key,n.value,n.right);{let s=this.setLoop(e,t,n.right);return this.balance(n.left,n.key,n.value,s)}}balance(e,t,n,r){let s=e==null?0:e._height,i=r==null?0:r._height;if(s>i+2){let l=e.left,c=e.right;return(l==null?0:l._height)>=(c==null?0:c._height)?new j(e.left,e.key,e.value,new j(e.right,t,n,r)):new j(new j(e.left,e.key,e.value,e.right.left),e.right.key,e.right.value,new j(e.right.right,t,n,r))}else if(i>s+2){let l=r.right,c=r.left;return(l==null?0:l._height)>(c==null?0:c._height)?new j(new j(e,t,n,r.left),r.key,r.value,r.right):new j(new j(e,t,n,r.left.left),r.left.key,r.left.value,new j(r.left.right,r.key,r.value,r.right))}else return new j(e,t,n,r,(s>i?s:i)+1)}compare(e,t){return U.compare(e,t)}}ht.__name__=!0;class j{constructor(e,t,n,r,s){if(s==null&&(s=-1),this.left=e,this.key=t,this.value=n,this.right=r,s==-1){let i,l=this.left,c=this.right;if((l==null?0:l._height)>(c==null?0:c._height)){let _=this.left;i=_==null?0:_._height}else{let _=this.right;i=_==null?0:_._height}this._height=i+1}else this._height=s}}j.__name__=!0;class ft extends ht{constructor(){super()}compare(e,t){let n=e._hx_index-t._hx_index;if(n!=0)return n;let r=Ge.enumParameters(e),s=Ge.enumParameters(t);return r.length==0&&s.length==0?0:this.compareArgs(r,s)}compareArgs(e,t){let n=e.length-t.length;if(n!=0)return n;let r=0,s=e.length;for(;r<s;){let i=r++,l=this.compareArg(e[i],t[i]);if(l!=0)return l}return 0}compareArg(e,t){return U.isEnumValue(e)&&U.isEnumValue(t)?this.compare(e,t):e instanceof Array&&t instanceof Array?this.compareArgs(e,t):U.compare(e,t)}}ft.__name__=!0;var re=C["haxe.ds.Option"]={__ename__:!0,__constructs__:null,Some:(u=function(a){return{_hx_index:0,v:a,__enum__:"haxe.ds.Option",toString:d}},u._hx_name="Some",u.__params__=["v"],u),None:{_hx_name:"None",_hx_index:1,__enum__:"haxe.ds.Option",toString:d}};re.__constructs__=[re.Some,re.None];class dt{constructor(){this.h=Object.create(null)}}dt.__name__=!0;class mt{constructor(e){this.url=e,this.headers=[],this.params=[],this.emptyOnData=sn(this,this.onData)}setHeader(e,t){let n=0,r=this.headers.length;for(;n<r;){let s=n++;if(this.headers[s].name==e){this.headers[s]={name:e,value:t};return}}this.headers.push({name:e,value:t})}setPostData(e){this.postData=e,this.postBytes=null}onData(e){}onBytes(e){}onError(e){}onStatus(e){}hasOnData(){return sn(this,this.onData)!=this.emptyOnData}success(e){this.responseBytes=e,this.responseAsString=null,this.hasOnData()&&this.onData(this.get_responseData()),this.onBytes(this.responseBytes)}get_responseData(){return this.responseAsString==null&&this.responseBytes!=null&&(this.responseAsString=this.responseBytes.getString(0,this.responseBytes.length,Pe.UTF8)),this.responseAsString}}mt.__name__=!0;class gt extends mt{constructor(e){super(e)}request(e){this.responseAsString=null,this.responseBytes=null,this.responseHeaders=null;let t=new _n(this.url),n=t.protocol=="https:",r=t.hostname,s=t.pathname,i=t.port!=null?B.parseInt(t.port):n?443:80,l={},c=0,_=this.headers;for(;c<_.length;){let v=_[c];++c;let R=U.field(l,v.name);R==null&&(R=[],l[v.name]=R),R.push(v.value)}(this.postData!=null||this.postBytes!=null)&&(e=!0);let f=null,o=0,m=this.params;for(;o<m.length;){let v=m[o];++o,f==null?f="":f+="&";let R=v.name,K=encodeURIComponent(R)+"=",Q=v.value;f+=K+encodeURIComponent(Q)}let S=s.split("?").length<=1;f!=null&&(s+=(S?"?":"&")+f);let g={protocol:t.protocol,hostname:r,port:i,method:e?"POST":"GET",path:s,headers:l},p=this,y=function(v){v.setEncoding("binary");let R=v.statusCode;R!=null&&p.onStatus(R);let K=[];v.on("data",function(Q){K.push(le.from(Q,"binary"))}),v.on("end",function(Q){let ke=K.length==1?K[0]:le.concat(K),_e=ke.buffer.slice(ke.byteOffset,ke.byteOffset+ke.byteLength);p.responseBytes=I.ofData(_e),p.req=null,p.responseHeaders=new dt;let be=0,Ye=U.fields(v.headers);for(;be<Ye.length;){let Ce=Ye[be];++be,p.responseHeaders.h[Ce]=U.field(v.headers,Ce)}R!=null&&R>=200&&R<400?p.success(p.responseBytes):p.onError("Http Error #"+R)})};this.req=n?St.request(g,y):xt.request(g,y),e&&(this.postData!=null?this.req.write(this.postData):this.postBytes!=null&&(this.req.setHeader("Content-Length",""+this.postBytes.length),this.req.write(le.from(this.postBytes.b.bufferValue)))),this.req.end()}}gt.__name__=!0;var se=C["haxe.io.Error"]={__ename__:!0,__constructs__:null,Blocked:{_hx_name:"Blocked",_hx_index:0,__enum__:"haxe.io.Error",toString:d},Overflow:{_hx_name:"Overflow",_hx_index:1,__enum__:"haxe.io.Error",toString:d},OutsideBounds:{_hx_name:"OutsideBounds",_hx_index:2,__enum__:"haxe.io.Error",toString:d},Custom:(u=function(a){return{_hx_index:3,e:a,__enum__:"haxe.io.Error",toString:d}},u._hx_name="Custom",u.__params__=["e"],u)};se.__constructs__=[se.Blocked,se.Overflow,se.OutsideBounds,se.Custom];class T{constructor(e){switch(e){case".":case"..":this.dir=e,this.file="";return}let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");t<n?(this.dir=F.substr(e,0,n),e=F.substr(e,n+1,null),this.backslash=!0):n<t?(this.dir=F.substr(e,0,t),e=F.substr(e,t+1,null)):this.dir=null;let r=e.lastIndexOf(".");r!=-1?(this.ext=F.substr(e,r+1,null),this.file=F.substr(e,0,r)):(this.ext=null,this.file=e)}static directory(e){let t=new T(e);return t.dir==null?"":t.dir}static extension(e){let t=new T(e);return t.ext==null?"":t.ext}static join(e){let t=[],n=0;for(;n<e.length;){let l=e[n];++n,l!=null&&l!=""&&t.push(l)}if(t.length==0)return"";let r=t[0],s=1,i=t.length;for(;s<i;)r=T.addTrailingSlash(r),r+=t[s++];return T.normalize(r)}static normalize(e){let t="/";if(e=e.split("\\").join(t),e==t)return t;let n=[],r=0,s=e.split(t);for(;r<s.length;){let o=s[r];++r,o==".."&&n.length>0&&n[n.length-1]!=".."?n.pop():o==""?(n.length>0||F.cca(e,0)==47)&&n.push(o):o!="."&&n.push(o)}let i="",l=!1,c=!1,_=0,f=n.join(t);for(;_<f.length;){let o=f,m=_++,S=o.charCodeAt(m);S>=55296&&S<=56319&&(S=S-55232<<10|o.charCodeAt(m+1)&1023);let g=S;g>=65536&&++_;let p=g;switch(p){case 47:if(!l)c=!0;else{let v=p;l=!1,c&&(i+="/",c=!1),i+=String.fromCodePoint(v)}break;case 58:i+=":",l=!0;break;default:let y=p;l=!1,c&&(i+="/",c=!1),i+=String.fromCodePoint(y)}}return i}static addTrailingSlash(e){if(e.length==0)return"/";let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return t<n?n!=e.length-1?e+"\\":e:t!=e.length-1?e+"/":e}static isAbsolute(e){return!!(e.startsWith("/")||e.charAt(1)==":"||e.startsWith("\\\\"))}}T.__name__=!0;class pt{constructor(e){this.current=0,this.array=e}hasNext(){return this.current<this.array.length}next(){return this.array[this.current++]}}pt.__name__=!0;class an{static fromCode(e){switch(e){case 100:return"Continue";case 101:return"Switching Protocols";case 102:return"Processing";case 200:return"OK";case 201:return"Created";case 202:return"Accepted";case 203:return"Non-Authoritative Information";case 204:return"No Content";case 205:return"Reset Content";case 206:return"Partial Content";case 207:return"Multi-Status";case 208:return"Already Reported";case 226:return"IM Used";case 300:return"Multiple Choices";case 301:return"Moved Permanently";case 302:return"Found";case 303:return"See Other";case 304:return"Not Modified";case 305:return"Use Proxy";case 306:return"Switch Proxy";case 307:return"Temporary Redirect";case 308:return"Permanent Redirect";case 400:return"Bad Request";case 401:return"Unauthorized";case 402:return"Payment Required";case 403:return"Forbidden";case 404:return"Not Found";case 405:return"Method Not Allowed";case 406:return"Not Acceptable";case 407:return"Proxy Authentication Required";case 408:return"Request Timeout";case 409:return"Conflict";case 410:return"Gone";case 411:return"Length Required";case 412:return"Precondition Failed";case 413:return"Payload Too Large";case 414:return"URI Too Long";case 415:return"Unsupported Media Type";case 416:return"Range Not Satisfiable";case 417:return"Expectation Failed";case 418:return"I'm a teapot";case 421:return"Misdirected Request";case 422:return"Unprocessable Entity";case 423:return"Locked";case 424:return"Failed Dependency";case 426:return"Upgrade Required";case 428:return"Precondition Required";case 429:return"Too Many Requests";case 431:return"Request Header Fields Too Large";case 451:return"Unavailable For Legal Reasons";case 500:return"Internal Server Error";case 501:return"Not Implemented";case 502:return"Bad Gateway";case 503:return"Service Unavailable";case 504:return"Gateway Timeout";case 505:return"HTTP Version Not Supported";case 506:return"Variant Also Negotiates";case 507:return"Insufficient Storage";case 508:return"Loop Detected";case 510:return"Not Extended";case 511:return"Network Authentication Required";default:return"Unknown Status"}}}class ie{static __string_rec(e,t){if(e==null)return"null";if(t.length>=5)return"<...>";let n=typeof e;switch(n=="function"&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e.__enum__){let _=C[e.__enum__].__constructs__[e._hx_index],f=_._hx_name;return _.__params__?(t=t+"	",f+"("+function(o){var m;let S=[];{let g=0,p=_.__params__;for(;g<p.length;){let y=p[g];g=g+1,S.push(ie.__string_rec(e[y],t))}}return m=S,m}(this).join(",")+")"):f}if(e instanceof Array){let c="[";t+="	";let _=0,f=e.length;for(;_<f;){let o=_++;c+=(o>0?",":"")+ie.__string_rec(e[o],t)}return c+="]",c}let r;try{r=e.toString}catch{return"???"}if(r!=null&&r!=Object.toString&&typeof r=="function"){let c=e.toString();if(c!="[object Object]")return c}let s=`{
`;t+="	";let i=e.hasOwnProperty!=null,l=null;for(l in e)i&&!e.hasOwnProperty(l)||l=="prototype"||l=="__class__"||l=="__super__"||l=="__interfaces__"||l=="__properties__"||(s.length!=2&&(s+=`, 
`),s+=t+l+" : "+ie.__string_rec(e[l],t));return t=t.substring(1),s+=`
`+t+"}",s;case"string":return e;default:return String(e)}}}ie.__name__=!0;var wt=require("child_process"),Ne=require("fs"),xt=require("http"),St=require("https"),un=require("net"),cn=require("path"),le=require("buffer").Buffer;class kt{static bytesOfBuffer(e){let t=Object.create(I.prototype);return t.length=e.byteLength,t.b=e,e.bufferValue=e,e.hxBytes=t,e.bytes=e,t}}kt.__name__=!0;var _n=require("url").URL;class bt{constructor(e){e==null&&(e="php"),this.process=null,this.port=-1,this.executable=T.normalize(e)}close(){let e=this.process;return e?.kill(),this.process=null,N.NOISE}transform(e){let t=this;return N.next(N.next(this.listen(),function(n){let r=new Jt().stringify({file:ee.absolutePath(e)});return hn.all(te.fetch(q.fromString("http://127.0.0.1:"+t.port+"/index.php?"+r),null))}),function(n){return new k(new w(h.Success(n.body.toString())))})}getPort(){let e=un.createServer();e.unref();let t=new Be;return e.on("error",function(n){let r=P.withData(503,"Unable to find an ephemeral TCP port.",n,{fileName:"src/php_minifier/FastTransformer.hx",lineNumber:51,className:"php_minifier.FastTransformer",methodName:"getPort"});return t.trigger(h.Failure(r))}),e.listen(0,"127.0.0.1",function(){let n=e.address().port;e.close(function(){t.trigger(h.Success(n))})}),t}listen(){let e=this;return this.process!=null?N.NOISE:N.next(this.getPort(),function(t){e.port=t;let n=e.executable,r="127.0.0.1:"+e.port,s=T.join([__dirname,"../www"]);return e.process=new Xe(n,["-S",r,"-t",s]),x.map(x.delay(1e3,V.NOISE),h.Success)})}}bt.__name__=!0;class ve{static get_packageVersion(){return ve.packageVersion==null&&(ve.packageVersion="1.0.2"),ve.packageVersion}}ve.__name__=!0;class qe{constructor(){this.version=!1,this.help=!1,this.silent=!1,this.mode="safe",this.extension="php",this.binary="php"}run(e){if(this.help||this.version){let o=this.version?ve.get_packageVersion():new Et().format(Ee.get());return process.stdout.write(B.string(o)),process.stdout.write(`
`),new k(new w(h.Success(null)))}let t=process.env.HAXELIB_RUN=="1";if(e.length<(t?2:1))return new k(new w(h.Failure(new P(400,"You must provide the path to the input directory.",{fileName:"src/php_minifier/Program.hx",lineNumber:56,className:"php_minifier.Program",methodName:"run"}))));let n=t?e.pop():T.addTrailingSlash(process.cwd()),r=this.resolvePath(e.shift(),n);if(!Ze.exists(r))return new k(new w(h.Failure(new P(404,"The input directory was not found.",{fileName:"src/php_minifier/Program.hx",lineNumber:60,className:"php_minifier.Program",methodName:"run"}))));let s=T.addTrailingSlash(r).length,i=e.length>0?this.resolvePath(e.shift(),n):r,l=this.listDirectory(r),c=new Array(l.length),_=0,f=l.length;for(;_<f;){let o=_++;c[o]=l[o].substring(s)}return this.processFiles(r,i,c)}listDirectory(e){let t=[],n=0,r=Ne.readdirSync(e);for(;n<r.length;){let s=r[n];++n;let i=T.join([e,s]);Ze.isDirectory(i)?t=t.concat(this.listDirectory(i)):T.extension(s).toLowerCase()==this.extension&&t.push(i)}return t}processFiles(e,t,n){let r=ct.systemName()=="Windows",s=this.mode=="fast"?new bt(this.binary):new yt(this.binary),i=this,l=new Array(n.length),c=0,_=n.length;for(;c<_;){let f=c++,o=n[f],m=function(g){if(!i.silent){let p=r?O.replace(o,"/","\\"):o;process.stdout.write(B.string("Minifying: "+p)),process.stdout.write(`
`)}},S=function(g){g._hx_index==0&&b.invoke(m,g.data)};l[f]=N.next(x.map(N.NOISE,function(g){return b.invoke(S,g),g}),function(g){return N.next(s.transform(T.join([e,o])),function(p){let y=T.join([t,o]);return N.next(ee.createDirectory(T.directory(y)),function(v){return _t.saveContent(y,p)})})})}return N.next(N.inSequence(l),function(f){return s.close()})}resolvePath(e,t){return T.isAbsolute(e)?T.normalize(e):T.join([t,e])}static main(){new vt(new qe,new Tt(5)).process(process.argv.slice(2)).handle(Pt.exit)}}qe.__name__=!0;class yt{constructor(e){e==null&&(e="php"),this.executable=T.normalize(e)}close(){return N.NOISE}transform(e){let t=new Xe(this.executable,["-w",ee.absolutePath(e)]);return N.next(x.flatMap(t.exitCode(),function(n){return n==0?He.all(t.stdout):new k(new w(h.Failure(new P(null,"The PHP process exited with a "+n+" code.",{fileName:"src/php_minifier/SafeTransformer.hx",lineNumber:24,className:"php_minifier.SafeTransformer",methodName:"transform"}))))}),function(n){return t.close(),new k(new w(h.Success(n.toString())))})}}yt.__name__=!0;class Ze{static exists(e){try{return Ne.accessSync(e),!0}catch{return!1}}static isDirectory(e){try{return Ne.statSync(e).isDirectory()}catch{return!1}}}Ze.__name__=!0;class Me{getCursor(){return this.flattened==null&&this.flatten(this.flattened=[]),je.create(this.flattened.slice())}flatten(e){}}Me.__name__=!0;class Ae extends Me{constructor(){super()}getLength(){return 0}blitTo(e,t){}toString(){return""}toBytes(){return Ae.EMPTY}}Ae.__name__=!0;class L{static concat(e,t){return z.cons(e,t)}static join(e){if(e==null)return L.EMPTY;switch(e.length){case 0:return L.EMPTY;case 1:return e[0];default:let t=L.concat(e[0],e[1]),n=2,r=e.length;for(;n<r;)t=L.concat(t,e[n++]);return t}}}class Pt{static exit(e){switch(e._hx_index){case 0:process.exit(0);break;case 1:let t=e.failure,n=t.message;t.data!=null&&(n+=", "+(t.data==null?"null":B.string(t.data))),process.stdout.write(B.string(n)),process.stdout.write(`
`);let r=t.code;process.exit(r);break}}}Pt.__name__=!0;class q{static resolve(e,t){if(t.scheme!=null)return t;if(t.hosts[0]!=null){if(t.scheme!=null)return t;{let n=U.copy(t);return n.scheme=e.scheme,n}}else{let n={path:Te.join(e.path,t.path),payload:"",scheme:e.scheme,query:t.query,auth:e.auth,hosts:e.hosts,hash:t.hash};return q.makePayload(n),n}}static makePayload(e){let t="",n=e.auth,r=e.hosts;n==null?r.length!=0&&(t="//"+r.join(",")):r.length==0?t="//"+(n==null?"null":n==null?"":""+n+"@"):t="//"+(n==null?"null":n==null?"":""+n+"@")+r.join(","),t+=e.path==null?"null":e.path;let s=e.query;s!=null&&(t+="?"+(s??"null"));let i=e.hash;i!=null&&(t+="#"+i),e.payload=t.toString()}static toString(e){return e.scheme==null?e.payload:""+e.scheme+":"+e.payload}static fromString(e){return q.parse(e)}static noop(e){}static parse(e,t){for(;;){if(e==null){e="",t=null;continue}if(t==null&&(t=q.noop),e=O.trim(e),e.startsWith("data:"))return{scheme:"data",payload:F.substr(e,5,null),hosts:[]};let n=new De("^(([a-zA-Z][a-zA-Z0-9\\-+.]*):)?((//(([^@/]+)@)?([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?)$",""),r=new De("^(\\[(.*)\\]|([^:]*))(:(.*))?$","");n.match(e);let s,i=n.matched(7);if(i==null)s=[];else{let c=[],_=0,f=i.split(",");for(;_<f.length;){let o=f[_];++_,r.match(o);let m,S=r.matched(3),g=r.matched(2);g==null?m=S:S==null?m="["+g+"]":(t("invalid host "+o),m=null);let p,y=r.matched(5);if(y==null)p=null;else{let v=B.parseInt(y);v==null?(t("invalid port "+y),p=null):p=v}c.push(at._new(m,p))}s=c}let l=n.matched(8);return s.length>0&&l.charAt(0)!="/"&&(l="/"+l),{scheme:n.matched(2),payload:n.matched(3),hosts:s,auth:n.matched(6),path:Te.ofString(l),query:n.matched(10),hash:n.matched(12)}}}static make(e){let t={payload:"",path:e.path,query:e.query,hosts:e.hosts,auth:e.auth,scheme:e.scheme,hash:e.hash};return q.makePayload(t),t}}class he extends Me{constructor(e,t,n){super(),this.data=e,this.from=t,this.to=n}flatten(e){e.push(this)}getLength(){return this.to-this.from}getSlice(e,t){return t>this.to-this.from&&(t=this.to-this.from),e<0&&(e=0),t<=e?null:t==this.to-this.from&&e==0?this:new he(this.data,this.from+e,t+this.from)}slice(e,t){let n=this.getSlice(e,t);return n??L.EMPTY}blitTo(e,t){this.wrapped==null&&(this.wrapped=I.ofData(this.data)),e.blit(t,this.wrapped,this.from,this.to-this.from)}toBytes(){return this.wrapped==null&&(this.wrapped=I.ofData(this.data)),this.wrapped.sub(this.from,this.to-this.from)}toString(){return this.wrapped==null&&(this.wrapped=I.ofData(this.data)),this.wrapped.getString(this.from,this.to-this.from)}static of(e){if(e.length==0)return L.EMPTY;let t=new he(e.b.bufferValue,0,e.length);return t.wrapped=e,t}}he.__name__=!0;class je{constructor(){this.currentByte=-1,this.currentPos=0,this.length=0,this.curLength=0,this.curOffset=0,this.curPartIndex=0}reset(){this.length=0,this.currentPos=0,this.currentByte=-1,this.curOffset=0;let e=0,t=this.parts;for(;e<t.length;){let n=t[e];++e,this.length+=n.to-n.from}if(this.curPartIndex=0,this.curPart=this.parts[0],this.curPart!=null){let n=this.curPart;this.curLength=n.to-n.from;let r=this.curPart;this.currentByte=r.data.bytes[r.from]}}flush(){let e=this.left();return this.shift(),e}add(e){e.flatten(this.parts),this.reset()}shift(e){this.parts.splice(0,this.curPartIndex);let t=this.parts[0];if(t!=null){let n=t.getSlice(this.curOffset,this.curLength);n==null?this.parts.shift():this.parts[0]=n}e!=null?this.add(e):this.reset()}left(){if(this.curPart==null)return L.EMPTY;let e=[],t=0,n=this.curPartIndex;for(;t<n;)e.push(this.parts[t++]);return e.push(this.curPart.slice(0,this.curOffset)),L.join(e)}right(){if(this.curPart==null)return L.EMPTY;let e=[],t=this.curPartIndex,n=this.parts.length;for(;t<n;)e.push(this.parts[t++]);return e.length>0&&(e[0]=this.curPart.slice(this.curOffset,this.curLength)),L.join(e)}ffwd(){this.currentByte=-1,this.curLength=0,this.curOffset=0,this.curPart=null,this.curPartIndex=this.parts.length}next(){if(this.currentPos==this.length)return!1;if(this.currentPos++,this.currentPos==this.length)return this.ffwd(),!1;if(this.curOffset==this.curLength-1){this.curOffset=0,this.curPart=this.parts[++this.curPartIndex];let e=this.curPart;this.curLength=e.to-e.from;let t=this.curPart;this.currentByte=t.data.bytes[t.from]}else{let e=this.curPart;this.currentByte=e.data.bytes[e.from+ ++this.curOffset]}return!0}static create(e){let t=new je;return t.parts=e,t.reset(),t}}je.__name__=!0;class z extends Me{constructor(){super()}getLength(){return this.length}flatten(e){let t=0,n=this.chunks;for(;t<n.length;)n[t++].flatten(e)}blitTo(e,t){let n=0,r=this.chunks.length;for(;n<r;){let s=n++;this.chunks[s].blitTo(e,t+this.offsets[s])}}toString(){return this.toBytes().toString()}toBytes(){let e=new I(new ArrayBuffer(this.length));return this.blitTo(e,0),e}static asCompound(e){return e instanceof z?e:null}static cons(e,t){let n=e.getLength(),r=t.getLength();if(n==0)return r==0?L.EMPTY:t;if(r==0)return e;{let s=z.asCompound(e),i=z.asCompound(t);if(s==null){if(i==null)return z.create([e,t],2);if(i.depth<100)return z.create([e,t],i.depth+1);{let l=[];return i.flatten(l),t.flatten(l),z.create(l,2)}}else if(i==null){if(s.depth<100)return z.create([e,t],s.depth+1);{let l=[];return s.flatten(l),t.flatten(l),z.create(l,2)}}else{let l=s.depth>i.depth?s.depth:i.depth;return z.create(s.chunks.concat(i.chunks),l)}}}static create(e,t){let n=new z,r=[0],s=0,i=0;for(;i<e.length;)r.push(s+=e[i++].getLength());return n.chunks=e,n.offsets=r,n.length=s,n.depth=t,n}}z.__name__=!0;class Nt{constructor(e){this.buffer=e}getCursor(){return he.of(this.toBytes()).getCursor()}flatten(e){he.of(this.toBytes()).flatten(e)}getLength(){return this.buffer.length}toString(){return this.buffer.toString()}toBytes(){let e=le.allocUnsafe(this.buffer.length);return this.buffer.copy(e),kt.bytesOfBuffer(e)}blitTo(e,t){let n=e.b;this.buffer.copy(le.from(n.buffer,n.byteOffset,e.length),t)}}Nt.__name__=!0;class Ee{static get(){return Ee.doc==null&&(Ee.doc={doc:`\r
	Minify PHP source code by removing comments and whitespace.\r
\r
	> php_minifier [flags] <input> [output]\r
`,commands:[{isDefault:!0,isSub:!1,names:[],doc:`\r
		input  : The input directory.\r
		output : The output directory.\r
	`}],flags:[{names:["--binary"],aliases:["b"],doc:" The path to the PHP executable. "},{names:["--extension"],aliases:["e"],doc:' The extension of the PHP files to process. Defaults to "php". '},{names:["--mode"],aliases:["m"],doc:' The operation mode of the minifier. Defaults to "safe". '},{names:["--silent"],aliases:["s"],doc:" Value indicating whether to silence the minifier output. "},{names:["--help"],aliases:["h"],doc:" Display this help. "},{names:["--version"],aliases:["v"],doc:" Output the version number. "}]}),Ee.doc}}Ee.__name__=!0;class Ue{constructor(e,t,n){this.command=e,this.prompt=t,this.hasFlags=n}processArgs(e){let t=this;return this.hasFlags?P.catchExceptions(function(){let n=Ue.expandAssignments(e),r=[],s=0,i=!1;for(;s<n.length;){let l=n[s];if(l=="--")i=!0,++s;else if(!i&&F.cca(l,0)==45){let c=t.processFlag(n,s);if(c==-1)if(F.cca(l,1)!=45){let _=t.processAlias(n,s);if(_==-1)throw E.thrown('Unrecognized alias "'+l+'"');s+=_+1}else throw E.thrown('Unrecognized flag "'+l+'"');else s+=c+1}else r.push(l),++s}return r},null,{fileName:"tink/cli/Router.hx",lineNumber:25,className:"tink.cli.Router",methodName:"processArgs"}):h.Success(e)}processFlag(e,t){return-1}processAlias(e,t){return-1}static expandAssignments(e){let t=[],n=!0,r=0;for(;r<e.length;){let s=e[r];if(++r,s=="--"&&(n=!1),!n)t.push(s);else{let i=F.cca(s,0),l=F.cca(s,1),c=s.indexOf("=");i==null?t.push(s):i==45?l==null?t.push(s):l==45&&c!=-1?(t.push(F.substr(s,0,c)),t.push(F.substr(s,c+1,null))):t.push(s):t.push(s)}}return t}}Ue.__name__=!0;class vt extends Ue{constructor(e,t){super(e,t,!0)}process(e){let t=this;if(e[0]==null){let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new k(new w(h.Failure(r.failure)))}return N.next(this.promptRequired(),function(s){return t.run_run(n)})}else{let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new k(new w(h.Failure(r.failure)))}return N.next(this.promptRequired(),function(s){return t.run_run(n)})}}processFlag(e,t){let n=t;switch(e[t]){case"--binary":n=t+1,this.command.binary=e[n];break;case"--extension":n=t+1,this.command.extension=e[n];break;case"--help":this.command.help=!0;break;case"--mode":n=t+1,this.command.mode=e[n];break;case"--silent":this.command.silent=!0;break;case"--version":this.command.version=!0;break;default:return-1}return n-t}processAlias(e,t){let n=t,r=e[t],s=1,i=r.length;for(;s<i;){let l=s++,c=F.cca(r,l);if(c==null)throw E.thrown("Invalid alias '-"+r.charAt(l)+"'");switch(c){case 98:this.command.binary=e[++n];break;case 101:this.command.extension=e[++n];break;case 104:this.command.help=!0;break;case 109:this.command.mode=e[++n];break;case 115:this.command.silent=!0;break;case 118:this.command.version=!0;break;default:throw E.thrown("Invalid alias '-"+r.charAt(l)+"'")}}return n-t}promptRequired(){return x.async(function(e){e(h.Success(null))})}run_run(e){return e.length<0?new k(new w(h.Failure(new P(null,"Insufficient arguments. Expected: 0, Got: "+e.length,{fileName:"src/php_minifier/Program.hx",lineNumber:48,className:"tink.cli.Router0",methodName:"run_run"})))):this.command.run(e.slice(0,e.length))}}vt.__name__=!0;class Et{constructor(e){this.re=new De("^\\s*\\*?\\s{0,2}(.*)$",""),this.root=e}format(e){let t="";t+=`
`;let n=this.formatDoc(e.doc);n!=null&&(t+=B.string(""+n+`

`));let r=e.commands,s=[],i=0;for(;i<r.length;){let _=r[i];++i,_.isDefault||s.push(_)}this.root!=null&&(t+=B.string("  Usage: "+this.root+`
`));let l=Ie.find(e.commands,function(_){return _.isDefault});if(l!=null){let _=this.formatDoc(l.doc);_!=null&&(t+=B.string(this.indent(_,4)+`

`))}let c=this;if(s.length>0){let _=Ie.fold(s,function(m,S){let g=0,p=m.names;for(;g<p.length;){let y=p[g];++g,y.length>S&&(S=y.length)}return S},0);this.root!=null&&(t+=B.string("  Usage: "+this.root+` <subcommand>
`)),t+=B.string(`    Subcommands:
`);let f=function(m,S){S==null&&(S="(doc missing)"),t+=B.string(c.indent(O.lpad(m," ",_)+" : "+O.trim(c.indent(S,_+3)),6)+`
`)},o=0;for(;o<s.length;){let m=s[o];++o;let S=m.names[0];if(f(S,this.formatDoc(m.doc)),m.names.length>1){let g=1,p=m.names.length;for(;g<p;)f(m.names[g++],"Alias of "+S)}}}if(e.flags.length>0){let _=function(g){let p=g.names.join(", ");if(g.aliases.length>0){let y=g.aliases,v=new Array(y.length),R=0,K=y.length;for(;R<K;){let Q=R++;v[Q]="-"+y[Q]}p+=", "+v.join(", ")}return p},f=Ie.fold(e.flags,function(g,p){let y=_(g);return y.length>p&&(p=y.length),p},0),o=function(g,p){p==null&&(p=""),t+=B.string(c.indent(O.lpad(g," ",f)+" : "+O.trim(c.indent(p,f+3)),6)+`
`)};t=(t+=`
`)+B.string(`  Flags:
`);let m=0,S=e.flags;for(;m<S.length;){let g=S[m];++m,o(_(g),this.formatDoc(g.doc))}}return t}indent(e,t){let n=e.split(`
`),r=new Array(n.length),s=0,i=n.length;for(;s<i;){let l=s++;r[l]=O.lpad(""," ",t)+n[l]}return r.join(`
`)}formatDoc(e){if(e==null)return null;let t=e.split(`
`),n=O.trim,r=new Array(t.length),s=0,i=t.length;for(;s<i;){let o=s++;r[o]=n(t[o])}let l=r;for(;l[0]=="";)l=l.slice(1);for(;l[l.length-1]=="";)l.pop();let c=new Array(l.length),_=0,f=l.length;for(;_<f;){let o=_++,m=l[o];c[o]=this.re.match(m)?this.re.matched(1):m}return c.join(`
`)}}Et.__name__=!0;class Rt{constructor(e,t){this.source=e,this.sink=t}}Rt.__name__=!0;class Ft extends Rt{constructor(){let e=process.stdin,t=null;t={},super(J.wrap("stdin",e,t.chunkSize,t.onEnd),we.wrap("stdout",process.stdout))}}Ft.__name__=!0;class Tt{constructor(e,t){this.trials=e,this.proxy=t??new Ft}}Tt.__name__=!0;class b{static invoke(e,t){b.depth<500?(b.depth++,e(t),b.depth--):b.defer(function(){e(t)})}static defer(e){global.setImmediate(e)}}class Ct{constructor(){}cancel(){let e=this.link;e?.cancel()}}Ct.__name__=!0;class on{static fromMany(e){return new At(function(){if(e!=null){let t=0;for(;t<e.length;){let n=e[t];++t,n?.cancel()}}else e=null})}}class At{constructor(e){this.f=e}cancel(){this.f!=null&&(this.f(),this.f=null)}}At.__name__=!0;class Je{constructor(e,t){this.dissolved=!1,this.a=e,this.b=t}cancel(){if(!this.dissolved){this.dissolved=!0;let e=this.a;e?.cancel();let t=this.b;t?.cancel(),this.a=null,this.b=null}}}Je.__name__=!0;class Qe{constructor(e,t){if(e==null)throw E.thrown("callback expected but null received");this.cb=e,this.list=t}cancel(){if(this.list!=null){let e=this.list;this.cb=null,this.list=null,--e.used<=e.cells.length>>1&&e.compact()}}}Qe.__name__=!0;class ae{constructor(e){ae._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.disposeHandlers=[],this.f=e}dispose(){let e=this.disposeHandlers;if(e!=null){this.disposeHandlers=null;let t=this.f;this.f=ae.noop,t();let n=0;for(;n<e.length;)e[n++]()}}static noop(){}}ae.__name__=!0;class et extends ae{constructor(e){ae._hx_skip_constructor=!0,super(),ae._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){e==null&&(e=!1),this.onfill=function(){},this.ondrain=function(){},this.busy=!1,this.queue=[],this.used=0;let t=this;super._hx_constructor(function(){t.busy||t.destroy()}),this.destructive=e,this.cells=[]}destroy(){let e=0,t=this.cells;for(;e<t.length;){let n=t[e];++e,n.cb=null,n.list=null}if(this.queue=null,this.cells=null,this.used>0){this.used=0;let n=this.ondrain;b.depth<500?(b.depth++,n(),b.depth--):b.defer(n)}}invoke(e){let t=this;if(b.depth<500){if(b.depth++,t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let s=t.cells[r++];s.list!=null&&s.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}b.depth--}else b.defer(function(){if(t.disposeHandlers!=null)if(t.busy){if(t.destructive!=!0){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let s=t.cells[r++];s.list!=null&&s.cb(e)}t.busy=!1,t.disposeHandlers==null?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}})}compact(){if(!this.busy)if(this.used==0){this.resize(0);let e=this.ondrain;b.depth<500?(b.depth++,e(),b.depth--):b.defer(e)}else{let e=0,t=0,n=this.cells.length;for(;t<n;){let r=t++,s=this.cells[r];if(s.cb!=null&&(e!=r&&(this.cells[e]=s),++e==this.used))break}this.resize(this.used)}}resize(e){this.cells.length=e}}et.__name__=!0;class P{constructor(e,t,n){e==null&&(e=500),this.isTinkError=!0,this.code=e,this.message=t,this.pos=n,this.exceptionStack=[],this.callStack=[]}static withData(e,t,n,r){return P.typed(e,t,n,r)}static typed(e,t,n,r){let s=new P(e,t,r);return s.data=n,s}static asError(e){return e!=null&&e.isTinkError?e:null}static catchExceptions(e,t,n){try{return h.Success(e())}catch(r){let s=E.caught(r).unwrap(),i=P.asError(s);return h.Failure(i??(t==null?P.withData(null,"Unexpected Error",s,n):t(s)))}}}P.__name__=!0;class W{constructor(){W._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){}getStatus(){return H.NeverEver}handle(e){return null}eager(){}}W.__name__=!0;class w{constructor(e){this.value=e}isComputed(){return!0}get(){return this.value}compute(){}underlying(){return null}}w.__name__=!0;class k extends W{constructor(e){super(),this.value=e}getStatus(){return H.Ready(this.value)}handle(e){return b.invoke(e,V.get(this.value)),null}eager(){this.value.isComputed()||V.get(this.value)}}k.__name__=!0;class x{static never(){return x.NEVER_INST}static first(e,t){let n=e;switch(n.getStatus()._hx_index){case 3:switch(t.getStatus()._hx_index){case 3:return n;case 4:return n;default:return n}break;case 4:return t;default:switch(t.getStatus()._hx_index){case 3:return t;case 4:return n;default:return new fe(function(r){return new Je(e.handle(r),t.handle(r))})}}}static map(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let s=r.result,i=t;return new k(new tt(function(){return i(s.get())},s));case 4:return x.never();default:return new fe(function(l){return e.handle(function(c){l(t(c))})})}}static flatMap(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let s=r.result;return new fe(function(i){return t(V.get(s)).handle(function(l){i(l)})});case 4:return x.never();default:return new fe(function(i){let l=new Ct;return new Je(e.handle(function(c){let _=t(c).handle(i),f=l.link;f?.cancel(),l.link=_}),l)})}}static processMany(e,t,n,r){return e.length==0?new k(new w(r(h.Success([])))):new fe(function(s){let i=[],l=[],c=0;for(;c<e.length;)++c,l.push(null);let _=l,f=0,o=0,m=!1,S;if(t==null)S=e.length;else{let R=t;S=R<1?1:R>e.length?e.length:R}let g=function(){if(f==_.length)if(o==0){let R=r(h.Success(_));return m=!0,s(R),!0}else return!1;else return!1},p=null;p=function(){if(!m&&!g())for(;f<_.length;){f+=1;let R=f-1,K=e[R],Q=function(_e){let be=n(_e);switch(be._hx_index){case 0:_[R]=be.data,g();break;case 1:let Ye=be.failure,Ce=0;for(;Ce<i.length;){let ln=i[Ce];++Ce,ln?.cancel()}let pn=r(h.Failure(Ye));m=!0,s(pn);break}},ke=K.getStatus();if(ke._hx_index==3){let _e;if(_e=V.get(ke.result),Q(_e),!m)continue}else o+=1,i.push(K.handle(function(_e){o-=1,Q(_e),m||p()}));break}};let y=0,v=S;for(;y<v;)++y,p();return on.fromMany(i)})}static async(e,t){t==null&&(t=!1);let n=x.irreversible(e);return t||n.eager(),n}static irreversible(e){return new fe(function(t){return e(t),null})}static delay(e,t){let n=x.irreversible(function(r){Le.delay(function(){r(V.get(t))},e)});return n.eager(),n}}var H=C["tink.core.FutureStatus"]={__ename__:!0,__constructs__:null,Suspended:{_hx_name:"Suspended",_hx_index:0,__enum__:"tink.core.FutureStatus",toString:d},Awaited:{_hx_name:"Awaited",_hx_index:1,__enum__:"tink.core.FutureStatus",toString:d},EagerlyAwaited:{_hx_name:"EagerlyAwaited",_hx_index:2,__enum__:"tink.core.FutureStatus",toString:d},Ready:(u=function(a){return{_hx_index:3,result:a,__enum__:"tink.core.FutureStatus",toString:d}},u._hx_name="Ready",u.__params__=["result"],u),NeverEver:{_hx_name:"NeverEver",_hx_index:4,__enum__:"tink.core.FutureStatus",toString:d}};H.__constructs__=[H.Suspended,H.Awaited,H.EagerlyAwaited,H.Ready,H.NeverEver];class Be extends W{constructor(){W._hx_skip_constructor=!0,super(),W._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.status=H.Awaited,super._hx_constructor(),this.list=new et(!0)}getStatus(){return this.status}handle(e){let t=this.status;if(t._hx_index==3)return b.invoke(e,V.get(t.result)),null;{let n=this.list;if(n.disposeHandlers==null)return null;{let r=new Qe(e,n);if(n.cells.push(r),n.used++==0){let s=n.onfill;b.depth<500?(b.depth++,s(),b.depth--):b.defer(s)}return r}}}trigger(e){return this.status._hx_index==3?!1:(this.status=H.Ready(new w(e)),this.list.invoke(e),!0)}}Be.__name__=!0;class fe extends W{constructor(e){W._hx_skip_constructor=!0,super(),W._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.status=H.Suspended,super._hx_constructor(),this.wakeup=e,this.callbacks=new et(!0);let t=this;this.callbacks.ondrain=function(){if(t.status==H.Awaited){t.status=H.Suspended;let n=t.link;n?.cancel(),t.link=null}},this.callbacks.onfill=function(){t.status==H.Suspended&&(t.status=H.Awaited,t.arm())}}getStatus(){return this.status}trigger(e){if(this.status._hx_index!=3){this.status=H.Ready(new w(e));let t=this.link;this.link=null,this.wakeup=null,this.callbacks.invoke(e),t?.cancel()}}handle(e){let t=this.status;if(t._hx_index==3)return b.invoke(e,V.get(t.result)),null;{let n=this.callbacks;if(n.disposeHandlers==null)return null;{let r=new Qe(e,n);if(n.cells.push(r),n.used++==0){let s=n.onfill;b.depth<500?(b.depth++,s(),b.depth--):b.defer(s)}return r}}}arm(){let e=this;this.link=this.wakeup(function(t){e.trigger(t)})}eager(){switch(this.status._hx_index){case 0:this.status=H.EagerlyAwaited,this.arm();break;case 1:this.status=H.EagerlyAwaited;break;default:}}}fe.__name__=!0;class V{static get(e){return e.compute(),e.get()}}class tt{constructor(e,t){this.f=e,this.from=t}underlying(){return this.from}isComputed(){return this.f==null}get(){return this.result}compute(){let e=this.f;if(e!=null){this.f=null;let t=this.from;if(t!=null){let n=t;this.from=null;let r=[];for(;n!=null&&!n.isComputed();)r.push(n),n=n.underlying();r.reverse();let s=0;for(;s<r.length;)r[s++].compute()}this.result=e()}}}tt.__name__=!0;class Bt{constructor(e,t){this.name=e,this.value=t}}Bt.__name__=!0;var h=C["tink.core.Outcome"]={__ename__:!0,__constructs__:null,Success:(u=function(a){return{_hx_index:0,data:a,__enum__:"tink.core.Outcome",toString:d}},u._hx_name="Success",u.__params__=["data"],u),Failure:(u=function(a){return{_hx_index:1,failure:a,__enum__:"tink.core.Outcome",toString:d}},u._hx_name="Failure",u.__params__=["failure"],u)};h.__constructs__=[h.Success,h.Failure];class Ot{constructor(e,t){this.a=e,this.b=t}}Ot.__name__=!0;class N{static next(e,t,n){return x.flatMap(e,function(r){switch(r._hx_index){case 0:return t(r.data);case 1:return new k(new w(h.Failure(r.failure)))}})}static many(e,t){return x.processMany(e,t,function(n){return n},function(n){return n})}static inSequence(e){return N.many(e,1)}}class ue{constructor(e,t,n){this.preprocessors=e,this.postprocessors=t,this.real=n}pipe(e,t,n){if(n==null&&(n=0),t!=null&&n<t.length){let r=this,s=t,i=n+1,l=function(c){return r.pipe(c,s,i)};return N.next(t[n](e),l)}else return new k(new w(h.Success(e)))}request(e){let t=this;return N.next(this.pipe(e,this.preprocessors),function(n){let r=t.real.request(n),s=t,i;if(t.postprocessors==null)i=null;else{let l=[],c=0,_=t.postprocessors;for(;c<_.length;)l.push(_[c++](n));i=l}return N.next(r,function(l){return s.pipe(l,i)})})}static concat(e,t){return e==null?t:t==null?e:e.concat(t)}static create(e,t,n){let r=e instanceof ue?e:null;if(r==null)return new ue(t,n,e);{let s=r;return new ue(ue.concat(t,s.preprocessors),ue.concat(s.postprocessors,n),s.real)}}}ue.__name__=!0;class te{static fetch(e,t){return x.async(function(n){let r="GET",s=null,i=$.EMPTY,l=de.Default,c=!0;t!=null&&(t.method!=null&&(r=t.method),t.headers!=null&&(s=t.headers),t.body!=null&&(i=t.body),t.client!=null&&(l=t.client),t.followRedirect==!1&&(c=!1));let _=te.getClient(l);if(t!=null&&t.augment!=null){let f=t.augment;_=ue.create(_,f.before,f.after)}_.request(new Lt(new ze(r,e,null,s),i)).handle(function(f){switch(f._hx_index){case 0:let o=f.data,m=o.header.statusCode;switch(m){case 301:case 302:case 303:case 307:case 308:let S=m;c?N.next(new k(new w(o.header.byName("location".toLowerCase()))),function(g){let p=q.resolve(e,q.fromString(g)),y;if(S==303){let v=U.copy(t);v.method="GET",y=v}else y=t;return te.fetch(p,y)}).handle(n):n(h.Success(o));break;default:n(h.Success(o))}break;case 1:n(h.Failure(f.failure));break}})})}static getClient(e){if(!te.cache.exists(e)){let t;switch(e._hx_index){case 0:t=new zt;break;case 1:t=new Ut(e.container);break;case 2:t=new jt;break;case 3:t=new Wt;break;case 4:t=e.v;break}te.cache.set(e,t)}return te.cache.get(e)}}te.__name__=!0;var de=C["tink.http.ClientType"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"tink.http.ClientType",toString:d},Local:(u=function(a){return{_hx_index:1,container:a,__enum__:"tink.http.ClientType",toString:d}},u._hx_name="Local",u.__params__=["container"],u),Curl:{_hx_name:"Curl",_hx_index:2,__enum__:"tink.http.ClientType",toString:d},StdLib:{_hx_name:"StdLib",_hx_index:3,__enum__:"tink.http.ClientType",toString:d},Custom:(u=function(a){return{_hx_index:4,v:a,__enum__:"tink.http.ClientType",toString:d}},u._hx_name="Custom",u.__params__=["v"],u)};de.__constructs__=[de.Default,de.Local,de.Curl,de.StdLib,de.Custom];class hn{static all(e){return N.next(e,function(t){return N.next(He.all(t.body),function(n){return t.header.statusCode>=400?new k(new w(h.Failure(P.withData(t.header.statusCode,t.header.reason,n.toString(),{fileName:"tink/http/Fetch.hx",lineNumber:124,className:"tink.http._Fetch.FetchResponse_Impl_",methodName:"all"})))):new k(new w(h.Success(new Y(t.header,n))))})})}}class Z{constructor(e){Z._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.fields=e??[]}get(e){let t=[],n=0,r=this.fields;for(;n<r.length;){let s=r[n];++n,s.name==e&&t.push(s.value)}return t}byName(e){let t=this.get(e);switch(t.length){case 0:return h.Failure(new P(422,"No "+e+" header found",{fileName:"tink/http/Header.hx",lineNumber:91,className:"tink.http.Header",methodName:"byName"}));case 1:return h.Success(t[0]);default:return h.Failure(new P(422,"Multiple entries for "+e+" header",{fileName:"tink/http/Header.hx",lineNumber:95,className:"tink.http.Header",methodName:"byName"}))}}}Z.__name__=!0;class fn{static basicAuth(e,t){return"Basic "+oe.encode(I.ofString(""+e+":"+t)).toString()}}class me extends Bt{constructor(e,t){super(e,t)}static ofString(e){let t=e.indexOf(":");return t==-1?new me(e.toLowerCase(),null):new me(F.substr(e,0,t).toLowerCase(),O.trim(F.substr(e,t+1,null)))}}me.__name__=!0;class Ht{read(e){throw E.thrown("abstract")}progress(e){do{let t=this.read(e.currentByte);switch(t._hx_index){case 0:break;case 1:return e.next(),D.Done(t.r);case 2:return D.Failed(t.e)}}while(e.next());return D.Progressed}eof(e){let t=this.read(-1);switch(t._hx_index){case 0:return h.Failure(new P(422,"Unexpected end of input",{fileName:"tink/io/StreamParser.hx",lineNumber:180,className:"tink.io.BytewiseParser",methodName:"eof"}));case 1:return h.Success(t.r);case 2:return h.Failure(t.e)}}}Ht.__name__=!0;var D=C["tink.io.ParseStep"]={__ename__:!0,__constructs__:null,Progressed:{_hx_name:"Progressed",_hx_index:0,__enum__:"tink.io.ParseStep",toString:d},Done:(u=function(a){return{_hx_index:1,r:a,__enum__:"tink.io.ParseStep",toString:d}},u._hx_name="Done",u.__params__=["r"],u),Failed:(u=function(a){return{_hx_index:2,e:a,__enum__:"tink.io.ParseStep",toString:d}},u._hx_name="Failed",u.__params__=["e"],u)};D.__constructs__=[D.Progressed,D.Done,D.Failed];class Dt extends Ht{constructor(e){super(),this.last=-1,this.buf=new $e,this.makeHeader=e}read(e){let t=this.last;switch(e){case-1:return this.nextLine();case 10:if(t==13)return this.nextLine();{let n=e;return this.last=n,this.buf.b+=String.fromCodePoint(n),D.Progressed}break;case 13:if(t==13){let n=this.last;return this.buf.b+=String.fromCodePoint(n),D.Progressed}else return this.last=13,D.Progressed;break;default:if(t==13){let n=e,r=this.last;return this.buf.b+=String.fromCodePoint(r),this.buf.b+=String.fromCodePoint(n),this.last=-1,D.Progressed}else{let n=e;return this.last=n,this.buf.b+=String.fromCodePoint(n),D.Progressed}}}nextLine(){let e=this.buf.b;if(this.buf=new $e,this.last=-1,e=="")return this.header==null?D.Progressed:D.Done(this.header);if(this.header==null){let t=this.makeHeader(e,this.fields=[]);switch(t._hx_index){case 0:let n=t.data;return n==null?D.Done(this.header=null):(this.header=n,D.Progressed);case 1:return D.Failed(t.failure)}}else return this.fields.push(me.ofString(e)),D.Progressed}}Dt.__name__=!0;class Y{constructor(e,t){Y._hx_skip_constructor||this._hx_constructor(e,t)}_hx_constructor(e,t){this.header=e,this.body=t}}Y.__name__=!0;class nt extends Z{constructor(e,t,n,r){Z._hx_skip_constructor=!0,super(),Z._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){n==null&&(n="HTTP/1.1"),this.method=e,this.url=t,this.protocol=n,super._hx_constructor(r)}}nt.__name__=!0;class It extends nt{constructor(e,t,n,r){super(e,t,n,r)}}It.__name__=!0;class ze extends nt{constructor(e,t,n,r){n==null&&(n="HTTP/1.1");let s=ze.extractAuth(t);if(s._hx_index==0){let i=s.v;t=i.url,r=r!=null?r.concat(i.headers):i.headers}super(e,t,n,r)}static extractAuth(e){let t=e.auth;if(t==null)return re.None;{let n=[new me("authorization",fn.basicAuth(t==null?null:t.split(":")[0],t==null?null:t.split(":")[1]))],r=e.scheme,s=[],i=0,l=e.hosts;for(;i<l.length;)s.push(l[i++]);return re.Some({headers:n,url:q.make({scheme:r,hosts:s,path:e.path,query:e.query})})}}}ze.__name__=!0;class Lt extends Y{constructor(e,t){super(e,t)}}Lt.__name__=!0;class qt extends Y{constructor(e,t,n){Y._hx_skip_constructor=!0,super(),Y._hx_skip_constructor=!1,this._hx_constructor(e,t,n)}_hx_constructor(e,t,n){this.clientIp=e,super._hx_constructor(t,n)}}qt.__name__=!0;var We=C["tink.http.IncomingRequestBody"]={__ename__:!0,__constructs__:null,Plain:(u=function(a){return{_hx_index:0,source:a,__enum__:"tink.http.IncomingRequestBody",toString:d}},u._hx_name="Plain",u.__params__=["source"],u),Parsed:(u=function(a){return{_hx_index:1,parts:a,__enum__:"tink.http.IncomingRequestBody",toString:d}},u._hx_name="Parsed",u.__params__=["parts"],u)};We.__constructs__=[We.Plain,We.Parsed];class ge extends Z{constructor(e,t,n,r){Z._hx_skip_constructor=!0,super(),Z._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){r==null&&(r="HTTP/1.1"),this.statusCode=e,this.reason=t??an.fromCode(e),this.protocol=r,super._hx_constructor(n)}static parser(){return new Dt(function(e,t){let n=e.split(" ");if(n.length>=3){let r=B.parseInt(n[1]),s=n.slice(2).join(" "),i=n[0];return i==null&&(i="HTTP/1.1"),h.Success(new ge(r,s,t,i))}else return h.Failure(new P(422,"Invalid HTTP response header",{fileName:"tink/http/Response.hx",lineNumber:56,className:"tink.http.ResponseHeaderBase",methodName:"parser"}))})}}ge.__name__=!0;class Mt extends Y{constructor(e,t){super(e,t)}}Mt.__name__=!0;class Oe extends Y{constructor(e,t){super(e,t)}}Oe.__name__=!0;var rt=C["tink.http.BodyPart"]={__ename__:!0,__constructs__:null,Value:(u=function(a){return{_hx_index:0,v:a,__enum__:"tink.http.BodyPart",toString:d}},u._hx_name="Value",u.__params__=["v"],u),File:(u=function(a){return{_hx_index:1,handle:a,__enum__:"tink.http.BodyPart",toString:d}},u._hx_name="File",u.__params__=["handle"],u)};rt.__constructs__=[rt.Value,rt.File];class jt{constructor(e,t){e!=null&&(this.curl=e),this.extraArgs=t}request(e){let t=st.checkScheme(e.header.url);switch(t._hx_index){case 0:return new k(new w(h.Failure(t.v)));case 1:let n=this.extraArgs,r=n==null?[]:n.slice();switch(r.push("-isS"),r.push("-X"),r.push(e.header.method),e.header.protocol){case"HTTP/1.0":r.push("--http1.0");break;case"HTTP/1.1":r.push("--http1.1");break;case"HTTP/2":r.push("--http2");break;default:}let s=e.header.fields,i=0;for(;i<s.length;){let l=s[i++];r.push("-H"),r.push(""+l.name+": "+l.value)}return r.push(q.toString(e.header.url)),N.next(He.parse(this.curl(r,e.body),ge.parser()),function(l){return new k(new w(h.Success(new Oe(l.a,l.b))))})}}curl(e,t){e.push("--data-binary"),e.push("@-");let n=wt.spawn("curl",e),r=we.wrap("stdin",n.stdin),s=null;s={};let i=J.wrap("stdout",n.stdout,s.chunkSize,s.onEnd),l=null;l={};let c=J.wrap("stderr",n.stderr,l.chunkSize,l.onEnd);return $.pipeTo(t,r,{end:!0}).eager(),$.ofPromised(x.flatMap(x.async(function(_){n.once("exit",function(f,o){_(f)})}),function(_){if(_==0)return new k(new w(h.Success(i)));{let f=_;return N.next(He.all(c),function(o){return new k(new w(h.Failure(new P(f,o.toString(),{fileName:"tink/http/clients/CurlClient.hx",lineNumber:70,className:"tink.http.clients.CurlClient",methodName:"curl"}))))})}}))}}jt.__name__=!0;class st{static checkScheme(e){let t=e.scheme;if(t==null)return re.Some(new P(400,"Missing Scheme (expected http/https) in URL: "+q.toString(e),{fileName:"tink/http/clients/Helpers.hx",lineNumber:16,className:"tink.http.clients.Helpers",methodName:"missingSchemeError"}));switch(t){case"http":case"https":return re.None;default:let n=q.fromString(t);return re.Some(new P(400,'Invalid Scheme "'+n.scheme+'" (expected http/https) in URL: '+q.toString(n),{fileName:"tink/http/clients/Helpers.hx",lineNumber:19,className:"tink.http.clients.Helpers",methodName:"invalidSchemeError"}))}}}st.__name__=!0;class Ut{constructor(e){this.container=e}request(e){let t=e.header.url;return x.flatMap(this.container.serve(new qt("127.0.0.1",new It(e.header.method,q.fromString(t.query==null?t.path:(t.path==null?"null":t.path)+"?"+(t.query==null?"null":t.query)),"HTTP/1.1",e.header.fields),We.Plain(e.body))),function(n){return new k(new w(h.Success(new Oe(n.header,n.body))))})}}Ut.__name__=!0;class zt{constructor(e){this.agent=e}request(e){let t=st.checkScheme(e.header.url);switch(t._hx_index){case 0:return new k(new w(h.Failure(t.v)));case 1:let n=this.getNodeOptions(e.header);return e.header.url.scheme=="https"?this.nodeRequest(St,n,e):this.nodeRequest(xt,n,e)}}getNodeOptions(e){let t=this.agent,n=e.method,r=e.url,s=r.query==null?r.path:(r.path==null?"null":r.path)+"?"+(r.query==null?"null":r.query),i=at.get_name(e.url.hosts[0]),l=at.get_port(e.url.hosts[0]),c={},_=e.fields,f=0;for(;f<_.length;){let o=_[f++];if(o.name=="host")c[o.name]=o.value;else{let m=c[o.name];(m??(c[o.name]=[])).push(o.value)}}return{agent:t,method:n,path:s,host:i,port:l,headers:c}}nodeRequest(e,t,n){return x.async(function(r){let s=e.request(t,function(l){let c=r,_=l.statusCode,f=l.statusMessage,o=[],m=0,S=l.rawHeaders.length>>1;for(;m<S;){let p=m++;o.push(new me(l.rawHeaders[2*p].toLowerCase(),l.rawHeaders[2*p+1]))}let g=null;g={},c(h.Success(new Oe(new ge(_,f,o,"HTTP/1.1"),J.wrap("Response from "+(n.header.url==null?"null":q.toString(n.header.url)),l,g.chunkSize,g.onEnd))))}),i=function(l){r(h.Failure(l))};s.on("error",function(l){i(P.withData(null,l.message,l,{fileName:"tink/http/clients/NodeClient.hx",lineNumber:87,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}))}),$.pipeTo(n.body,we.wrap("Request to "+(n.header.url==null?"null":q.toString(n.header.url)),s)).handle(function(l){switch(s.end(),l._hx_index){case 0:break;case 1:i(new P(502,"Gateway Error",{fileName:"tink/http/clients/NodeClient.hx",lineNumber:96,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}));break;case 2:i(l.e);break}})})}}zt.__name__=!0;class Wt{constructor(e){this.worker=X.ensure(e)}request(e){let t=this;return x.async(function(n){let r=new gt(q.toString(e.header.url)),s=function(c){let _=200;r.onStatus=function(o){_=o};let f=function(){return[]};r.onError=function(o){_==200&&(_=500),X.work(t.worker,new w(!0)).handle(function(){n(h.Failure(new P(_,o,{fileName:"tink/http/clients/StdClient.hx",lineNumber:44,className:"tink.http.clients.StdClient",methodName:"request"})))})},r.onData=function(o){X.work(t.worker,new w(!0)).handle(function(){let m=n,S=f();m(h.Success(new Oe(new ge(_,"OK",S,"HTTP/1.1"),new Fe(new w(he.of(I.ofString(o)))))))})},X.work(t.worker,new tt(function(){r.request(c)}))},i=e.header.fields,l=0;for(;l<i.length;){let c=i[l++];r.setHeader(c.name,c.value)}switch(e.header.method){case"GET":case"HEAD":case"OPTIONS":s(!1);break;default:$t.all(e.body).handle(function(c){r.setPostData(c.toString()),s(!0)})}})}}Wt.__name__=!0;class dn{constructor(){}serve(e){return this.running?this.handler.process(e):new k(new w(new Mt(new ge(503,"Server stopped",[],"HTTP/1.1"),$.EMPTY)))}}dn.__name__=!0;var ne=C["tink.io.PipeResult"]={__ename__:!0,__constructs__:null,AllWritten:{_hx_name:"AllWritten",_hx_index:0,__enum__:"tink.io.PipeResult",toString:d},SinkEnded:(u=function(a,e){return{_hx_index:1,result:a,rest:e,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SinkEnded",u.__params__=["result","rest"],u),SinkFailed:(u=function(a,e){return{_hx_index:2,e:a,rest:e,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SinkFailed",u.__params__=["e","rest"],u),SourceFailed:(u=function(a){return{_hx_index:3,e:a,__enum__:"tink.io.PipeResult",toString:d}},u._hx_name="SourceFailed",u.__params__=["e"],u)};ne.__constructs__=[ne.AllWritten,ne.SinkEnded,ne.SinkFailed,ne.SourceFailed];class Vt{static toResult(e,t,n){let r=function(s){return n==null?s:s.prepend(new Fe(new w(n)))};switch(e._hx_index){case 0:return ne.SinkEnded(t,r(e.rest));case 1:return ne.SinkFailed(e.error,r(e.at));case 2:return ne.SourceFailed(e.error);case 3:return ne.AllWritten}}}Vt.__name__=!0;class Yt{consume(e,t){throw E.thrown("not implemented")}}Yt.__name__=!0;class pe{constructor(){}get_depleted(){return!1}prepend(e){return this.get_depleted()?e:ce.of([e,this])}decompose(e){this.get_depleted()||e.push(this)}reduce(e,t){let n=this;return x.async(function(r){n.forEach(lt.ofUnknown(function(s){return x.map(t(e,s),function(i){switch(i._hx_index){case 0:return e=i.result,M.Resume;case 1:return M.Clog(i.e)}})})).handle(function(s){switch(s._hx_index){case 0:throw E.thrown("assert");case 1:r(xe.Crashed(s.error,s.at));break;case 2:r(xe.Failed(s.error));break;case 3:r(xe.Reduced(e));break}})})}forEach(e){throw E.thrown("not implemented")}}pe.__name__=!0;class Re extends pe{constructor(){super()}get_depleted(){return!0}forEach(e){return new k(new w(A.Depleted))}}Re.__name__=!0;class ${static concatAll(e){return e.reduce(L.EMPTY,gn.ofSafeSync(function(t,n){return Ve.Progress(L.concat(t,n))}))}static pipeTo(e,t,n){return t.consume(e,n)}static ofError(e){return Qt.ofError(e)}static ofPromised(e){return Qt.future(x.map(e,function(t){switch(t._hx_index){case 0:return t.data;case 1:return $.ofError(t.failure)}}))}}class He{static all(e){return x.map($.concatAll(e),function(t){switch(t._hx_index){case 1:return h.Failure(t.error);case 2:return h.Success(t.result)}})}static parse(e,t){return x.map(it.parse(e,t),function(n){switch(n._hx_index){case 0:return h.Success(new Ot(n.data,n.rest));case 1:return h.Failure(n.e);case 2:return h.Failure(n.e)}})}}He.__name__=!0;class $t{static all(e){return x.map($.concatAll(e),function(t){return t.result})}}$t.__name__=!0;var G=C["tink.io.ParseResult"]={__ename__:!0,__constructs__:null,Parsed:(u=function(a,e){return{_hx_index:0,data:a,rest:e,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Parsed",u.__params__=["data","rest"],u),Invalid:(u=function(a,e){return{_hx_index:1,e:a,rest:e,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Invalid",u.__params__=["e","rest"],u),Broke:(u=function(a){return{_hx_index:2,e:a,__enum__:"tink.io.ParseResult",toString:d}},u._hx_name="Broke",u.__params__=["e"],u)};G.__constructs__=[G.Parsed,G.Invalid,G.Broke];class it{static doParse(e,t,n,r){let s=L.EMPTY.getCursor(),i=!0,l=function(_){return s.currentPos<s.length?_.prepend(new Fe(new w(s.right()))):_},c=function(){let _=s.flush();return _.getLength()==0?$.EMPTY:new Fe(new w(_))};return x.flatMap(e.forEach(lt.ofUnknown(function(_){return _.getLength()==0?new k(new w(M.Resume)):(s.shift(_),x.async(function(f){let o=null;o=function(){s.shift();let m=s.currentPos,S=t.progress(s);switch(S._hx_index){case 0:m!=s.currentPos&&s.currentPos<s.length?o():f(M.Resume);break;case 1:n(S.r).handle(function(g){i=g.resume,i?m!=s.currentPos&&s.currentPos<s.length?o():f(M.Resume):f(M.Finish)});break;case 2:f(M.Clog(S.e));break}},o()}))})),function(_){switch(_._hx_index){case 0:return new k(new w(G.Parsed(r(),l(_.rest))));case 1:return new k(new w(G.Invalid(_.error,l(_.at))));case 2:return new k(new w(G.Broke(_.error)));case 3:if(s.currentPos<s.length)return new k(new w(G.Parsed(r(),l(new Fe(new w(L.EMPTY))))));if(i){let f=t.eof(s);switch(f._hx_index){case 0:return x.map(n(f.data),function(o){return G.Parsed(r(),c())});case 1:return new k(new w(G.Invalid(f.failure,c())))}}else return new k(new w(G.Parsed(r(),c())));break}})}static parse(e,t){let n=null;return it.doParse(e,t,function(r){return n=r,new k(new w({resume:!1}))},function(){return n})}}class Gt{constructor(){}work(e){return new k(new w(V.get(e)))}}Gt.__name__=!0;class X{static ensure(e){return e??X.get()}static get(){return X.pool[B.random(X.pool.length)]}static work(e,t){return e.work(t)}}class Xt extends pe{constructor(e){super(),this.upcoming=e}forEach(e){let t=this;return x.async(function(n){t.upcoming.handle(function(r){switch(r._hx_index){case 0:let s=r.next;e(r.value).handle(function(i){switch(i._hx_index){case 0:n(A.Halted(t));break;case 1:n(A.Halted(s));break;case 2:s.forEach(e).handle(n);break;case 3:n(A.Clogged(i.e,t));break}});break;case 1:n(A.Failed(r.e));break;case 2:n(A.Depleted);break}})})}}Xt.__name__=!0;class we extends Yt{constructor(e){super(),this.target=e}consume(e,t){let n=this,r=e.forEach(lt.ofUnknown(function(s){return x.map(n.target.write(s),function(i){switch(i._hx_index){case 0:return i.data?M.Resume:M.BackOff;case 1:return M.Clog(i.failure)}})}));return t!=null&&t.end&&r.handle(function(s){n.target.end()}),x.map(r,function(s){return Vt.toResult(s,null)})}static wrap(e,t){return new we(new Zt(e,t))}}we.__name__=!0;class J extends Xt{constructor(e){super(x.async(function(t){e.read().handle(function(n){let r=t,s;switch(n._hx_index){case 0:let i=n.data;s=i==null?Se.End:Se.Link(i,new J(e));break;case 1:s=Se.Fail(n.failure);break}r(s)})},!0))}static wrap(e,t,n,r){return new J(new Kt(e,t,n,r))}}J.__name__=!0;class Kt{constructor(e,t,n,r){this.name=e,this.native=t,this.chunkSize=n;let s=x.async(function(i){t.once("end",function(){i(h.Success(null))}),t.once("error",function(l){i(h.Failure(new P(null,""+l.code+" - Failed reading from "+e+" because "+l.message,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:22,className:"tink.io.nodejs.WrappedReadable",methodName:"new"})))})});s.eager(),this.end=s,r!=null&&this.end.handle(function(){process.nextTick(r)})}read(){let e=this;return x.first(x.async(function(t){let n=null;n=function(){try{let r=e.native.read(e.chunkSize);if(r==null)e.native.once("readable",n);else{let s=typeof r=="string"?new le(r):r;t(h.Success(new Nt(s)))}}catch(r){let s=E.caught(r).unwrap();t(h.Failure(P.withData(null,"Error while reading from "+e.name,s,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:48,className:"tink.io.nodejs.WrappedReadable",methodName:"read"})))}},n()}),this.end)}}Kt.__name__=!0;class Zt{constructor(e,t){this.name=e,this.native=t,this.ended=x.async(function(n){t.once("end",function(){n(h.Success(!1))}),t.once("finish",function(){n(h.Success(!1))}),t.once("close",function(){n(h.Success(!1))}),t.on("error",function(r){n(h.Failure(new P(null,""+r.code+": "+r.message,{fileName:"tink/io/nodejs/WrappedWritable.hx",lineNumber:24,className:"tink.io.nodejs.WrappedWritable",methodName:"new"})))})})}end(){let e=!1,t=this.ended.handle(function(){e=!0});return t?.cancel(),e?new k(new w(h.Success(!1))):(this.native.end(),N.next(this.ended,function(n){return new k(new w(h.Success(!0)))}))}write(e){let t=this;return x.first(x.async(function(n){if(e.getLength()==0){n(h.Success(!0));return}let r;if(le.isBuffer(e.buffer))r=e.buffer;else{let c=e.toBytes(),_=c.b;r=le.from(_.buffer,_.byteOffset,c.length)}let s=n,i=h.Success(!0),l=function(){s(i)};t.native.write(r,null,l)}),this.ended)}}Zt.__name__=!0;class mn{static flush(e){return e.join("&")}}class Jt{constructor(){}stringify(e){let t=[];return this.process0("",t,e),mn.flush(t)}process0(e,t,n){let r=n.file;t.push(nn.ofString(e==""?"file":e+".file")+"="+nn.ofString(r))}}Jt.__name__=!0;class Qt{static future(e){return new tn(e)}static ofError(e){return new en(e)}}class ce extends pe{constructor(e){super(),this.parts=e}get_depleted(){switch(this.parts.length){case 0:return!0;case 1:return this.parts[0].get_depleted();default:return!1}}decompose(e){let t=0,n=this.parts;for(;t<n.length;)n[t++].decompose(e)}forEach(e){let t=this.parts,n=e;return x.async(function(r){ce.consumeParts(t,n,r)})}static consumeParts(e,t,n){e.length==0?n(A.Depleted):e[0].forEach(t).handle(function(r){switch(r._hx_index){case 0:e=e.slice(),e[0]=r.rest,n(A.Halted(new ce(e)));break;case 1:let s=r.at;s.get_depleted()?e=e.slice(1):(e=e.slice(),e[0]=s),n(A.Clogged(r.error,new ce(e)));break;case 2:n(A.Failed(r.error));break;case 3:ce.consumeParts(e.slice(1),t,n);break}})}static of(e){let t=[],n=0;for(;n<e.length;)e[n++].decompose(t);return t.length==0?Re.inst:new ce(t)}}ce.__name__=!0;var M=C["tink.streams.Handled"]={__ename__:!0,__constructs__:null,BackOff:{_hx_name:"BackOff",_hx_index:0,__enum__:"tink.streams.Handled",toString:d},Finish:{_hx_name:"Finish",_hx_index:1,__enum__:"tink.streams.Handled",toString:d},Resume:{_hx_name:"Resume",_hx_index:2,__enum__:"tink.streams.Handled",toString:d},Clog:(u=function(a){return{_hx_index:3,e:a,__enum__:"tink.streams.Handled",toString:d}},u._hx_name="Clog",u.__params__=["e"],u)};M.__constructs__=[M.BackOff,M.Finish,M.Resume,M.Clog];var A=C["tink.streams.Conclusion"]={__ename__:!0,__constructs__:null,Halted:(u=function(a){return{_hx_index:0,rest:a,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Halted",u.__params__=["rest"],u),Clogged:(u=function(a,e){return{_hx_index:1,error:a,at:e,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Clogged",u.__params__=["error","at"],u),Failed:(u=function(a){return{_hx_index:2,error:a,__enum__:"tink.streams.Conclusion",toString:d}},u._hx_name="Failed",u.__params__=["error"],u),Depleted:{_hx_name:"Depleted",_hx_index:3,__enum__:"tink.streams.Conclusion",toString:d}};A.__constructs__=[A.Halted,A.Clogged,A.Failed,A.Depleted];var Ve=C["tink.streams.ReductionStep"]={__ename__:!0,__constructs__:null,Progress:(u=function(a){return{_hx_index:0,result:a,__enum__:"tink.streams.ReductionStep",toString:d}},u._hx_name="Progress",u.__params__=["result"],u),Crash:(u=function(a){return{_hx_index:1,e:a,__enum__:"tink.streams.ReductionStep",toString:d}},u._hx_name="Crash",u.__params__=["e"],u)};Ve.__constructs__=[Ve.Progress,Ve.Crash];var xe=C["tink.streams.Reduction"]={__ename__:!0,__constructs__:null,Crashed:(u=function(a,e){return{_hx_index:0,error:a,at:e,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Crashed",u.__params__=["error","at"],u),Failed:(u=function(a){return{_hx_index:1,error:a,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Failed",u.__params__=["error"],u),Reduced:(u=function(a){return{_hx_index:2,result:a,__enum__:"tink.streams.Reduction",toString:d}},u._hx_name="Reduced",u.__params__=["result"],u)};xe.__constructs__=[xe.Crashed,xe.Failed,xe.Reduced];class en extends pe{constructor(e){super(),this.error=e}forEach(e){return new k(new w(A.Failed(this.error)))}}en.__name__=!0;class Fe extends pe{constructor(e){super(),this.value=e}forEach(e){let t=this;return x.map(e(V.get(this.value)),function(n){switch(n._hx_index){case 0:return A.Halted(t);case 1:return A.Halted(Re.inst);case 2:return A.Depleted;case 3:return A.Clogged(n.e,t)}})}}Fe.__name__=!0;class lt{static ofUnknown(e){return e}}class gn{static ofSafeSync(e){return function(t,n){return new k(new w(e(t,n)))}}}class tn extends pe{constructor(e){super(),this.f=e}forEach(e){let t=this;return x.async(function(n){t.f.handle(function(r){r.forEach(e).handle(n)})})}}tn.__name__=!0;var Se=C["tink.streams.Step"]={__ename__:!0,__constructs__:null,Link:(u=function(a,e){return{_hx_index:0,value:a,next:e,__enum__:"tink.streams.Step",toString:d}},u._hx_name="Link",u.__params__=["value","next"],u),Fail:(u=function(a){return{_hx_index:1,e:a,__enum__:"tink.streams.Step",toString:d}},u._hx_name="Fail",u.__params__=["e"],u),End:{_hx_name:"End",_hx_index:2,__enum__:"tink.streams.Step",toString:d}};Se.__constructs__=[Se.Link,Se.Fail,Se.End];class at{static _new(e,t){let n;if(t==null)n=e;else{if(t>65535||t<=0)throw E.thrown("Invalid port");n=""+e+":"+t}return n}static get_name(e){if(e==null)return null;{let t=e.split("]");switch(t.length){case 1:return t[0].split(":")[0];case 2:return t[0]+"]";default:throw E.thrown("assert")}}}static get_port(e){if(e==null)return null;{let t=e.split("]");switch(t.length){case 1:let n=t[0].split(":")[1];return n==null?null:B.parseInt(n);case 2:let r=t[1].split(":")[1];return r==null?null:B.parseInt(r);default:throw E.thrown("assert")}}}}class Te{static join(e,t){if(t=="")return e;if(t.charAt(0)=="/")return t;if(e.charAt(e.length-1)=="/")return Te.ofString(e+t);{let n=e.lastIndexOf("/");return n==-1?t:Te.ofString(F.substr(e,0,n+1)+(t??"null"))}}static ofString(e){return Te.normalize(e)}static normalize(e){if(e=O.trim(O.replace(e,"\\","/")),e==".")return"./";let t=e.endsWith("/..")||e.endsWith("/")||e.endsWith("/."),n=[],r=e.startsWith("/"),s=0,i=0,l=e.split("/");for(;i<l.length;){let c=O.trim(l[i++]);switch(c){case"":break;case".":break;case"..":n.pop()==null&&++s;break;default:n.push(c)}}if(r)n.unshift("");else{let c=0,_=s;for(;c<_;)++c,n.unshift("..")}return t&&n.push(""),n.join("/")}}class nn{static ofString(e){return e==null?"":encodeURIComponent(e)}}function rn(a){return a instanceof Array?new pt(a):a.iterator()}function sn(a,e){if(e==null)return null;e.__id__==null&&(e.__id__=ut.$haxeUID++);var t;return a.hx__closures__==null?a.hx__closures__={}:t=a.hx__closures__[e.__id__],t==null&&(t=e.bind(a),a.hx__closures__[e.__id__]=t),t}ut.$haxeUID|=0,typeof performance<"u"&&typeof performance.now=="function"&&(F.now=performance.now.bind(performance)),String.fromCodePoint==null&&(String.fromCodePoint=function(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a>>10)+55232)+String.fromCharCode((a&1023)+56320)}),String.__name__=!0,Array.__name__=!0,ie.__toStr={}.toString,oe.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",oe.BYTES=I.ofString(oe.CHARS),Ae.EMPTY=new I(new ArrayBuffer(0)),L.EMPTY=new Ae,b.depth=0,ae._hx_skip_constructor=!1,W._hx_skip_constructor=!1,x.NEVER_INST=new W,V.NOISE=new w(null),N.NOISE=new k(new w(h.Success(null))),te.cache=new ft,Z._hx_skip_constructor=!1,Y._hx_skip_constructor=!1,Re.inst=new Re,$.EMPTY=Re.inst,X.EAGER=new Gt,X.pool=[X.EAGER],qe.main()})(global);
