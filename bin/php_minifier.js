#!/usr/bin/env node
!function(e){"use strict";var t,n=function(){return B.__string_rec(this,"")},r=r||{};class s{constructor(e,t){this.r=new RegExp(e,t.split("u").join(""))}match(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m}matched(e){if(null!=this.r.m&&e>=0&&e<this.r.m.length)return this.r.m[e];throw p.thrown("EReg::matched")}}s.__name__=!0;class i{static cca(e,t){let n=e.charCodeAt(t);if(n==n)return n}static substr(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)}static now(){return Date.now()}}i.__name__=!0;class a{static fold(e,t,n){let r=Lt(e);for(;r.hasNext();)n=t(r.next(),n);return n}static find(e,t){let n=Lt(e);for(;n.hasNext();){let e=n.next();if(t(e))return e}return null}}a.__name__=!0,Math.__name__=!0;class l{static field(e,t){try{return e[t]}catch(e){return null}}static fields(e){let t=[];if(null!=e){let r=Object.prototype.hasOwnProperty;for(var n in e)"__id__"!=n&&"hx__closures__"!=n&&r.call(e,n)&&t.push(n)}return t}static compare(e,t){return e==t?0:e>t?1:-1}static isEnumValue(e){return null!=e&&null!=e.__enum__}static copy(e){if(null==e)return null;let t={},n=0,r=l.fields(e);for(;n<r.length;){let s=r[n];++n,t[s]=l.field(e,s)}return t}}l.__name__=!0;class u{static string(e){return B.__string_rec(e,"")}static parseInt(e){let t=parseInt(e);return isNaN(t)?null:t}static random(e){return e<=0?0:Math.floor(Math.random()*e)}}u.__name__=!0;class o{constructor(){this.b=""}}o.__name__=!0;class c{static isSpace(e,t){let n=i.cca(e,t);return n>8&&n<14||32==n}static ltrim(e){let t=e.length,n=0;for(;n<t&&c.isSpace(e,n);)++n;return n>0?i.substr(e,n,t-n):e}static rtrim(e){let t=e.length,n=0;for(;n<t&&c.isSpace(e,t-n-1);)++n;return n>0?i.substr(e,0,t-n):e}static trim(e){return c.ltrim(c.rtrim(e))}static lpad(e,t,n){if(t.length<=0)return e;let r="";for(n-=e.length;r.length<n;)r+=null==t?"null":""+t;return r+=null==e?"null":""+e,r}static replace(e,t,n){return e.split(t).join(n)}}c.__name__=!0;class h{static systemName(){let e=process.platform;switch(e){case"darwin":return"Mac";case"freebsd":return"BSD";case"linux":return"Linux";case"win32":return"Windows";default:return e}}}h.__name__=!0;class _{static enumParameters(e){let t=r[e.__enum__].__constructs__[e._hx_index].__params__;if(null!=t){let n=[],r=0;for(;r<t.length;){let s=t[r];++r,n.push(e[s])}return n}return[]}}_.__name__=!0;class d{static exists(e){let t=new ve;return O.stat(e,(function(e,n){t.trigger(null==e)})),t}static absolutePath(e){return R.isAbsolute(e)?e:R.join([R.addTrailingSlash(process.cwd()),e])}static isDirectory(e){let t=new ve;return O.stat(e,(function(e,n){t.trigger(null==e&&n.isDirectory())})),t}static mkdir(e){return ye.async((function(t){O.mkdir(e,(function(e){t(null==e||"EEXIST"==e.code?Te.Success(null):Te.Failure(we.withData(500,e.message,e,{fileName:"asys/FileSystem.hx",lineNumber:92,className:"asys.FileSystem",methodName:"mkdir"})))}))}))}static createDirectory(e){let t=ye.async((function(t){d.isDirectory(e).handle((function(n){n?t(Te.Success(null)):d.mkdir(e).handle((function(n){1==n._hx_index&&"ENOENT"==n.failure.data.code?Ae.next(d.createDirectory(M.dirname(e)),(function(t){return d.mkdir(e)})).handle(t):t(n)}))}))}));return t.eager(),t}}d.__name__=!0;class f{static saveContent(e,t){let n=new ve;return O.writeFile(e,t,"utf8",(function(e){n.trigger(null==e?Te.Success(null):Te.Failure(we.withData(null,e.message,e,{fileName:"asys/io/File.hx",lineNumber:53,className:"asys.io.File",methodName:"saveContent"})))})),n}}f.__name__=!0;var m=r["haxe.StackItem"]={__ename__:!0,__constructs__:null,CFunction:{_hx_name:"CFunction",_hx_index:0,__enum__:"haxe.StackItem",toString:n},Module:(t=function(e){return{_hx_index:1,m:e,__enum__:"haxe.StackItem",toString:n}},t._hx_name="Module",t.__params__=["m"],t),FilePos:(t=function(e,t,r,s){return{_hx_index:2,s:e,file:t,line:r,column:s,__enum__:"haxe.StackItem",toString:n}},t._hx_name="FilePos",t.__params__=["s","file","line","column"],t),Method:(t=function(e,t){return{_hx_index:3,classname:e,method:t,__enum__:"haxe.StackItem",toString:n}},t._hx_name="Method",t.__params__=["classname","method"],t),LocalFunction:(t=function(e){return{_hx_index:4,v:e,__enum__:"haxe.StackItem",toString:n}},t._hx_name="LocalFunction",t.__params__=["v"],t)};m.__constructs__=[m.CFunction,m.Module,m.FilePos,m.Method,m.LocalFunction];class p extends Error{constructor(e,t,n){super(e),this.message=e,this.__previousException=t,this.__nativeException=null!=n?n:this}unwrap(){return this.__nativeException}get_native(){return this.__nativeException}static caught(e){return e instanceof p?e:e instanceof Error?new p(e.message,null,e):new x(e,null,e)}static thrown(e){if(e instanceof p)return e.get_native();if(e instanceof Error)return e;return new x(e)}}p.__name__=!0;class g{constructor(e){let t=this;this.id=setInterval((function(){t.run()}),e)}stop(){null!=this.id&&(clearInterval(this.id),this.id=null)}run(){}static delay(e,t){let n=new g(t);return n.run=function(){n.stop(),e()},n}}g.__name__=!0;class x extends p{constructor(e,t,n){super(String(e),t,n),this.value=e}unwrap(){return this.value}}x.__name__=!0;class w{constructor(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}blit(e,t,n,r){if(e<0||n<0||r<0||e+r>this.length||n+r>t.length)throw p.thrown(T.OutsideBounds);0==n&&r==t.b.byteLength?this.b.set(t.b,e):this.b.set(t.b.subarray(n,n+r),e)}sub(e,t){if(e<0||t<0||e+t>this.length)throw p.thrown(T.OutsideBounds);return new w(this.b.buffer.slice(e+this.b.byteOffset,e+this.b.byteOffset+t))}getString(e,t,n){if(e<0||t<0||e+t>this.length)throw p.thrown(T.OutsideBounds);null==n&&(n=S.UTF8);let r="",s=this.b,i=e,a=e+t;switch(n._hx_index){case 0:for(;i<a;){let e=s[i++];if(e<128){if(0==e)break;r+=String.fromCodePoint(e)}else if(e<224){let t=(63&e)<<6|127&s[i++];r+=String.fromCodePoint(t)}else if(e<240){let t=(31&e)<<12|(127&s[i++])<<6|127&s[i++];r+=String.fromCodePoint(t)}else{let t=(15&e)<<18|(127&s[i++])<<12|(127&s[i++])<<6|127&s[i++];r+=String.fromCodePoint(t)}}break;case 1:for(;i<a;){let e=s[i++]|s[i++]<<8;r+=String.fromCodePoint(e)}}return r}toString(){return this.getString(0,this.length)}static ofString(e,t){if(t==S.RawNative){let t=new Uint8Array(e.length<<1),n=0,r=e.length;for(;n<r;){let r=n++,s=e.charCodeAt(r);t[r<<1]=255&s,t[r<<1|1]=s>>8}return new w(t.buffer)}let n=[],r=0;for(;r<e.length;){let t=e.charCodeAt(r++);55296<=t&&t<=56319&&(t=t-55232<<10|1023&e.charCodeAt(r++)),t<=127?n.push(t):t<=2047?(n.push(192|t>>6),n.push(128|63&t)):t<=65535?(n.push(224|t>>12),n.push(128|t>>6&63),n.push(128|63&t)):(n.push(240|t>>18),n.push(128|t>>12&63),n.push(128|t>>6&63),n.push(128|63&t))}return new w(new Uint8Array(n).buffer)}static ofData(e){let t=e.hxBytes;return null!=t?t:new w(e)}}w.__name__=!0;var S=r["haxe.io.Encoding"]={__ename__:!0,__constructs__:null,UTF8:{_hx_name:"UTF8",_hx_index:0,__enum__:"haxe.io.Encoding",toString:n},RawNative:{_hx_name:"RawNative",_hx_index:1,__enum__:"haxe.io.Encoding",toString:n}};S.__constructs__=[S.UTF8,S.RawNative];class b{static encode(e,t){null==t&&(t=!0);let n=new k(b.BYTES).encodeBytes(e).toString();if(t)switch(e.length%3){case 1:n+="==";break;case 2:n+="="}return n}}b.__name__=!0;class k{constructor(e){let t=e.length,n=1;for(;t>1<<n;)++n;if(n>8||t!=1<<n)throw p.thrown("BaseCode : base length must be a power of two.");this.base=e,this.nbits=n}encodeBytes(e){let t=this.nbits,n=this.base,r=8*e.length/t|0,s=new w(new ArrayBuffer(r+(8*e.length%t==0?0:1))),i=0,a=0,l=(1<<t)-1,u=0,o=0;for(;o<r;){for(;a<t;)a+=8,i<<=8,i|=e.b[u++];a-=t,s.b[o++]=n.b[i>>a&l]}return a>0&&(s.b[o++]=n.b[i<<t-a&l]),s}}k.__name__=!0;class y{constructor(){}set(e,t){this.root=this.setLoop(e,t,this.root)}get(e){let t=this.root;for(;null!=t;){let n=this.compare(e,t.key);if(0==n)return t.value;t=n<0?t.left:t.right}return null}exists(e){let t=this.root;for(;null!=t;){let n=this.compare(e,t.key);if(0==n)return!0;t=n<0?t.left:t.right}return!1}setLoop(e,t,n){if(null==n)return new P(null,e,t,null);let r=this.compare(e,n.key);if(0==r)return new P(n.left,e,t,n.right,null==n?0:n._height);if(r<0)return this.balance(this.setLoop(e,t,n.left),n.key,n.value,n.right);{let r=this.setLoop(e,t,n.right);return this.balance(n.left,n.key,n.value,r)}}balance(e,t,n,r){let s=null==e?0:e._height,i=null==r?0:r._height;if(s>i+2){let s=e.left,i=e.right;return(null==s?0:s._height)>=(null==i?0:i._height)?new P(e.left,e.key,e.value,new P(e.right,t,n,r)):new P(new P(e.left,e.key,e.value,e.right.left),e.right.key,e.right.value,new P(e.right.right,t,n,r))}if(i>s+2){let s=r.right,i=r.left;return(null==s?0:s._height)>(null==i?0:i._height)?new P(new P(e,t,n,r.left),r.key,r.value,r.right):new P(new P(e,t,n,r.left.left),r.left.key,r.left.value,new P(r.left.right,r.key,r.value,r.right))}return new P(e,t,n,r,(s>i?s:i)+1)}compare(e,t){return l.compare(e,t)}}y.__name__=!0;class P{constructor(e,t,n,r,s){if(null==s&&(s=-1),this.left=e,this.key=t,this.value=n,this.right=r,-1==s){let e,t=this.left,n=this.right;if((null==t?0:t._height)>(null==n?0:n._height)){let t=this.left;e=null==t?0:t._height}else{let t=this.right;e=null==t?0:t._height}this._height=e+1}else this._height=s}}P.__name__=!0;class v extends y{constructor(){super()}compare(e,t){let n=e._hx_index-t._hx_index;if(0!=n)return n;let r=_.enumParameters(e),s=_.enumParameters(t);return 0==r.length&&0==s.length?0:this.compareArgs(r,s)}compareArgs(e,t){let n=e.length-t.length;if(0!=n)return n;let r=0,s=e.length;for(;r<s;){let n=r++,s=this.compareArg(e[n],t[n]);if(0!=s)return s}return 0}compareArg(e,t){return l.isEnumValue(e)&&l.isEnumValue(t)?this.compare(e,t):e instanceof Array&&t instanceof Array?this.compareArgs(e,t):l.compare(e,t)}}v.__name__=!0;var N=r["haxe.ds.Option"]={__ename__:!0,__constructs__:null,Some:(t=function(e){return{_hx_index:0,v:e,__enum__:"haxe.ds.Option",toString:n}},t._hx_name="Some",t.__params__=["v"],t),None:{_hx_name:"None",_hx_index:1,__enum__:"haxe.ds.Option",toString:n}};N.__constructs__=[N.Some,N.None];class C{constructor(){this.h=Object.create(null)}}C.__name__=!0;class E{constructor(e){this.url=e,this.headers=[],this.params=[],this.emptyOnData=Mt(this,this.onData)}setHeader(e,t){let n=0,r=this.headers.length;for(;n<r;){let r=n++;if(this.headers[r].name==e)return void(this.headers[r]={name:e,value:t})}this.headers.push({name:e,value:t})}setPostData(e){this.postData=e,this.postBytes=null}onData(e){}onBytes(e){}onError(e){}onStatus(e){}hasOnData(){return Mt(this,this.onData)!=this.emptyOnData}success(e){this.responseBytes=e,this.responseAsString=null,this.hasOnData()&&this.onData(this.get_responseData()),this.onBytes(this.responseBytes)}get_responseData(){return null==this.responseAsString&&null!=this.responseBytes&&(this.responseAsString=this.responseBytes.getString(0,this.responseBytes.length,S.UTF8)),this.responseAsString}}E.__name__=!0;class F extends E{constructor(e){super(e)}request(e){this.responseAsString=null,this.responseBytes=null,this.responseHeaders=null;let t=new z(this.url),n="https:"==t.protocol,r=t.hostname,s=t.pathname,i=null!=t.port?u.parseInt(t.port):n?443:80,a={},o=0,c=this.headers;for(;o<c.length;){let e=c[o];++o;let t=l.field(a,e.name);null==t&&(t=[],a[e.name]=t),t.push(e.value)}null==this.postData&&null==this.postBytes||(e=!0);let h=null,_=0,d=this.params;for(;_<d.length;){let e=d[_];++_,null==h?h="":h+="&";let t=e.name,n=encodeURIComponent(t)+"=",r=e.value;h+=n+encodeURIComponent(r)}let f=s.split("?").length<=1;null!=h&&(s+=(f?"?":"&")+h);let m={protocol:t.protocol,hostname:r,port:i,method:e?"POST":"GET",path:s,headers:a},p=this,g=function(e){e.setEncoding("binary");let t=e.statusCode;null!=t&&p.onStatus(t);let n=[];e.on("data",(function(e){n.push(j.from(e,"binary"))})),e.on("end",(function(r){let s=1==n.length?n[0]:j.concat(n),i=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);p.responseBytes=w.ofData(i),p.req=null,p.responseHeaders=new C;let a=0,u=l.fields(e.headers);for(;a<u.length;){let t=u[a];++a,p.responseHeaders.h[t]=l.field(e.headers,t)}null!=t&&t>=200&&t<400?p.success(p.responseBytes):p.onError("Http Error #"+t)}))};this.req=n?I.request(m,g):H.request(m,g),e&&(null!=this.postData?this.req.write(this.postData):null!=this.postBytes&&(this.req.setHeader("Content-Length",""+this.postBytes.length),this.req.write(j.from(this.postBytes.b.bufferValue)))),this.req.end()}}F.__name__=!0;var T=r["haxe.io.Error"]={__ename__:!0,__constructs__:null,Blocked:{_hx_name:"Blocked",_hx_index:0,__enum__:"haxe.io.Error",toString:n},Overflow:{_hx_name:"Overflow",_hx_index:1,__enum__:"haxe.io.Error",toString:n},OutsideBounds:{_hx_name:"OutsideBounds",_hx_index:2,__enum__:"haxe.io.Error",toString:n},Custom:(t=function(e){return{_hx_index:3,e:e,__enum__:"haxe.io.Error",toString:n}},t._hx_name="Custom",t.__params__=["e"],t)};T.__constructs__=[T.Blocked,T.Overflow,T.OutsideBounds,T.Custom];class R{constructor(e){switch(e){case".":case"..":return this.dir=e,void(this.file="")}let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");t<n?(this.dir=i.substr(e,0,n),e=i.substr(e,n+1,null),this.backslash=!0):n<t?(this.dir=i.substr(e,0,t),e=i.substr(e,t+1,null)):this.dir=null;let r=e.lastIndexOf(".");-1!=r?(this.ext=i.substr(e,r+1,null),this.file=i.substr(e,0,r)):(this.ext=null,this.file=e)}static directory(e){let t=new R(e);return null==t.dir?"":t.dir}static extension(e){let t=new R(e);return null==t.ext?"":t.ext}static join(e){let t=[],n=0;for(;n<e.length;){let r=e[n];++n,null!=r&&""!=r&&t.push(r)}if(0==t.length)return"";let r=t[0],s=1,i=t.length;for(;s<i;)r=R.addTrailingSlash(r),r+=t[s++];return R.normalize(r)}static normalize(e){let t="/";if((e=e.split("\\").join(t))==t)return t;let n=[],r=0,s=e.split(t);for(;r<s.length;){let t=s[r];++r,".."==t&&n.length>0&&".."!=n[n.length-1]?n.pop():""==t?(n.length>0||47==i.cca(e,0))&&n.push(t):"."!=t&&n.push(t)}let a="",l=!1,u=!1,o=0,c=n.join(t);for(;o<c.length;){let e=c,t=o++,n=e.charCodeAt(t);n>=55296&&n<=56319&&(n=n-55232<<10|1023&e.charCodeAt(t+1));n>=65536&&++o;let r=n;switch(r){case 47:if(l){let e=r;l=!1,u&&(a+="/",u=!1),a+=String.fromCodePoint(e)}else u=!0;break;case 58:a+=":",l=!0;break;default:let e=r;l=!1,u&&(a+="/",u=!1),a+=String.fromCodePoint(e)}}return a}static addTrailingSlash(e){if(0==e.length)return"/";let t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return t<n?n!=e.length-1?e+"\\":e:t!=e.length-1?e+"/":e}static isAbsolute(e){return!!e.startsWith("/")||(":"==e.charAt(1)||!!e.startsWith("\\\\"))}}R.__name__=!0;class A{constructor(e){this.current=0,this.array=e}hasNext(){return this.current<this.array.length}next(){return this.array[this.current++]}}A.__name__=!0;class D{static fromCode(e){switch(e){case 100:return"Continue";case 101:return"Switching Protocols";case 102:return"Processing";case 200:return"OK";case 201:return"Created";case 202:return"Accepted";case 203:return"Non-Authoritative Information";case 204:return"No Content";case 205:return"Reset Content";case 206:return"Partial Content";case 207:return"Multi-Status";case 208:return"Already Reported";case 226:return"IM Used";case 300:return"Multiple Choices";case 301:return"Moved Permanently";case 302:return"Found";case 303:return"See Other";case 304:return"Not Modified";case 305:return"Use Proxy";case 306:return"Switch Proxy";case 307:return"Temporary Redirect";case 308:return"Permanent Redirect";case 400:return"Bad Request";case 401:return"Unauthorized";case 402:return"Payment Required";case 403:return"Forbidden";case 404:return"Not Found";case 405:return"Method Not Allowed";case 406:return"Not Acceptable";case 407:return"Proxy Authentication Required";case 408:return"Request Timeout";case 409:return"Conflict";case 410:return"Gone";case 411:return"Length Required";case 412:return"Precondition Failed";case 413:return"Payload Too Large";case 414:return"URI Too Long";case 415:return"Unsupported Media Type";case 416:return"Range Not Satisfiable";case 417:return"Expectation Failed";case 418:return"I'm a teapot";case 421:return"Misdirected Request";case 422:return"Unprocessable Entity";case 423:return"Locked";case 424:return"Failed Dependency";case 426:return"Upgrade Required";case 428:return"Precondition Required";case 429:return"Too Many Requests";case 431:return"Request Header Fields Too Large";case 451:return"Unavailable For Legal Reasons";case 500:return"Internal Server Error";case 501:return"Not Implemented";case 502:return"Bad Gateway";case 503:return"Service Unavailable";case 504:return"Gateway Timeout";case 505:return"HTTP Version Not Supported";case 506:return"Variant Also Negotiates";case 507:return"Insufficient Storage";case 508:return"Loop Detected";case 510:return"Not Extended";case 511:return"Network Authentication Required";default:return"Unknown Status"}}}class B{static __string_rec(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";let n=typeof e;switch("function"==n&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e.__enum__){let n=r[e.__enum__].__constructs__[e._hx_index],s=n._hx_name;return n.__params__?(t+="\t",s+"("+function(){let r=[];{let s=0,i=n.__params__;for(;s<i.length;){let n=i[s];s+=1,r.push(B.__string_rec(e[n],t))}}return r}().join(",")+")"):s}if(e instanceof Array){let n="[";t+="\t";let r=0,s=e.length;for(;r<s;){let s=r++;n+=(s>0?",":"")+B.__string_rec(e[s],t)}return n+="]",n}let n;try{n=e.toString}catch(e){return"???"}if(null!=n&&n!=Object.toString&&"function"==typeof n){let t=e.toString();if("[object Object]"!=t)return t}let s="{\n";t+="\t";let i=null!=e.hasOwnProperty,a=null;for(a in e)i&&!e.hasOwnProperty(a)||"prototype"!=a&&"__class__"!=a&&"__super__"!=a&&"__interfaces__"!=a&&"__properties__"!=a&&(2!=s.length&&(s+=", \n"),s+=t+a+" : "+B.__string_rec(e[a],t));return s+="\n"+(t=t.substring(1))+"}",s;case"string":return e;default:return String(e)}}}B.__name__=!0;var q=require("child_process"),O=require("fs"),H=require("http"),I=require("https"),L=require("net"),M=require("path"),j=require("buffer").Buffer;class U{static bytesOfBuffer(e){let t=Object.create(w.prototype);return t.length=e.byteLength,t.b=e,e.bufferValue=e,e.hxBytes=t,e.bytes=e,t}}U.__name__=!0;var z=require("url").URL;class W{constructor(e){null==e&&(e="php"),this.process=null,this.port=-1,this.executable=R.normalize(e)}close(){let e=this.process;return null!=e&&e.kill(),this.process=null,new ke(new be(Te.Success(null)))}transform(e){let t=this;return Ae.next(Ae.next(this.listen(),(function(n){return Oe.all(Be.fetch(Q.fromString("http://127.0.0.1:"+t.port+"/index.php?"+(new yt).stringify({file:d.absolutePath(e)})),null))})),(function(e){return new ke(new be(Te.Success(e.body.toString())))}))}getPort(){let e=new ve,t=L.createServer().on("error",(function(t){let n=we.withData(500,t.message,t,{fileName:"src/php_minifier/FastTransformer.hx",lineNumber:47,className:"php_minifier.FastTransformer",methodName:"getPort"});return e.trigger(Te.Failure(n))}));return t.listen(0,"127.0.0.1",(function(){let n=t.address().port;t.close((function(){e.trigger(Te.Success(n))}))})),t.unref(),e}listen(){let e=this;return null!=this.process?new ke(new be(Te.Success(null))):Ae.next(this.getPort(),(function(t){let n=new ve;e.port=t;let r=e.executable,s="127.0.0.1:"+e.port,i=R.join([__dirname,"../www"]);return e.process=q.spawn(r,["-S",s,"-t",i],{stdio:["ignore","pipe","ignore"]}).on("error",(function(e){let t=we.withData(500,e.message,e,{fileName:"src/php_minifier/FastTransformer.hx",lineNumber:64,className:"php_minifier.FastTransformer",methodName:"listen"});return n.trigger(Te.Failure(t))})).on("spawn",(function(){let e=ye.delay(1e3,new be(null)),t=n;return e.handle((function(e){return t.trigger(Te.Success(e))}))})),n}))}}W.__name__=!0;class V{static get_packageVersion(){return null==V.packageVersion&&(V.packageVersion="4.0.1"),V.packageVersion}}V.__name__=!0;class Y{constructor(){this.version=!1,this.help=!1,this.silent=!1,this.mode="safe",this.extension="php",this.binary="php"}run(e){if(this.help||this.version){let e=this.version?V.get_packageVersion():(new le).format(se.get());return process.stdout.write(u.string(e)),process.stdout.write("\n"),new ke(new be(Te.Success(null)))}let t="1"==process.env.HAXELIB_RUN;if(e.length<(t?2:1))return new ke(new be(Te.Failure(new we(400,"You must provide the path to the input directory.",{fileName:"src/php_minifier/Program.hx",lineNumber:59,className:"php_minifier.Program",methodName:"run"}))));let n=t?e.pop():R.addTrailingSlash(process.cwd()),r=this.resolvePath(e.shift(),n),s=e.length>0?this.resolvePath(e.shift(),n):r,a=this;return ye.flatMap(d.exists(r),(function(e){if(e){let e=R.addTrailingSlash(r).length,t=a,n=r,l=s,u=a.listDirectory(r),o=new Array(u.length),c=0,h=u.length;for(;c<h;){let t=c++;o[t]=i.substr(u[t],e,null)}return t.minifyFiles(n,l,o)}return new ke(new be(Te.Failure(new we(404,"The input directory was not found.",{fileName:"src/php_minifier/Program.hx",lineNumber:65,className:"php_minifier.Program",methodName:"run"}))))}))}listDirectory(e){let t=[],n=0,r=O.readdirSync(e);for(;n<r.length;){let s=r[n];++n;let i=R.join([e,s]);$.isDirectory(i)?t=t.concat(this.listDirectory(i)):R.extension(s).toLowerCase()==this.extension&&t.push(i)}return t}minifyFiles(e,t,n){let r="Windows"==h.systemName(),s="fast"==this.mode?new W(this.binary):new G(this.binary),i=this,a=function(n){let a=function(e){if(!i.silent){let e=r?c.replace(n,"/","\\"):n;process.stdout.write(u.string("Minifying: "+e)),process.stdout.write("\n")}},l=function(e){0==e._hx_index&&he.invoke(a,e.data)};return Ae.next(Ae.next(ye.map(Ae.NOISE,(function(e){return he.invoke(l,e),e})),(function(t){return s.transform(R.join([e,n]))})),(function(e){let r=R.join([t,n]);return Ae.next(d.createDirectory(R.directory(r)),(function(t){return f.saveContent(r,e)}))}))},l=new Array(n.length),o=0,_=n.length;for(;o<_;){let e=o++;l[e]=a(n[e])}return Ae.next(Ae.inSequence(l),(function(e){return s.close()}))}resolvePath(e,t){return R.isAbsolute(e)?R.normalize(e):R.join([t,e])}static main(){process.title="PHP Minifier",new ae(new Y,new ce(5)).process(process.argv.slice(2)).handle(J.exit)}}Y.__name__=!0;class G{constructor(e){null==e&&(e="php"),this.executable=R.normalize(e)}close(){return new ke(new be(Te.Success(null)))}transform(e){let t=this,n=function(n,r){var s,i;return s=n,i=r,q.execFile(t.executable,["-w",d.absolutePath(e)],{maxBuffer:20971520},(function(e,t,n){null!=e?i(we.withData(500,e.message,e,{fileName:"src/php_minifier/SafeTransformer.hx",lineNumber:24,className:"php_minifier.SafeTransformer",methodName:"transform"})):s(t)})),null};return new Ne((function(e){return n((function(t){e(Te.Success(t))}),(function(t){e(Te.Failure(t))}))}))}}G.__name__=!0;class ${static isDirectory(e){try{return O.statSync(e).isDirectory()}catch(e){return!1}}}$.__name__=!0;class X{getCursor(){return null==this.flattened&&this.flatten(this.flattened=[]),te.create(this.flattened.slice())}flatten(e){}}X.__name__=!0;class K extends X{constructor(){super()}getLength(){return 0}blitTo(e,t){}toString(){return""}toBytes(){return K.EMPTY}}K.__name__=!0;class Z{static concat(e,t){return ne.cons(e,t)}static join(e){if(null==e)return Z.EMPTY;switch(e.length){case 0:return Z.EMPTY;case 1:return e[0];default:let t=Z.concat(e[0],e[1]),n=2,r=e.length;for(;n<r;)t=Z.concat(t,e[n++]);return t}}}class J{static exit(e){switch(e._hx_index){case 0:process.exit(0);break;case 1:let t=e.failure,n=t.message;null!=t.data&&(n+=", "+(null==t.data?"null":u.string(t.data))),process.stdout.write(u.string(n)),process.stdout.write("\n");let r=t.code;process.exit(r)}}}J.__name__=!0;class Q{static resolve(e,t){if(null!=t.scheme)return t;if(null!=t.hosts[0]){if(null!=t.scheme)return t;{let n=l.copy(t);return n.scheme=e.scheme,n}}{let n={path:Ht.join(e.path,t.path),payload:"",scheme:e.scheme,query:t.query,auth:e.auth,hosts:e.hosts,hash:t.hash};return Q.makePayload(n),n}}static makePayload(e){let t="",n=e.auth,r=e.hosts;null==n?0!=r.length&&(t="//"+r.join(",")):t=0==r.length?"//"+(null==n?"null":null==n?"":n+"@"):"//"+(null==n?"null":null==n?"":n+"@")+r.join(","),t+=null==e.path?"null":e.path;let s=e.query;null!=s&&(t+="?"+(null==s?"null":s));let i=e.hash;null!=i&&(t+="#"+i),e.payload=t.toString()}static toString(e){return null==e.scheme?e.payload:e.scheme+":"+e.payload}static fromString(e){return Q.parse(e)}static noop(e){}static parse(e,t){for(;;){if(null==e){e="",t=null;continue}if(null==t&&(t=Q.noop),(e=c.trim(e)).startsWith("data:"))return{scheme:"data",payload:i.substr(e,5,null),hosts:[]};let n,r=new s("^(([a-zA-Z][a-zA-Z0-9\\-+.]*):)?((//(([^@/]+)@)?([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?)$",""),a=new s("^(\\[(.*)\\]|([^:]*))(:(.*))?$","");r.match(e);let l=r.matched(7);if(null==l)n=[];else{let e=[],r=0,s=l.split(",");for(;r<s.length;){let n,i=s[r];++r,a.match(i);let l,o=a.matched(3),c=a.matched(2);null==c?n=o:null==o?n="["+c+"]":(t("invalid host "+i),n=null);let h=a.matched(5);if(null==h)l=null;else{let e=u.parseInt(h);null==e?(t("invalid port "+h),l=null):l=e}e.push(Ot._new(n,l))}n=e}let o=r.matched(8);return n.length>0&&"/"!=o.charAt(0)&&(o="/"+o),{scheme:r.matched(2),payload:r.matched(3),hosts:n,auth:r.matched(6),path:Ht.ofString(o),query:r.matched(10),hash:r.matched(12)}}}static make(e){let t={payload:"",path:e.path,query:e.query,hosts:e.hosts,auth:e.auth,scheme:e.scheme,hash:e.hash};return Q.makePayload(t),t}}class ee extends X{constructor(e,t,n){super(),this.data=e,this.from=t,this.to=n}flatten(e){e.push(this)}getLength(){return this.to-this.from}getSlice(e,t){return t>this.to-this.from&&(t=this.to-this.from),e<0&&(e=0),t<=e?null:t==this.to-this.from&&0==e?this:new ee(this.data,this.from+e,t+this.from)}slice(e,t){let n=this.getSlice(e,t);return null==n?Z.EMPTY:n}blitTo(e,t){null==this.wrapped&&(this.wrapped=w.ofData(this.data)),e.blit(t,this.wrapped,this.from,this.to-this.from)}toBytes(){return null==this.wrapped&&(this.wrapped=w.ofData(this.data)),this.wrapped.sub(this.from,this.to-this.from)}toString(){return null==this.wrapped&&(this.wrapped=w.ofData(this.data)),this.wrapped.getString(this.from,this.to-this.from)}static of(e){if(0==e.length)return Z.EMPTY;let t=new ee(e.b.bufferValue,0,e.length);return t.wrapped=e,t}}ee.__name__=!0;class te{constructor(){this.currentByte=-1,this.currentPos=0,this.length=0,this.curLength=0,this.curOffset=0,this.curPartIndex=0}reset(){this.length=0,this.currentPos=0,this.currentByte=-1,this.curOffset=0;let e=0,t=this.parts;for(;e<t.length;){let n=t[e];++e,this.length+=n.to-n.from}if(this.curPartIndex=0,this.curPart=this.parts[0],null!=this.curPart){let e=this.curPart;this.curLength=e.to-e.from;let t=this.curPart;this.currentByte=t.data.bytes[t.from]}}flush(){let e=this.left();return this.shift(),e}add(e){e.flatten(this.parts),this.reset()}shift(e){this.parts.splice(0,this.curPartIndex);let t=this.parts[0];if(null!=t){let e=t.getSlice(this.curOffset,this.curLength);null==e?this.parts.shift():this.parts[0]=e}null!=e?this.add(e):this.reset()}left(){if(null==this.curPart)return Z.EMPTY;let e=[],t=0,n=this.curPartIndex;for(;t<n;)e.push(this.parts[t++]);return e.push(this.curPart.slice(0,this.curOffset)),Z.join(e)}right(){if(null==this.curPart)return Z.EMPTY;let e=[],t=this.curPartIndex,n=this.parts.length;for(;t<n;)e.push(this.parts[t++]);return e.length>0&&(e[0]=this.curPart.slice(this.curOffset,this.curLength)),Z.join(e)}ffwd(){this.currentByte=-1,this.curLength=0,this.curOffset=0,this.curPart=null,this.curPartIndex=this.parts.length}next(){if(this.currentPos==this.length)return!1;if(this.currentPos++,this.currentPos==this.length)return this.ffwd(),!1;if(this.curOffset==this.curLength-1){this.curOffset=0,this.curPart=this.parts[++this.curPartIndex];let e=this.curPart;this.curLength=e.to-e.from;let t=this.curPart;this.currentByte=t.data.bytes[t.from]}else{let e=this.curPart;this.currentByte=e.data.bytes[e.from+ ++this.curOffset]}return!0}static create(e){let t=new te;return t.parts=e,t.reset(),t}}te.__name__=!0;class ne extends X{constructor(){super()}getLength(){return this.length}flatten(e){let t=0,n=this.chunks;for(;t<n.length;)n[t++].flatten(e)}blitTo(e,t){let n=0,r=this.chunks.length;for(;n<r;){let r=n++;this.chunks[r].blitTo(e,t+this.offsets[r])}}toString(){return this.toBytes().toString()}toBytes(){let e=new w(new ArrayBuffer(this.length));return this.blitTo(e,0),e}static asCompound(e){return e instanceof ne?e:null}static cons(e,t){let n=e.getLength(),r=t.getLength();if(0==n)return 0==r?Z.EMPTY:t;if(0==r)return e;{let n=ne.asCompound(e),r=ne.asCompound(t);if(null==n){if(null==r)return ne.create([e,t],2);if(r.depth<100)return ne.create([e,t],r.depth+1);{let e=[];return r.flatten(e),t.flatten(e),ne.create(e,2)}}if(null==r){if(n.depth<100)return ne.create([e,t],n.depth+1);{let e=[];return n.flatten(e),t.flatten(e),ne.create(e,2)}}{let e=n.depth>r.depth?n.depth:r.depth;return ne.create(n.chunks.concat(r.chunks),e)}}}static create(e,t){let n=new ne,r=[0],s=0,i=0;for(;i<e.length;)r.push(s+=e[i++].getLength());return n.chunks=e,n.offsets=r,n.length=s,n.depth=t,n}}ne.__name__=!0;class re{constructor(e){this.buffer=e}getCursor(){return ee.of(this.toBytes()).getCursor()}flatten(e){ee.of(this.toBytes()).flatten(e)}getLength(){return this.buffer.length}toString(){return this.buffer.toString()}toBytes(){let e=j.allocUnsafe(this.buffer.length);return this.buffer.copy(e),U.bytesOfBuffer(e)}blitTo(e,t){let n=e.b;this.buffer.copy(j.from(n.buffer,n.byteOffset,e.length),t)}}re.__name__=!0;class se{static get(){return null==se.doc&&(se.doc={doc:"\r\n\tMinify PHP source code by removing comments and whitespace.\r\n\r\n\t> npx @cedx/php-minifier [flags] <input> [output]\r\n",commands:[{isDefault:!0,isSub:!1,names:[],doc:"\r\n\t\tinput  : The input directory.\r\n\t\toutput : The output directory.\r\n\t"}],flags:[{names:["--binary"],aliases:["b"],doc:" The path to the PHP executable. "},{names:["--extension"],aliases:["e"],doc:' The extension of the PHP files to process. Defaults to "php". '},{names:["--mode"],aliases:["m"],doc:' The operation mode of the minifier. Defaults to "safe". '},{names:["--silent"],aliases:["s"],doc:" Value indicating whether to silence the minifier output. "},{names:["--help"],aliases:["h"],doc:" Display this help. "},{names:["--version"],aliases:["v"],doc:" Output the version number. "}]}),se.doc}}se.__name__=!0;class ie{constructor(e,t,n){this.command=e,this.prompt=t,this.hasFlags=n}processArgs(e){let t=this;return this.hasFlags?we.catchExceptions((function(){let n=ie.expandAssignments(e),r=[],s=0,a=!1;for(;s<n.length;){let e=n[s];if("--"==e)a=!0,++s;else if(a||45!=i.cca(e,0))r.push(e),++s;else{let r=t.processFlag(n,s);if(-1==r){if(45==i.cca(e,1))throw p.thrown('Unrecognized flag "'+e+'"');{let r=t.processAlias(n,s);if(-1==r)throw p.thrown('Unrecognized alias "'+e+'"');s+=r+1}}else s+=r+1}}return r}),null,{fileName:"tink/cli/Router.hx",lineNumber:25,className:"tink.cli.Router",methodName:"processArgs"}):Te.Success(e)}processFlag(e,t){return-1}processAlias(e,t){return-1}static expandAssignments(e){let t=[],n=!0,r=0;for(;r<e.length;){let s=e[r];if(++r,"--"==s&&(n=!1),n){let e=i.cca(s,0),n=i.cca(s,1),r=s.indexOf("=");null==e?t.push(s):45==e?null==n?t.push(s):45==n&&-1!=r?(t.push(i.substr(s,0,r)),t.push(i.substr(s,r+1,null))):t.push(s):t.push(s)}else t.push(s)}return t}}ie.__name__=!0;class ae extends ie{constructor(e,t){super(e,t,!0)}process(e){let t=this;if(null==e[0]){let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new ke(new be(Te.Failure(r.failure)))}return Ae.next(this.promptRequired(),(function(e){return t.run_run(n)}))}{let n,r=this.processArgs(e);switch(r._hx_index){case 0:n=r.data;break;case 1:return new ke(new be(Te.Failure(r.failure)))}return Ae.next(this.promptRequired(),(function(e){return t.run_run(n)}))}}processFlag(e,t){let n=t;switch(e[t]){case"--binary":n=t+1,this.command.binary=e[n];break;case"--extension":n=t+1,this.command.extension=e[n];break;case"--help":this.command.help=!0;break;case"--mode":n=t+1,this.command.mode=e[n];break;case"--silent":this.command.silent=!0;break;case"--version":this.command.version=!0;break;default:return-1}return n-t}processAlias(e,t){let n=t,r=e[t],s=1,a=r.length;for(;s<a;){let t=s++,a=i.cca(r,t);if(null==a)throw p.thrown("Invalid alias '-"+r.charAt(t)+"'");switch(a){case 98:this.command.binary=e[++n];break;case 101:this.command.extension=e[++n];break;case 104:this.command.help=!0;break;case 109:this.command.mode=e[++n];break;case 115:this.command.silent=!0;break;case 118:this.command.version=!0;break;default:throw p.thrown("Invalid alias '-"+r.charAt(t)+"'")}}return n-t}promptRequired(){return ye.async((function(e){e(Te.Success(null))}))}run_run(e){return e.length<0?new ke(new be(Te.Failure(new we(null,"Insufficient arguments. Expected: 0, Got: "+e.length,{fileName:"src/php_minifier/Program.hx",lineNumber:51,className:"tink.cli.Router0",methodName:"run_run"})))):this.command.run(e.slice(0,e.length))}}ae.__name__=!0;class le{constructor(e){this.re=new s("^\\s*\\*?\\s{0,2}(.*)$",""),this.root=e}format(e){let t="";t+="\n";let n=this.formatDoc(e.doc);null!=n&&(t+=u.string(n+"\n\n"));let r=e.commands,s=[],i=0;for(;i<r.length;){let e=r[i];++i,e.isDefault||s.push(e)}null!=this.root&&(t+=u.string("  Usage: "+this.root+"\n"));let l=a.find(e.commands,(function(e){return e.isDefault}));if(null!=l){let e=this.formatDoc(l.doc);null!=e&&(t+=u.string(this.indent(e,4)+"\n\n"))}let o=this;if(s.length>0){let e=a.fold(s,(function(e,t){let n=0,r=e.names;for(;n<r.length;){let e=r[n];++n,e.length>t&&(t=e.length)}return t}),0);null!=this.root&&(t+=u.string("  Usage: "+this.root+" <subcommand>\n")),t+=u.string("    Subcommands:\n");let n=function(n,r){null==r&&(r="(doc missing)"),t+=u.string(o.indent(c.lpad(n," ",e)+" : "+c.trim(o.indent(r,e+3)),6)+"\n")},r=0;for(;r<s.length;){let e=s[r];++r;let t=e.names[0];if(n(t,this.formatDoc(e.doc)),e.names.length>1){let r=1,s=e.names.length;for(;r<s;)n(e.names[r++],"Alias of "+t)}}}if(e.flags.length>0){let n=function(e){let t=e.names.join(", ");if(e.aliases.length>0){let n=e.aliases,r=new Array(n.length),s=0,i=n.length;for(;s<i;){let e=s++;r[e]="-"+n[e]}t+=", "+r.join(", ")}return t},r=a.fold(e.flags,(function(e,t){let r=n(e);return r.length>t&&(t=r.length),t}),0),s=function(e,n){null==n&&(n=""),t+=u.string(o.indent(c.lpad(e," ",r)+" : "+c.trim(o.indent(n,r+3)),6)+"\n")};t=(t+="\n")+u.string("  Flags:\n");let i=0,l=e.flags;for(;i<l.length;){let e=l[i];++i,s(n(e),this.formatDoc(e.doc))}}return t}indent(e,t){let n=e.split("\n"),r=new Array(n.length),s=0,i=n.length;for(;s<i;){let e=s++;r[e]=c.lpad(""," ",t)+n[e]}return r.join("\n")}formatDoc(e){if(null==e)return null;let t=e.split("\n"),n=c.trim,r=new Array(t.length),s=0,i=t.length;for(;s<i;){let e=s++;r[e]=n(t[e])}let a=r;for(;""==a[0];)a=a.slice(1);for(;""==a[a.length-1];)a.pop();let l=new Array(a.length),u=0,o=a.length;for(;u<o;){let e=u++,t=a[e];l[e]=this.re.match(t)?this.re.matched(1):t}return l.join("\n")}}le.__name__=!0;class ue{constructor(e,t){this.source=e,this.sink=t}}ue.__name__=!0;class oe extends ue{constructor(){let e=process.stdin,t=null;t={},super(wt.wrap("stdin",e,t.chunkSize,t.onEnd),xt.wrap("stdout",process.stdout))}}oe.__name__=!0;class ce{constructor(e,t){this.trials=e,this.proxy=null==t?new oe:t}}ce.__name__=!0;class he{static invoke(e,t){he.depth<500?(he.depth++,e(t),he.depth--):he.defer((function(){e(t)}))}static defer(e){global.setImmediate(e)}}class _e{constructor(){}cancel(){let e=this.link;null!=e&&e.cancel()}}_e.__name__=!0;class de{static fromMany(e){return new fe((function(){if(null!=e){let t=0;for(;t<e.length;){let n=e[t];++t,null!=n&&n.cancel()}}else e=null}))}}class fe{constructor(e){this.f=e}cancel(){null!=this.f&&(this.f(),this.f=null)}}fe.__name__=!0;class me{constructor(e,t){this.dissolved=!1,this.a=e,this.b=t}cancel(){if(!this.dissolved){this.dissolved=!0;let e=this.a;null!=e&&e.cancel();let t=this.b;null!=t&&t.cancel(),this.a=null,this.b=null}}}me.__name__=!0;class pe{constructor(e,t){if(null==e)throw p.thrown("callback expected but null received");this.cb=e,this.list=t}cancel(){if(null!=this.list){let e=this.list;this.cb=null,this.list=null,--e.used<=e.cells.length>>1&&e.compact()}}}pe.__name__=!0;class ge{constructor(e){ge._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.disposeHandlers=[],this.f=e}dispose(){let e=this.disposeHandlers;if(null!=e){this.disposeHandlers=null;let t=this.f;this.f=ge.noop,t();let n=0;for(;n<e.length;)e[n++]()}}static noop(){}}ge.__name__=!0;class xe extends ge{constructor(e){ge._hx_skip_constructor=!0,super(),ge._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){null==e&&(e=!1),this.onfill=function(){},this.ondrain=function(){},this.busy=!1,this.queue=[],this.used=0;let t=this;super._hx_constructor((function(){t.busy||t.destroy()})),this.destructive=e,this.cells=[]}destroy(){let e=0,t=this.cells;for(;e<t.length;){let n=t[e];++e,n.cb=null,n.list=null}if(this.queue=null,this.cells=null,this.used>0){this.used=0;let e=this.ondrain;he.depth<500?(he.depth++,e(),he.depth--):he.defer(e)}}invoke(e){let t=this;if(he.depth<500){if(he.depth++,null!=t.disposeHandlers)if(t.busy){if(1!=t.destructive){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let n=t.cells[r++];null!=n.list&&n.cb(e)}t.busy=!1,null==t.disposeHandlers?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}he.depth--}else he.defer((function(){if(null!=t.disposeHandlers)if(t.busy){if(1!=t.destructive){let n=t,r=e,s=function(){n.invoke(r)};t.queue.push(s)}}else{t.busy=!0,t.destructive&&t.dispose();let n=t.cells.length,r=0;for(;r<n;){let n=t.cells[r++];null!=n.list&&n.cb(e)}t.busy=!1,null==t.disposeHandlers?t.destroy():(t.used<t.cells.length&&t.compact(),t.queue.length>0&&t.queue.shift()())}}))}compact(){if(!this.busy)if(0==this.used){this.resize(0);let e=this.ondrain;he.depth<500?(he.depth++,e(),he.depth--):he.defer(e)}else{let e=0,t=0,n=this.cells.length;for(;t<n;){let n=t++,r=this.cells[n];if(null!=r.cb&&(e!=n&&(this.cells[e]=r),++e==this.used))break}this.resize(this.used)}}resize(e){this.cells.length=e}}xe.__name__=!0;class we{constructor(e,t,n){null==e&&(e=500),this.isTinkError=!0,this.code=e,this.message=t,this.pos=n,this.exceptionStack=[],this.callStack=[]}static withData(e,t,n,r){return we.typed(e,t,n,r)}static typed(e,t,n,r){let s=new we(e,t,r);return s.data=n,s}static asError(e){return null!=e&&e.isTinkError?e:null}static catchExceptions(e,t,n){try{return Te.Success(e())}catch(e){let r=p.caught(e).unwrap(),s=we.asError(r);return Te.Failure(null==s?null==t?we.withData(null,"Unexpected Error",r,n):t(r):s)}}}we.__name__=!0;class Se{constructor(){Se._hx_skip_constructor||this._hx_constructor()}_hx_constructor(){}getStatus(){return Pe.NeverEver}handle(e){return null}eager(){}}Se.__name__=!0;class be{constructor(e){this.value=e}isComputed(){return!0}get(){return this.value}compute(){}underlying(){return null}}be.__name__=!0;class ke extends Se{constructor(e){super(),this.value=e}getStatus(){return Pe.Ready(this.value)}handle(e){return he.invoke(e,Ce.get(this.value)),null}eager(){this.value.isComputed()||Ce.get(this.value)}}ke.__name__=!0;class ye{static never(){return ye.NEVER_INST}static first(e,t){let n=e;switch(n.getStatus()._hx_index){case 3:return t.getStatus()._hx_index,n;case 4:return t;default:switch(t.getStatus()._hx_index){case 3:return t;case 4:return n;default:return new Ne((function(n){return new me(e.handle(n),t.handle(n))}))}}}static map(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let n=r.result,s=t;return new ke(new Ee((function(){return s(n.get())}),n));case 4:return ye.never();default:return new Ne((function(n){return e.handle((function(e){n(t(e))}))}))}}static flatMap(e,t,n){let r=e.getStatus();switch(r._hx_index){case 3:let n=r.result;return new Ne((function(e){return t(Ce.get(n)).handle((function(t){e(t)}))}));case 4:return ye.never();default:return new Ne((function(n){let r=new _e;return new me(e.handle((function(e){let s=t(e).handle(n),i=r.link;null!=i&&i.cancel(),r.link=s})),r)}))}}static processMany(e,t,n,r){return 0==e.length?new ke(new be(r(Te.Success([])))):new Ne((function(s){let i=[],a=[],l=0;for(;l<e.length;)++l,a.push(null);let u,o=a,c=0,h=0,_=!1;if(null==t)u=e.length;else{let n=t;u=n<1?1:n>e.length?e.length:n}let d=function(){if(c==o.length){if(0==h){let e=r(Te.Success(o));return _=!0,s(e),!0}return!1}return!1},f=null;f=function(){if(!_&&!d())for(;c<o.length;){c+=1;let t=c-1,a=e[t],l=function(e){let a=n(e);switch(a._hx_index){case 0:o[t]=a.data,d();break;case 1:let e=a.failure,n=0;for(;n<i.length;){let e=i[n];++n,null!=e&&e.cancel()}let l=r(Te.Failure(e));_=!0,s(l)}},u=a.getStatus();if(3==u._hx_index){let e;if(e=Ce.get(u.result),l(e),!_)continue}else h+=1,i.push(a.handle((function(e){h-=1,l(e),_||f()})));break}};let m=0,p=u;for(;m<p;)++m,f();return de.fromMany(i)}))}static async(e,t){null==t&&(t=!1);let n=ye.irreversible(e);return t||n.eager(),n}static irreversible(e){return new Ne((function(t){return e(t),null}))}static delay(e,t){let n=ye.irreversible((function(n){g.delay((function(){n(Ce.get(t))}),e)}));return n.eager(),n}}var Pe=r["tink.core.FutureStatus"]={__ename__:!0,__constructs__:null,Suspended:{_hx_name:"Suspended",_hx_index:0,__enum__:"tink.core.FutureStatus",toString:n},Awaited:{_hx_name:"Awaited",_hx_index:1,__enum__:"tink.core.FutureStatus",toString:n},EagerlyAwaited:{_hx_name:"EagerlyAwaited",_hx_index:2,__enum__:"tink.core.FutureStatus",toString:n},Ready:(t=function(e){return{_hx_index:3,result:e,__enum__:"tink.core.FutureStatus",toString:n}},t._hx_name="Ready",t.__params__=["result"],t),NeverEver:{_hx_name:"NeverEver",_hx_index:4,__enum__:"tink.core.FutureStatus",toString:n}};Pe.__constructs__=[Pe.Suspended,Pe.Awaited,Pe.EagerlyAwaited,Pe.Ready,Pe.NeverEver];class ve extends Se{constructor(){Se._hx_skip_constructor=!0,super(),Se._hx_skip_constructor=!1,this._hx_constructor()}_hx_constructor(){this.status=Pe.Awaited,super._hx_constructor(),this.list=new xe(!0)}getStatus(){return this.status}handle(e){let t=this.status;if(3==t._hx_index)return he.invoke(e,Ce.get(t.result)),null;{let t=this.list;if(null==t.disposeHandlers)return null;{let n=new pe(e,t);if(t.cells.push(n),0==t.used++){let e=t.onfill;he.depth<500?(he.depth++,e(),he.depth--):he.defer(e)}return n}}}trigger(e){return 3!=this.status._hx_index&&(this.status=Pe.Ready(new be(e)),this.list.invoke(e),!0)}}ve.__name__=!0;class Ne extends Se{constructor(e){Se._hx_skip_constructor=!0,super(),Se._hx_skip_constructor=!1,this._hx_constructor(e)}_hx_constructor(e){this.status=Pe.Suspended,super._hx_constructor(),this.wakeup=e,this.callbacks=new xe(!0);let t=this;this.callbacks.ondrain=function(){if(t.status==Pe.Awaited){t.status=Pe.Suspended;let e=t.link;null!=e&&e.cancel(),t.link=null}},this.callbacks.onfill=function(){t.status==Pe.Suspended&&(t.status=Pe.Awaited,t.arm())}}getStatus(){return this.status}trigger(e){if(3!=this.status._hx_index){this.status=Pe.Ready(new be(e));let t=this.link;this.link=null,this.wakeup=null,this.callbacks.invoke(e),null!=t&&t.cancel()}}handle(e){let t=this.status;if(3==t._hx_index)return he.invoke(e,Ce.get(t.result)),null;{let t=this.callbacks;if(null==t.disposeHandlers)return null;{let n=new pe(e,t);if(t.cells.push(n),0==t.used++){let e=t.onfill;he.depth<500?(he.depth++,e(),he.depth--):he.defer(e)}return n}}}arm(){let e=this;this.link=this.wakeup((function(t){e.trigger(t)}))}eager(){switch(this.status._hx_index){case 0:this.status=Pe.EagerlyAwaited,this.arm();break;case 1:this.status=Pe.EagerlyAwaited}}}Ne.__name__=!0;class Ce{static get(e){return e.compute(),e.get()}}class Ee{constructor(e,t){this.f=e,this.from=t}underlying(){return this.from}isComputed(){return null==this.f}get(){return this.result}compute(){let e=this.f;if(null!=e){this.f=null;let t=this.from;if(null!=t){let e=t;this.from=null;let n=[];for(;null!=e&&!e.isComputed();)n.push(e),e=e.underlying();n.reverse();let r=0;for(;r<n.length;)n[r++].compute()}this.result=e()}}}Ee.__name__=!0;class Fe{constructor(e,t){this.name=e,this.value=t}}Fe.__name__=!0;var Te=r["tink.core.Outcome"]={__ename__:!0,__constructs__:null,Success:(t=function(e){return{_hx_index:0,data:e,__enum__:"tink.core.Outcome",toString:n}},t._hx_name="Success",t.__params__=["data"],t),Failure:(t=function(e){return{_hx_index:1,failure:e,__enum__:"tink.core.Outcome",toString:n}},t._hx_name="Failure",t.__params__=["failure"],t)};Te.__constructs__=[Te.Success,Te.Failure];class Re{constructor(e,t){this.a=e,this.b=t}}Re.__name__=!0;class Ae{static next(e,t,n){return ye.flatMap(e,(function(e){switch(e._hx_index){case 0:return t(e.data);case 1:return new ke(new be(Te.Failure(e.failure)))}}))}static many(e,t){return ye.processMany(e,t,(function(e){return e}),(function(e){return e}))}static inSequence(e){return Ae.many(e,1)}}class De{constructor(e,t,n){this.preprocessors=e,this.postprocessors=t,this.real=n}pipe(e,t,n){if(null==n&&(n=0),null!=t&&n<t.length){let r=this,s=t,i=n+1,a=function(e){return r.pipe(e,s,i)};return Ae.next(t[n](e),a)}return new ke(new be(Te.Success(e)))}request(e){let t=this;return Ae.next(this.pipe(e,this.preprocessors),(function(e){let n,r=t.real.request(e),s=t;if(null==t.postprocessors)n=null;else{let r=[],s=0,i=t.postprocessors;for(;s<i.length;)r.push(i[s++](e));n=r}return Ae.next(r,(function(e){return s.pipe(e,n)}))}))}static concat(e,t){return null==e?t:null==t?e:e.concat(t)}static create(e,t,n){let r=e instanceof De?e:null;if(null==r)return new De(t,n,e);{let e=r;return new De(De.concat(t,e.preprocessors),De.concat(e.postprocessors,n),e.real)}}}De.__name__=!0;class Be{static fetch(e,t){return ye.irreversible((function(n){let r="GET",s=null,i=ct.EMPTY,a=qe.Default,u=!0;null!=t&&(null!=t.method&&(r=t.method),null!=t.headers&&(s=t.headers),null!=t.body&&(i=t.body),null!=t.client&&(a=t.client),0==t.followRedirect&&(u=!1));let o=Be.getClient(a);if(null!=t&&null!=t.augment){let e=t.augment;o=De.create(o,e.before,e.after)}o.request(new Ge(new Ye(r,e,null,s),i)).handle((function(r){switch(r._hx_index){case 0:let s=r.data,i=s.header.statusCode;switch(i){case 301:case 302:case 303:case 307:case 308:let r=i;u?Ae.next(new ke(new be(s.header.byName("location".toLowerCase()))),(function(n){let s,i=Q.resolve(e,Q.fromString(n));if(303==r){let e=l.copy(t);e.method="GET",s=e}else s=t;return Be.fetch(i,s)})).handle(n):n(Te.Success(s));break;default:n(Te.Success(s))}break;case 1:n(Te.Failure(r.failure))}}))}))}static getClient(e){if(!Be.cache.exists(e)){let t;switch(e._hx_index){case 0:t=new rt;break;case 1:t=new nt(e.container);break;case 2:t=new et;break;case 3:t=new st;break;case 4:t=e.v}Be.cache.set(e,t)}return Be.cache.get(e)}}Be.__name__=!0;var qe=r["tink.http.ClientType"]={__ename__:!0,__constructs__:null,Default:{_hx_name:"Default",_hx_index:0,__enum__:"tink.http.ClientType",toString:n},Local:(t=function(e){return{_hx_index:1,container:e,__enum__:"tink.http.ClientType",toString:n}},t._hx_name="Local",t.__params__=["container"],t),Curl:{_hx_name:"Curl",_hx_index:2,__enum__:"tink.http.ClientType",toString:n},StdLib:{_hx_name:"StdLib",_hx_index:3,__enum__:"tink.http.ClientType",toString:n},Custom:(t=function(e){return{_hx_index:4,v:e,__enum__:"tink.http.ClientType",toString:n}},t._hx_name="Custom",t.__params__=["v"],t)};qe.__constructs__=[qe.Default,qe.Local,qe.Curl,qe.StdLib,qe.Custom];class Oe{static all(e){return Ae.next(e,(function(e){return Ae.next(ht.all(e.body),(function(t){return e.header.statusCode>=400?new ke(new be(Te.Failure(we.withData(e.header.statusCode,e.header.reason,t.toString(),{fileName:"tink/http/Fetch.hx",lineNumber:124,className:"tink.http._Fetch.FetchResponse_Impl_",methodName:"all"})))):new ke(new be(Te.Success(new ze(e.header,t))))}))}))}}class He{constructor(e){He._hx_skip_constructor||this._hx_constructor(e)}_hx_constructor(e){this.fields=null==e?[]:e}get(e){let t=[],n=0,r=this.fields;for(;n<r.length;){let s=r[n];++n,s.name==e&&t.push(s.value)}return t}byName(e){let t=this.get(e);switch(t.length){case 0:return Te.Failure(new we(422,"No "+e+" header found",{fileName:"tink/http/Header.hx",lineNumber:91,className:"tink.http.Header",methodName:"byName"}));case 1:return Te.Success(t[0]);default:return Te.Failure(new we(422,"Multiple entries for "+e+" header",{fileName:"tink/http/Header.hx",lineNumber:95,className:"tink.http.Header",methodName:"byName"}))}}}He.__name__=!0;class Ie{static basicAuth(e,t){return"Basic "+b.encode(w.ofString(e+":"+t)).toString()}}class Le extends Fe{constructor(e,t){super(e,t)}static ofString(e){let t=e.indexOf(":");return-1==t?new Le(e.toLowerCase(),null):new Le(i.substr(e,0,t).toLowerCase(),c.trim(i.substr(e,t+1,null)))}}Le.__name__=!0;class Me{read(e){throw p.thrown("abstract")}progress(e){do{let t=this.read(e.currentByte);switch(t._hx_index){case 0:break;case 1:return e.next(),je.Done(t.r);case 2:return je.Failed(t.e)}}while(e.next());return je.Progressed}eof(e){let t=this.read(-1);switch(t._hx_index){case 0:return Te.Failure(new we(422,"Unexpected end of input",{fileName:"tink/io/StreamParser.hx",lineNumber:180,className:"tink.io.BytewiseParser",methodName:"eof"}));case 1:return Te.Success(t.r);case 2:return Te.Failure(t.e)}}}Me.__name__=!0;var je=r["tink.io.ParseStep"]={__ename__:!0,__constructs__:null,Progressed:{_hx_name:"Progressed",_hx_index:0,__enum__:"tink.io.ParseStep",toString:n},Done:(t=function(e){return{_hx_index:1,r:e,__enum__:"tink.io.ParseStep",toString:n}},t._hx_name="Done",t.__params__=["r"],t),Failed:(t=function(e){return{_hx_index:2,e:e,__enum__:"tink.io.ParseStep",toString:n}},t._hx_name="Failed",t.__params__=["e"],t)};je.__constructs__=[je.Progressed,je.Done,je.Failed];class Ue extends Me{constructor(e){super(),this.last=-1,this.buf=new o,this.makeHeader=e}read(e){let t=this.last;switch(e){case-1:return this.nextLine();case 10:if(13==t)return this.nextLine();{let t=e;return this.last=t,this.buf.b+=String.fromCodePoint(t),je.Progressed}case 13:if(13==t){let e=this.last;return this.buf.b+=String.fromCodePoint(e),je.Progressed}return this.last=13,je.Progressed;default:if(13==t){let t=e,n=this.last;return this.buf.b+=String.fromCodePoint(n),this.buf.b+=String.fromCodePoint(t),this.last=-1,je.Progressed}{let t=e;return this.last=t,this.buf.b+=String.fromCodePoint(t),je.Progressed}}}nextLine(){let e=this.buf.b;if(this.buf=new o,this.last=-1,""==e)return null==this.header?je.Progressed:je.Done(this.header);if(null!=this.header)return this.fields.push(Le.ofString(e)),je.Progressed;{let t=this.makeHeader(e,this.fields=[]);switch(t._hx_index){case 0:let e=t.data;return null==e?je.Done(this.header=null):(this.header=e,je.Progressed);case 1:return je.Failed(t.failure)}}}}Ue.__name__=!0;class ze{constructor(e,t){ze._hx_skip_constructor||this._hx_constructor(e,t)}_hx_constructor(e,t){this.header=e,this.body=t}}ze.__name__=!0;class We extends He{constructor(e,t,n,r){He._hx_skip_constructor=!0,super(),He._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){null==n&&(n="HTTP/1.1"),this.method=e,this.url=t,this.protocol=n,super._hx_constructor(r)}}We.__name__=!0;class Ve extends We{constructor(e,t,n,r){super(e,t,n,r)}}Ve.__name__=!0;class Ye extends We{constructor(e,t,n,r){null==n&&(n="HTTP/1.1");let s=Ye.extractAuth(t);if(0==s._hx_index){let e=s.v;t=e.url,r=null!=r?r.concat(e.headers):e.headers}super(e,t,n,r)}static extractAuth(e){let t=e.auth;if(null==t)return N.None;{let n=[new Le("authorization",Ie.basicAuth(null==t?null:t.split(":")[0],null==t?null:t.split(":")[1]))],r=e.scheme,s=[],i=0,a=e.hosts;for(;i<a.length;)s.push(a[i++]);return N.Some({headers:n,url:Q.make({scheme:r,hosts:s,path:e.path,query:e.query})})}}}Ye.__name__=!0;class Ge extends ze{constructor(e,t){super(e,t)}}Ge.__name__=!0;class $e extends ze{constructor(e,t,n){ze._hx_skip_constructor=!0,super(),ze._hx_skip_constructor=!1,this._hx_constructor(e,t,n)}_hx_constructor(e,t,n){this.clientIp=e,super._hx_constructor(t,n)}}$e.__name__=!0;var Xe=r["tink.http.IncomingRequestBody"]={__ename__:!0,__constructs__:null,Plain:(t=function(e){return{_hx_index:0,source:e,__enum__:"tink.http.IncomingRequestBody",toString:n}},t._hx_name="Plain",t.__params__=["source"],t),Parsed:(t=function(e){return{_hx_index:1,parts:e,__enum__:"tink.http.IncomingRequestBody",toString:n}},t._hx_name="Parsed",t.__params__=["parts"],t)};Xe.__constructs__=[Xe.Plain,Xe.Parsed];class Ke extends He{constructor(e,t,n,r){He._hx_skip_constructor=!0,super(),He._hx_skip_constructor=!1,this._hx_constructor(e,t,n,r)}_hx_constructor(e,t,n,r){null==r&&(r="HTTP/1.1"),this.statusCode=e,this.reason=null==t?D.fromCode(e):t,this.protocol=r,super._hx_constructor(n)}static parser(){return new Ue((function(e,t){let n=e.split(" ");if(n.length>=3){let e=u.parseInt(n[1]),r=n.slice(2).join(" "),s=n[0];return null==s&&(s="HTTP/1.1"),Te.Success(new Ke(e,r,t,s))}return Te.Failure(new we(422,"Invalid HTTP response header",{fileName:"tink/http/Response.hx",lineNumber:56,className:"tink.http.ResponseHeaderBase",methodName:"parser"}))}))}}Ke.__name__=!0;class Ze extends ze{constructor(e,t){super(e,t)}}Ze.__name__=!0;class Je extends ze{constructor(e,t){super(e,t)}}Je.__name__=!0;var Qe=r["tink.http.BodyPart"]={__ename__:!0,__constructs__:null,Value:(t=function(e){return{_hx_index:0,v:e,__enum__:"tink.http.BodyPart",toString:n}},t._hx_name="Value",t.__params__=["v"],t),File:(t=function(e){return{_hx_index:1,handle:e,__enum__:"tink.http.BodyPart",toString:n}},t._hx_name="File",t.__params__=["handle"],t)};Qe.__constructs__=[Qe.Value,Qe.File];class et{constructor(e,t){null!=e&&(this.curl=e),this.extraArgs=t}request(e){let t=tt.checkScheme(e.header.url);switch(t._hx_index){case 0:return new ke(new be(Te.Failure(t.v)));case 1:let n=this.extraArgs,r=null==n?[]:n.slice();switch(r.push("-isS"),r.push("-X"),r.push(e.header.method),e.header.protocol){case"HTTP/1.0":r.push("--http1.0");break;case"HTTP/1.1":r.push("--http1.1");break;case"HTTP/2":r.push("--http2")}let s=e.header.fields,i=0;for(;i<s.length;){let e=s[i++];r.push("-H"),r.push(e.name+": "+e.value)}return r.push(Q.toString(e.header.url)),Ae.next(ht.parse(this.curl(r,e.body),Ke.parser()),(function(e){return new ke(new be(Te.Success(new Je(e.a,e.b))))}))}}curl(e,t){e.push("--data-binary"),e.push("@-");let n=q.spawn("curl",e),r=xt.wrap("stdin",n.stdin),s=null;s={};let i=wt.wrap("stdout",n.stdout,s.chunkSize,s.onEnd),a=null;a={};let l=wt.wrap("stderr",n.stderr,a.chunkSize,a.onEnd);return ct.pipeTo(t,r,{end:!0}).eager(),ct.ofPromised(ye.flatMap(ye.irreversible((function(e){n.once("exit",(function(t,n){e(t)}))})),(function(e){if(0==e)return new ke(new be(Te.Success(i)));{let t=e;return Ae.next(ht.all(l),(function(e){return new ke(new be(Te.Failure(new we(t,e.toString(),{fileName:"tink/http/clients/CurlClient.hx",lineNumber:70,className:"tink.http.clients.CurlClient",methodName:"curl"}))))}))}})))}}et.__name__=!0;class tt{static checkScheme(e){let t=e.scheme;if(null==t)return N.Some(new we(400,"Missing Scheme (expected http/https) in URL: "+Q.toString(e),{fileName:"tink/http/clients/Helpers.hx",lineNumber:16,className:"tink.http.clients.Helpers",methodName:"missingSchemeError"}));switch(t){case"http":case"https":return N.None;default:let e=Q.fromString(t);return N.Some(new we(400,'Invalid Scheme "'+e.scheme+'" (expected http/https) in URL: '+Q.toString(e),{fileName:"tink/http/clients/Helpers.hx",lineNumber:19,className:"tink.http.clients.Helpers",methodName:"invalidSchemeError"}))}}}tt.__name__=!0;class nt{constructor(e){this.container=e}request(e){let t=e.header.url;return ye.flatMap(this.container.serve(new $e("127.0.0.1",new Ve(e.header.method,Q.fromString(null==t.query?t.path:(null==t.path?"null":t.path)+"?"+(null==t.query?"null":t.query)),"HTTP/1.1",e.header.fields),Xe.Plain(e.body))),(function(e){return new ke(new be(Te.Success(new Je(e.header,e.body))))}))}}nt.__name__=!0;class rt{constructor(e){this.agent=e}request(e){let t=tt.checkScheme(e.header.url);switch(t._hx_index){case 0:return new ke(new be(Te.Failure(t.v)));case 1:let n=this.getNodeOptions(e.header);return"https"==e.header.url.scheme?this.nodeRequest(I,n,e):this.nodeRequest(H,n,e)}}getNodeOptions(e){let t=this.agent,n=e.method,r=e.url,s=null==r.query?r.path:(null==r.path?"null":r.path)+"?"+(null==r.query?"null":r.query),i=Ot.get_name(e.url.hosts[0]),a=Ot.get_port(e.url.hosts[0]),l={},u=e.fields,o=0;for(;o<u.length;){let e=u[o++];if("host"==e.name)l[e.name]=e.value;else{let t=l[e.name];(null==t?l[e.name]=[]:t).push(e.value)}}return{agent:t,method:n,path:s,host:i,port:a,headers:l}}nodeRequest(e,t,n){return ye.irreversible((function(r){let s=e.request(t,(function(e){let t=r,s=e.statusCode,i=e.statusMessage,a=[],l=0,u=e.rawHeaders.length>>1;for(;l<u;){let t=l++;a.push(new Le(e.rawHeaders[2*t].toLowerCase(),e.rawHeaders[2*t+1]))}let o=null;o={},t(Te.Success(new Je(new Ke(s,i,a,"HTTP/1.1"),wt.wrap("Response from "+(null==n.header.url?"null":Q.toString(n.header.url)),e,o.chunkSize,o.onEnd))))})),i=function(e){r(Te.Failure(e))};s.on("error",(function(e){i(we.withData(null,e.message,e,{fileName:"tink/http/clients/NodeClient.hx",lineNumber:87,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}))})),ct.pipeTo(n.body,xt.wrap("Request to "+(null==n.header.url?"null":Q.toString(n.header.url)),s)).handle((function(e){switch(s.end(),e._hx_index){case 0:break;case 1:i(new we(502,"Gateway Error",{fileName:"tink/http/clients/NodeClient.hx",lineNumber:96,className:"tink.http.clients.NodeClient",methodName:"nodeRequest"}));break;case 2:i(e.e)}}))}))}}rt.__name__=!0;class st{constructor(e){this.worker=pt.ensure(e)}request(e){let t=this;return ye.irreversible((function(n){let r=new F(Q.toString(e.header.url)),s=function(e){let s=200;r.onStatus=function(e){s=e};r.onError=function(e){200==s&&(s=500),pt.work(t.worker,new be(!0)).handle((function(){n(Te.Failure(new we(s,e,{fileName:"tink/http/clients/StdClient.hx",lineNumber:44,className:"tink.http.clients.StdClient",methodName:"request"})))}))},r.onData=function(e){pt.work(t.worker,new be(!0)).handle((function(){let t=[];n(Te.Success(new Je(new Ke(s,"OK",t,"HTTP/1.1"),new Rt(new be(ee.of(w.ofString(e)))))))}))},pt.work(t.worker,new Ee((function(){r.request(e)})))},i=e.header.fields,a=0;for(;a<i.length;){let e=i[a++];r.setHeader(e.name,e.value)}switch(e.header.method){case"GET":case"HEAD":case"OPTIONS":s(!1);break;default:_t.all(e.body).handle((function(e){r.setPostData(e.toString()),s(!0)}))}}))}}st.__name__=!0;var it=r["tink.io.PipeResult"]={__ename__:!0,__constructs__:null,AllWritten:{_hx_name:"AllWritten",_hx_index:0,__enum__:"tink.io.PipeResult",toString:n},SinkEnded:(t=function(e,t){return{_hx_index:1,result:e,rest:t,__enum__:"tink.io.PipeResult",toString:n}},t._hx_name="SinkEnded",t.__params__=["result","rest"],t),SinkFailed:(t=function(e,t){return{_hx_index:2,e:e,rest:t,__enum__:"tink.io.PipeResult",toString:n}},t._hx_name="SinkFailed",t.__params__=["e","rest"],t),SourceFailed:(t=function(e){return{_hx_index:3,e:e,__enum__:"tink.io.PipeResult",toString:n}},t._hx_name="SourceFailed",t.__params__=["e"],t)};it.__constructs__=[it.AllWritten,it.SinkEnded,it.SinkFailed,it.SourceFailed];class at{static toResult(e,t,n){let r=function(e){return null==n?e:e.prepend(new Rt(new be(n)))};switch(e._hx_index){case 0:return it.SinkEnded(t,r(e.rest));case 1:return it.SinkFailed(e.error,r(e.at));case 2:return it.SourceFailed(e.error);case 3:return it.AllWritten}}}at.__name__=!0;class lt{consume(e,t){throw p.thrown("not implemented")}}lt.__name__=!0;class ut{constructor(){}get_depleted(){return!1}prepend(e){return this.get_depleted()?e:vt.of([e,this])}decompose(e){this.get_depleted()||e.push(this)}reduce(e,t){let n=this;return ye.async((function(r){n.forEach(At.ofUnknown((function(n){return ye.map(t(e,n),(function(t){switch(t._hx_index){case 0:return e=t.result,Nt.Resume;case 1:return Nt.Clog(t.e)}}))}))).handle((function(t){switch(t._hx_index){case 0:throw p.thrown("assert");case 1:r(Ft.Crashed(t.error,t.at));break;case 2:r(Ft.Failed(t.error));break;case 3:r(Ft.Reduced(e))}}))}))}forEach(e){throw p.thrown("not implemented")}}ut.__name__=!0;class ot extends ut{constructor(){super()}get_depleted(){return!0}forEach(e){return new ke(new be(Ct.Depleted))}}ot.__name__=!0;class ct{static concatAll(e){return e.reduce(Z.EMPTY,Dt.ofSafeSync((function(e,t){return Et.Progress(Z.concat(e,t))})))}static pipeTo(e,t,n){return t.consume(e,n)}static ofError(e){return Pt.ofError(e)}static ofPromised(e){return Pt.future(ye.map(e,(function(e){switch(e._hx_index){case 0:return e.data;case 1:return ct.ofError(e.failure)}})))}}class ht{static all(e){return ye.map(ct.concatAll(e),(function(e){switch(e._hx_index){case 1:return Te.Failure(e.error);case 2:return Te.Success(e.result)}}))}static parse(e,t){return ye.map(ft.parse(e,t),(function(e){switch(e._hx_index){case 0:return Te.Success(new Re(e.data,e.rest));case 1:case 2:return Te.Failure(e.e)}}))}}ht.__name__=!0;class _t{static all(e){return ye.map(ct.concatAll(e),(function(e){return e.result}))}}_t.__name__=!0;var dt=r["tink.io.ParseResult"]={__ename__:!0,__constructs__:null,Parsed:(t=function(e,t){return{_hx_index:0,data:e,rest:t,__enum__:"tink.io.ParseResult",toString:n}},t._hx_name="Parsed",t.__params__=["data","rest"],t),Invalid:(t=function(e,t){return{_hx_index:1,e:e,rest:t,__enum__:"tink.io.ParseResult",toString:n}},t._hx_name="Invalid",t.__params__=["e","rest"],t),Broke:(t=function(e){return{_hx_index:2,e:e,__enum__:"tink.io.ParseResult",toString:n}},t._hx_name="Broke",t.__params__=["e"],t)};dt.__constructs__=[dt.Parsed,dt.Invalid,dt.Broke];class ft{static doParse(e,t,n,r){let s=Z.EMPTY.getCursor(),i=!0,a=function(e){return s.currentPos<s.length?e.prepend(new Rt(new be(s.right()))):e},l=function(){let e=s.flush();return 0==e.getLength()?ct.EMPTY:new Rt(new be(e))};return ye.flatMap(e.forEach(At.ofUnknown((function(e){return 0==e.getLength()?new ke(new be(Nt.Resume)):(s.shift(e),ye.async((function(e){let r=null;r=function(){s.shift();let a=s.currentPos,l=t.progress(s);switch(l._hx_index){case 0:a!=s.currentPos&&s.currentPos<s.length?r():e(Nt.Resume);break;case 1:n(l.r).handle((function(t){i=t.resume,i?a!=s.currentPos&&s.currentPos<s.length?r():e(Nt.Resume):e(Nt.Finish)}));break;case 2:e(Nt.Clog(l.e))}},r()})))}))),(function(e){switch(e._hx_index){case 0:return new ke(new be(dt.Parsed(r(),a(e.rest))));case 1:return new ke(new be(dt.Invalid(e.error,a(e.at))));case 2:return new ke(new be(dt.Broke(e.error)));case 3:if(s.currentPos<s.length)return new ke(new be(dt.Parsed(r(),a(new Rt(new be(Z.EMPTY))))));if(!i)return new ke(new be(dt.Parsed(r(),l())));{let e=t.eof(s);switch(e._hx_index){case 0:return ye.map(n(e.data),(function(e){return dt.Parsed(r(),l())}));case 1:return new ke(new be(dt.Invalid(e.failure,l())))}}}}))}static parse(e,t){let n=null;return ft.doParse(e,t,(function(e){return n=e,new ke(new be({resume:!1}))}),(function(){return n}))}}class mt{constructor(){}work(e){return new ke(new be(Ce.get(e)))}}mt.__name__=!0;class pt{static ensure(e){return null==e?pt.get():e}static get(){return pt.pool[u.random(pt.pool.length)]}static work(e,t){return e.work(t)}}class gt extends ut{constructor(e){super(),this.upcoming=e}forEach(e){let t=this;return ye.async((function(n){t.upcoming.handle((function(r){switch(r._hx_index){case 0:let s=r.next;e(r.value).handle((function(r){switch(r._hx_index){case 0:n(Ct.Halted(t));break;case 1:n(Ct.Halted(s));break;case 2:s.forEach(e).handle(n);break;case 3:n(Ct.Clogged(r.e,t))}}));break;case 1:n(Ct.Failed(r.e));break;case 2:n(Ct.Depleted)}}))}))}}gt.__name__=!0;class xt extends lt{constructor(e){super(),this.target=e}consume(e,t){let n=this,r=e.forEach(At.ofUnknown((function(e){return ye.map(n.target.write(e),(function(e){switch(e._hx_index){case 0:return e.data?Nt.Resume:Nt.BackOff;case 1:return Nt.Clog(e.failure)}}))})));return null!=t&&t.end&&r.handle((function(e){n.target.end()})),ye.map(r,(function(e){return at.toResult(e,null)}))}static wrap(e,t){return new xt(new bt(e,t))}}xt.__name__=!0;class wt extends gt{constructor(e){super(ye.async((function(t){e.read().handle((function(n){let r,s=t;switch(n._hx_index){case 0:let t=n.data;r=null==t?qt.End:qt.Link(t,new wt(e));break;case 1:r=qt.Fail(n.failure)}s(r)}))}),!0))}static wrap(e,t,n,r){return new wt(new St(e,t,n,r))}}wt.__name__=!0;class St{constructor(e,t,n,r){this.name=e,this.native=t,this.chunkSize=n;let s=ye.async((function(n){t.once("end",(function(){n(Te.Success(null))})),t.once("error",(function(t){n(Te.Failure(new we(null,t.code+" - Failed reading from "+e+" because "+t.message,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:22,className:"tink.io.nodejs.WrappedReadable",methodName:"new"})))}))}));s.eager(),this.end=s,null!=r&&this.end.handle((function(){process.nextTick(r)}))}read(){let e=this;return ye.first(ye.async((function(t){let n=null;n=function(){try{let r=e.native.read(e.chunkSize);if(null==r)e.native.once("readable",n);else{let e="string"==typeof r?new j(r):r;t(Te.Success(new re(e)))}}catch(n){let r=p.caught(n).unwrap();t(Te.Failure(we.withData(null,"Error while reading from "+e.name,r,{fileName:"tink/io/nodejs/WrappedReadable.hx",lineNumber:48,className:"tink.io.nodejs.WrappedReadable",methodName:"read"})))}},n()})),this.end)}}St.__name__=!0;class bt{constructor(e,t){this.name=e,this.native=t,this.ended=ye.async((function(e){t.once("end",(function(){e(Te.Success(!1))})),t.once("finish",(function(){e(Te.Success(!1))})),t.once("close",(function(){e(Te.Success(!1))})),t.on("error",(function(t){e(Te.Failure(new we(null,t.code+": "+t.message,{fileName:"tink/io/nodejs/WrappedWritable.hx",lineNumber:24,className:"tink.io.nodejs.WrappedWritable",methodName:"new"})))}))}))}end(){let e=!1,t=this.ended.handle((function(){e=!0}));return null!=t&&t.cancel(),e?new ke(new be(Te.Success(!1))):(this.native.end(),Ae.next(this.ended,(function(e){return new ke(new be(Te.Success(!0)))})))}write(e){let t=this;return ye.first(ye.async((function(n){if(0==e.getLength())return void n(Te.Success(!0));let r;if(j.isBuffer(e.buffer))r=e.buffer;else{let t=e.toBytes(),n=t.b;r=j.from(n.buffer,n.byteOffset,t.length)}let s=n,i=Te.Success(!0);t.native.write(r,null,(function(){s(i)}))})),this.ended)}}bt.__name__=!0;class kt{static flush(e){return e.join("&")}}class yt{constructor(){}stringify(e){let t=[];return this.process0("",t,e),kt.flush(t)}process0(e,t,n){let r=n.file;t.push(It.ofString(""==e?"file":e+".file")+"="+It.ofString(r))}}yt.__name__=!0;class Pt{static future(e){return new Bt(e)}static ofError(e){return new Tt(e)}}class vt extends ut{constructor(e){super(),this.parts=e}get_depleted(){switch(this.parts.length){case 0:return!0;case 1:return this.parts[0].get_depleted();default:return!1}}decompose(e){let t=0,n=this.parts;for(;t<n.length;)n[t++].decompose(e)}forEach(e){let t=this.parts,n=e;return ye.async((function(e){vt.consumeParts(t,n,e)}))}static consumeParts(e,t,n){0==e.length?n(Ct.Depleted):e[0].forEach(t).handle((function(r){switch(r._hx_index){case 0:(e=e.slice())[0]=r.rest,n(Ct.Halted(new vt(e)));break;case 1:let s=r.at;s.get_depleted()?e=e.slice(1):(e=e.slice())[0]=s,n(Ct.Clogged(r.error,new vt(e)));break;case 2:n(Ct.Failed(r.error));break;case 3:vt.consumeParts(e.slice(1),t,n)}}))}static of(e){let t=[],n=0;for(;n<e.length;)e[n++].decompose(t);return 0==t.length?ot.inst:new vt(t)}}vt.__name__=!0;var Nt=r["tink.streams.Handled"]={__ename__:!0,__constructs__:null,BackOff:{_hx_name:"BackOff",_hx_index:0,__enum__:"tink.streams.Handled",toString:n},Finish:{_hx_name:"Finish",_hx_index:1,__enum__:"tink.streams.Handled",toString:n},Resume:{_hx_name:"Resume",_hx_index:2,__enum__:"tink.streams.Handled",toString:n},Clog:(t=function(e){return{_hx_index:3,e:e,__enum__:"tink.streams.Handled",toString:n}},t._hx_name="Clog",t.__params__=["e"],t)};Nt.__constructs__=[Nt.BackOff,Nt.Finish,Nt.Resume,Nt.Clog];var Ct=r["tink.streams.Conclusion"]={__ename__:!0,__constructs__:null,Halted:(t=function(e){return{_hx_index:0,rest:e,__enum__:"tink.streams.Conclusion",toString:n}},t._hx_name="Halted",t.__params__=["rest"],t),Clogged:(t=function(e,t){return{_hx_index:1,error:e,at:t,__enum__:"tink.streams.Conclusion",toString:n}},t._hx_name="Clogged",t.__params__=["error","at"],t),Failed:(t=function(e){return{_hx_index:2,error:e,__enum__:"tink.streams.Conclusion",toString:n}},t._hx_name="Failed",t.__params__=["error"],t),Depleted:{_hx_name:"Depleted",_hx_index:3,__enum__:"tink.streams.Conclusion",toString:n}};Ct.__constructs__=[Ct.Halted,Ct.Clogged,Ct.Failed,Ct.Depleted];var Et=r["tink.streams.ReductionStep"]={__ename__:!0,__constructs__:null,Progress:(t=function(e){return{_hx_index:0,result:e,__enum__:"tink.streams.ReductionStep",toString:n}},t._hx_name="Progress",t.__params__=["result"],t),Crash:(t=function(e){return{_hx_index:1,e:e,__enum__:"tink.streams.ReductionStep",toString:n}},t._hx_name="Crash",t.__params__=["e"],t)};Et.__constructs__=[Et.Progress,Et.Crash];var Ft=r["tink.streams.Reduction"]={__ename__:!0,__constructs__:null,Crashed:(t=function(e,t){return{_hx_index:0,error:e,at:t,__enum__:"tink.streams.Reduction",toString:n}},t._hx_name="Crashed",t.__params__=["error","at"],t),Failed:(t=function(e){return{_hx_index:1,error:e,__enum__:"tink.streams.Reduction",toString:n}},t._hx_name="Failed",t.__params__=["error"],t),Reduced:(t=function(e){return{_hx_index:2,result:e,__enum__:"tink.streams.Reduction",toString:n}},t._hx_name="Reduced",t.__params__=["result"],t)};Ft.__constructs__=[Ft.Crashed,Ft.Failed,Ft.Reduced];class Tt extends ut{constructor(e){super(),this.error=e}forEach(e){return new ke(new be(Ct.Failed(this.error)))}}Tt.__name__=!0;class Rt extends ut{constructor(e){super(),this.value=e}forEach(e){let t=this;return ye.map(e(Ce.get(this.value)),(function(e){switch(e._hx_index){case 0:return Ct.Halted(t);case 1:return Ct.Halted(ot.inst);case 2:return Ct.Depleted;case 3:return Ct.Clogged(e.e,t)}}))}}Rt.__name__=!0;class At{static ofUnknown(e){return e}}class Dt{static ofSafeSync(e){return function(t,n){return new ke(new be(e(t,n)))}}}class Bt extends ut{constructor(e){super(),this.f=e}forEach(e){let t=this;return ye.async((function(n){t.f.handle((function(t){t.forEach(e).handle(n)}))}))}}Bt.__name__=!0;var qt=r["tink.streams.Step"]={__ename__:!0,__constructs__:null,Link:(t=function(e,t){return{_hx_index:0,value:e,next:t,__enum__:"tink.streams.Step",toString:n}},t._hx_name="Link",t.__params__=["value","next"],t),Fail:(t=function(e){return{_hx_index:1,e:e,__enum__:"tink.streams.Step",toString:n}},t._hx_name="Fail",t.__params__=["e"],t),End:{_hx_name:"End",_hx_index:2,__enum__:"tink.streams.Step",toString:n}};qt.__constructs__=[qt.Link,qt.Fail,qt.End];class Ot{static _new(e,t){let n;if(null==t)n=e;else{if(t>65535||t<=0)throw p.thrown("Invalid port");n=e+":"+t}return n}static get_name(e){if(null==e)return null;{let t=e.split("]");switch(t.length){case 1:return t[0].split(":")[0];case 2:return t[0]+"]";default:throw p.thrown("assert")}}}static get_port(e){if(null==e)return null;{let t=e.split("]");switch(t.length){case 1:let e=t[0].split(":")[1];return null==e?null:u.parseInt(e);case 2:let n=t[1].split(":")[1];return null==n?null:u.parseInt(n);default:throw p.thrown("assert")}}}}class Ht{static join(e,t){if(""==t)return e;if("/"==t.charAt(0))return t;if("/"==e.charAt(e.length-1))return Ht.ofString(e+t);{let n=e.lastIndexOf("/");return-1==n?t:Ht.ofString(i.substr(e,0,n+1)+(null==t?"null":t))}}static ofString(e){return Ht.normalize(e)}static normalize(e){if("."==(e=c.trim(c.replace(e,"\\","/"))))return"./";let t=e.endsWith("/..")||e.endsWith("/")||e.endsWith("/."),n=[],r=e.startsWith("/"),s=0,i=0,a=e.split("/");for(;i<a.length;){let e=c.trim(a[i++]);switch(e){case"":case".":break;case"..":null==n.pop()&&++s;break;default:n.push(e)}}if(r)n.unshift("");else{let e=0,t=s;for(;e<t;)++e,n.unshift("..")}return t&&n.push(""),n.join("/")}}class It{static ofString(e){return null==e?"":encodeURIComponent(e)}}function Lt(e){return e instanceof Array?new A(e):e.iterator()}function Mt(t,n){return null==n?null:(null==n.__id__&&(n.__id__=e.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:r=t.hx__closures__[n.__id__],null==r&&(r=n.bind(t),t.hx__closures__[n.__id__]=r),r);var r}e.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(i.now=performance.now.bind(performance)),null==String.fromCodePoint&&(String.fromCodePoint=function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55232+(e>>10))+String.fromCharCode(56320+(1023&e))}),String.__name__=!0,Array.__name__=!0,B.__toStr={}.toString,b.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b.BYTES=w.ofString(b.CHARS),K.EMPTY=new w(new ArrayBuffer(0)),Z.EMPTY=new K,he.depth=0,ge._hx_skip_constructor=!1,Se._hx_skip_constructor=!1,ye.NEVER_INST=new Se,Ae.NOISE=new ke(new be(Te.Success(null))),Be.cache=new v,He._hx_skip_constructor=!1,ze._hx_skip_constructor=!1,ot.inst=new ot,ct.EMPTY=ot.inst,pt.EAGER=new mt,pt.pool=[pt.EAGER],Y.main()}(globalThis);