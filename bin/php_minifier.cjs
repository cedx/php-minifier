#!/usr/bin/env node
"use strict";var wo=Object.create;var Wt=Object.defineProperty;var Ro=Object.getOwnPropertyDescriptor;var _o=Object.getOwnPropertyNames;var Co=Object.getPrototypeOf,To=Object.prototype.hasOwnProperty;var O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var $o=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _o(t))!To.call(e,o)&&o!==r&&Wt(e,o,{get:()=>t[o],enumerable:!(n=Ro(t,o))||n.enumerable});return e};var F=(e,t,r)=>(r=e!=null?wo(Co(e)):{},$o(t||!e||!e.__esModule?Wt(r,"default",{value:e,enumerable:!0}):r,e));var le=O((sa,Yt)=>{"use strict";var vo=require("path"),Q="\\\\/",Xt=`[^${Q}]`,Y="\\.",Po="\\+",Oo="\\?",_e="\\/",Io="(?=.)",zt="[^/]",et=`(?:${_e}|$)`,Vt=`(?:^|${_e})`,tt=`${Y}{1,2}${et}`,Lo=`(?!${Y})`,Ho=`(?!${Vt}${tt})`,No=`(?!${Y}{0,1}${et})`,ko=`(?!${tt})`,Go=`[^.${_e}]`,Bo=`${zt}*?`,Qt={DOT_LITERAL:Y,PLUS_LITERAL:Po,QMARK_LITERAL:Oo,SLASH_LITERAL:_e,ONE_CHAR:Io,QMARK:zt,END_ANCHOR:et,DOTS_SLASH:tt,NO_DOT:Lo,NO_DOTS:Ho,NO_DOT_SLASH:No,NO_DOTS_SLASH:ko,QMARK_NO_DOT:Go,STAR:Bo,START_ANCHOR:Vt},Do={...Qt,SLASH_LITERAL:`[${Q}]`,QMARK:Xt,STAR:`${Xt}*?`,DOTS_SLASH:`${Y}{1,2}(?:[${Q}]|$)`,NO_DOT:`(?!${Y})`,NO_DOTS:`(?!(?:^|[${Q}])${Y}{1,2}(?:[${Q}]|$))`,NO_DOT_SLASH:`(?!${Y}{0,1}(?:[${Q}]|$))`,NO_DOTS_SLASH:`(?!${Y}{1,2}(?:[${Q}]|$))`,QMARK_NO_DOT:`[^.${Q}]`,START_ANCHOR:`(?:^|[${Q}])`,END_ANCHOR:`(?:[${Q}]|$)`},Mo={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Yt.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Mo,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:vo.sep,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?Do:Qt}}});var Ce=O(U=>{"use strict";var jo=require("path"),Fo=process.platform==="win32",{REGEX_BACKSLASH:Uo,REGEX_REMOVE_BACKSLASH:qo,REGEX_SPECIAL_CHARS:Ko,REGEX_SPECIAL_CHARS_GLOBAL:Wo}=le();U.isObject=e=>e!==null&&typeof e=="object"&&!Array.isArray(e);U.hasRegexChars=e=>Ko.test(e);U.isRegexChar=e=>e.length===1&&U.hasRegexChars(e);U.escapeRegex=e=>e.replace(Wo,"\\$1");U.toPosixSlashes=e=>e.replace(Uo,"/");U.removeBackslashes=e=>e.replace(qo,t=>t==="\\"?"":t);U.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return e.length===3&&e[0]>=9||e[0]===8&&e[1]>=10};U.isWindows=e=>e&&typeof e.windows=="boolean"?e.windows:Fo===!0||jo.sep==="\\";U.escapeLast=(e,t,r)=>{let n=e.lastIndexOf(t,r);return n===-1?e:e[n-1]==="\\"?U.escapeLast(e,t,n-1):`${e.slice(0,n)}\\${e.slice(n)}`};U.removePrefix=(e,t={})=>{let r=e;return r.startsWith("./")&&(r=r.slice(2),t.prefix="./"),r};U.wrapOutput=(e,t={},r={})=>{let n=r.contains?"":"^",o=r.contains?"":"$",s=`${n}(?:${e})${o}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var sr=O((aa,or)=>{"use strict";var Zt=Ce(),{CHAR_ASTERISK:rt,CHAR_AT:Xo,CHAR_BACKWARD_SLASH:pe,CHAR_COMMA:zo,CHAR_DOT:nt,CHAR_EXCLAMATION_MARK:ot,CHAR_FORWARD_SLASH:nr,CHAR_LEFT_CURLY_BRACE:st,CHAR_LEFT_PARENTHESES:it,CHAR_LEFT_SQUARE_BRACKET:Vo,CHAR_PLUS:Qo,CHAR_QUESTION_MARK:Jt,CHAR_RIGHT_CURLY_BRACE:Yo,CHAR_RIGHT_PARENTHESES:er,CHAR_RIGHT_SQUARE_BRACKET:Zo}=le(),tr=e=>e===nr||e===pe,rr=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?1/0:1)},Jo=(e,t)=>{let r=t||{},n=e.length-1,o=r.parts===!0||r.scanToEnd===!0,s=[],i=[],l=[],f=e,h=-1,m=0,E=0,S=!1,R=!1,g=!1,A=!1,B=!1,D=!1,G=!1,C=!1,q=!1,L=!1,X=0,N,y,_={value:"",depth:0,isGlob:!1},k=()=>h>=n,u=()=>f.charCodeAt(h+1),v=()=>(N=y,f.charCodeAt(++h));for(;h<n;){y=v();let M;if(y===pe){G=_.backslashes=!0,y=v(),y===st&&(D=!0);continue}if(D===!0||y===st){for(X++;k()!==!0&&(y=v());){if(y===pe){G=_.backslashes=!0,v();continue}if(y===st){X++;continue}if(D!==!0&&y===nt&&(y=v())===nt){if(S=_.isBrace=!0,g=_.isGlob=!0,L=!0,o===!0)continue;break}if(D!==!0&&y===zo){if(S=_.isBrace=!0,g=_.isGlob=!0,L=!0,o===!0)continue;break}if(y===Yo&&(X--,X===0)){D=!1,S=_.isBrace=!0,L=!0;break}}if(o===!0)continue;break}if(y===nr){if(s.push(h),i.push(_),_={value:"",depth:0,isGlob:!1},L===!0)continue;if(N===nt&&h===m+1){m+=2;continue}E=h+1;continue}if(r.noext!==!0&&(y===Qo||y===Xo||y===rt||y===Jt||y===ot)===!0&&u()===it){if(g=_.isGlob=!0,A=_.isExtglob=!0,L=!0,y===ot&&h===m&&(q=!0),o===!0){for(;k()!==!0&&(y=v());){if(y===pe){G=_.backslashes=!0,y=v();continue}if(y===er){g=_.isGlob=!0,L=!0;break}}continue}break}if(y===rt){if(N===rt&&(B=_.isGlobstar=!0),g=_.isGlob=!0,L=!0,o===!0)continue;break}if(y===Jt){if(g=_.isGlob=!0,L=!0,o===!0)continue;break}if(y===Vo){for(;k()!==!0&&(M=v());){if(M===pe){G=_.backslashes=!0,v();continue}if(M===Zo){R=_.isBracket=!0,g=_.isGlob=!0,L=!0;break}}if(o===!0)continue;break}if(r.nonegate!==!0&&y===ot&&h===m){C=_.negated=!0,m++;continue}if(r.noparen!==!0&&y===it){if(g=_.isGlob=!0,o===!0){for(;k()!==!0&&(y=v());){if(y===it){G=_.backslashes=!0,y=v();continue}if(y===er){L=!0;break}}continue}break}if(g===!0){if(L=!0,o===!0)continue;break}}r.noext===!0&&(A=!1,g=!1);let T=f,Z="",a="";m>0&&(Z=f.slice(0,m),f=f.slice(m),E-=m),T&&g===!0&&E>0?(T=f.slice(0,E),a=f.slice(E)):g===!0?(T="",a=f):T=f,T&&T!==""&&T!=="/"&&T!==f&&tr(T.charCodeAt(T.length-1))&&(T=T.slice(0,-1)),r.unescape===!0&&(a&&(a=Zt.removeBackslashes(a)),T&&G===!0&&(T=Zt.removeBackslashes(T)));let c={prefix:Z,input:e,start:m,base:T,glob:a,isBrace:S,isBracket:R,isGlob:g,isExtglob:A,isGlobstar:B,negated:C,negatedExtglob:q};if(r.tokens===!0&&(c.maxDepth=0,tr(y)||i.push(_),c.tokens=i),r.parts===!0||r.tokens===!0){let M;for(let w=0;w<s.length;w++){let z=M?M+1:m,V=s[w],K=e.slice(z,V);r.tokens&&(w===0&&m!==0?(i[w].isPrefix=!0,i[w].value=Z):i[w].value=K,rr(i[w]),c.maxDepth+=i[w].depth),(w!==0||K!=="")&&l.push(K),M=V}if(M&&M+1<e.length){let w=e.slice(M+1);l.push(w),r.tokens&&(i[i.length-1].value=w,rr(i[i.length-1]),c.maxDepth+=i[i.length-1].depth)}c.slashes=s,c.parts=l}return c};or.exports=Jo});var cr=O((ca,ar)=>{"use strict";var Te=le(),W=Ce(),{MAX_LENGTH:$e,POSIX_REGEX_SOURCE:es,REGEX_NON_SPECIAL_CHARS:ts,REGEX_SPECIAL_CHARS_BACKREF:rs,REPLACEMENTS:ir}=Te,ns=(e,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...e,t);e.sort();let r=`[${e.join("-")}]`;try{new RegExp(r)}catch{return e.map(o=>W.escapeRegex(o)).join("..")}return r},re=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,at=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=ir[e]||e;let r={...t},n=typeof r.maxLength=="number"?Math.min($e,r.maxLength):$e,o=e.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);let s={type:"bos",value:"",output:r.prepend||""},i=[s],l=r.capture?"":"?:",f=W.isWindows(t),h=Te.globChars(f),m=Te.extglobChars(h),{DOT_LITERAL:E,PLUS_LITERAL:S,SLASH_LITERAL:R,ONE_CHAR:g,DOTS_SLASH:A,NO_DOT:B,NO_DOT_SLASH:D,NO_DOTS_SLASH:G,QMARK:C,QMARK_NO_DOT:q,STAR:L,START_ANCHOR:X}=h,N=d=>`(${l}(?:(?!${X}${d.dot?A:E}).)*?)`,y=r.dot?"":B,_=r.dot?C:q,k=r.bash===!0?N(r):L;r.capture&&(k=`(${k})`),typeof r.noext=="boolean"&&(r.noextglob=r.noext);let u={input:e,index:-1,start:0,dot:r.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:i};e=W.removePrefix(e,u),o=e.length;let v=[],T=[],Z=[],a=s,c,M=()=>u.index===o-1,w=u.peek=(d=1)=>e[u.index+d],z=u.advance=()=>e[++u.index]||"",V=()=>e.slice(u.index+1),K=(d="",$=0)=>{u.consumed+=d,u.index+=$},Se=d=>{u.output+=d.output!=null?d.output:d.value,K(d.value)},So=()=>{let d=1;for(;w()==="!"&&(w(2)!=="("||w(3)==="?");)z(),u.start++,d++;return d%2===0?!1:(u.negated=!0,u.start++,!0)},Ae=d=>{u[d]++,Z.push(d)},J=d=>{u[d]--,Z.pop()},x=d=>{if(a.type==="globstar"){let $=u.braces>0&&(d.type==="comma"||d.type==="brace"),p=d.extglob===!0||v.length&&(d.type==="pipe"||d.type==="paren");d.type!=="slash"&&d.type!=="paren"&&!$&&!p&&(u.output=u.output.slice(0,-a.output.length),a.type="star",a.value="*",a.output=k,u.output+=a.output)}if(v.length&&d.type!=="paren"&&(v[v.length-1].inner+=d.value),(d.value||d.output)&&Se(d),a&&a.type==="text"&&d.type==="text"){a.value+=d.value,a.output=(a.output||"")+d.value;return}d.prev=a,i.push(d),a=d},we=(d,$)=>{let p={...m[$],conditions:1,inner:""};p.prev=a,p.parens=u.parens,p.output=u.output;let b=(r.capture?"(":"")+p.open;Ae("parens"),x({type:d,value:$,output:u.output?"":g}),x({type:"paren",extglob:!0,value:z(),output:b}),v.push(p)},Ao=d=>{let $=d.close+(r.capture?")":""),p;if(d.type==="negate"){let b=k;if(d.inner&&d.inner.length>1&&d.inner.includes("/")&&(b=N(r)),(b!==k||M()||/^\)+$/.test(V()))&&($=d.close=`)$))${b}`),d.inner.includes("*")&&(p=V())&&/^\.[^\\/.]+$/.test(p)){let P=at(p,{...t,fastpaths:!1}).output;$=d.close=`)${P})${b})`}d.prev.type==="bos"&&(u.negatedExtglob=!0)}x({type:"paren",extglob:!0,value:c,output:$}),J("parens")};if(r.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let d=!1,$=e.replace(rs,(p,b,P,j,H,Je)=>j==="\\"?(d=!0,p):j==="?"?b?b+j+(H?C.repeat(H.length):""):Je===0?_+(H?C.repeat(H.length):""):C.repeat(P.length):j==="."?E.repeat(P.length):j==="*"?b?b+j+(H?k:""):k:b?p:`\\${p}`);return d===!0&&(r.unescape===!0?$=$.replace(/\\/g,""):$=$.replace(/\\+/g,p=>p.length%2===0?"\\\\":p?"\\":"")),$===e&&r.contains===!0?(u.output=e,u):(u.output=W.wrapOutput($,u,t),u)}for(;!M();){if(c=z(),c==="\0")continue;if(c==="\\"){let p=w();if(p==="/"&&r.bash!==!0||p==="."||p===";")continue;if(!p){c+="\\",x({type:"text",value:c});continue}let b=/^\\+/.exec(V()),P=0;if(b&&b[0].length>2&&(P=b[0].length,u.index+=P,P%2!==0&&(c+="\\")),r.unescape===!0?c=z():c+=z(),u.brackets===0){x({type:"text",value:c});continue}}if(u.brackets>0&&(c!=="]"||a.value==="["||a.value==="[^")){if(r.posix!==!1&&c===":"){let p=a.value.slice(1);if(p.includes("[")&&(a.posix=!0,p.includes(":"))){let b=a.value.lastIndexOf("["),P=a.value.slice(0,b),j=a.value.slice(b+2),H=es[j];if(H){a.value=P+H,u.backtrack=!0,z(),!s.output&&i.indexOf(a)===1&&(s.output=g);continue}}}(c==="["&&w()!==":"||c==="-"&&w()==="]")&&(c=`\\${c}`),c==="]"&&(a.value==="["||a.value==="[^")&&(c=`\\${c}`),r.posix===!0&&c==="!"&&a.value==="["&&(c="^"),a.value+=c,Se({value:c});continue}if(u.quotes===1&&c!=='"'){c=W.escapeRegex(c),a.value+=c,Se({value:c});continue}if(c==='"'){u.quotes=u.quotes===1?0:1,r.keepQuotes===!0&&x({type:"text",value:c});continue}if(c==="("){Ae("parens"),x({type:"paren",value:c});continue}if(c===")"){if(u.parens===0&&r.strictBrackets===!0)throw new SyntaxError(re("opening","("));let p=v[v.length-1];if(p&&u.parens===p.parens+1){Ao(v.pop());continue}x({type:"paren",value:c,output:u.parens?")":"\\)"}),J("parens");continue}if(c==="["){if(r.nobracket===!0||!V().includes("]")){if(r.nobracket!==!0&&r.strictBrackets===!0)throw new SyntaxError(re("closing","]"));c=`\\${c}`}else Ae("brackets");x({type:"bracket",value:c});continue}if(c==="]"){if(r.nobracket===!0||a&&a.type==="bracket"&&a.value.length===1){x({type:"text",value:c,output:`\\${c}`});continue}if(u.brackets===0){if(r.strictBrackets===!0)throw new SyntaxError(re("opening","["));x({type:"text",value:c,output:`\\${c}`});continue}J("brackets");let p=a.value.slice(1);if(a.posix!==!0&&p[0]==="^"&&!p.includes("/")&&(c=`/${c}`),a.value+=c,Se({value:c}),r.literalBrackets===!1||W.hasRegexChars(p))continue;let b=W.escapeRegex(a.value);if(u.output=u.output.slice(0,-a.value.length),r.literalBrackets===!0){u.output+=b,a.value=b;continue}a.value=`(${l}${b}|${a.value})`,u.output+=a.value;continue}if(c==="{"&&r.nobrace!==!0){Ae("braces");let p={type:"brace",value:c,output:"(",outputIndex:u.output.length,tokensIndex:u.tokens.length};T.push(p),x(p);continue}if(c==="}"){let p=T[T.length-1];if(r.nobrace===!0||!p){x({type:"text",value:c,output:c});continue}let b=")";if(p.dots===!0){let P=i.slice(),j=[];for(let H=P.length-1;H>=0&&(i.pop(),P[H].type!=="brace");H--)P[H].type!=="dots"&&j.unshift(P[H].value);b=ns(j,r),u.backtrack=!0}if(p.comma!==!0&&p.dots!==!0){let P=u.output.slice(0,p.outputIndex),j=u.tokens.slice(p.tokensIndex);p.value=p.output="\\{",c=b="\\}",u.output=P;for(let H of j)u.output+=H.output||H.value}x({type:"brace",value:c,output:b}),J("braces"),T.pop();continue}if(c==="|"){v.length>0&&v[v.length-1].conditions++,x({type:"text",value:c});continue}if(c===","){let p=c,b=T[T.length-1];b&&Z[Z.length-1]==="braces"&&(b.comma=!0,p="|"),x({type:"comma",value:c,output:p});continue}if(c==="/"){if(a.type==="dot"&&u.index===u.start+1){u.start=u.index+1,u.consumed="",u.output="",i.pop(),a=s;continue}x({type:"slash",value:c,output:R});continue}if(c==="."){if(u.braces>0&&a.type==="dot"){a.value==="."&&(a.output=E);let p=T[T.length-1];a.type="dots",a.output+=c,a.value+=c,p.dots=!0;continue}if(u.braces+u.parens===0&&a.type!=="bos"&&a.type!=="slash"){x({type:"text",value:c,output:E});continue}x({type:"dot",value:c,output:E});continue}if(c==="?"){if(!(a&&a.value==="(")&&r.noextglob!==!0&&w()==="("&&w(2)!=="?"){we("qmark",c);continue}if(a&&a.type==="paren"){let b=w(),P=c;if(b==="<"&&!W.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(a.value==="("&&!/[!=<:]/.test(b)||b==="<"&&!/<([!=]|\w+>)/.test(V()))&&(P=`\\${c}`),x({type:"text",value:c,output:P});continue}if(r.dot!==!0&&(a.type==="slash"||a.type==="bos")){x({type:"qmark",value:c,output:q});continue}x({type:"qmark",value:c,output:C});continue}if(c==="!"){if(r.noextglob!==!0&&w()==="("&&(w(2)!=="?"||!/[!=<:]/.test(w(3)))){we("negate",c);continue}if(r.nonegate!==!0&&u.index===0){So();continue}}if(c==="+"){if(r.noextglob!==!0&&w()==="("&&w(2)!=="?"){we("plus",c);continue}if(a&&a.value==="("||r.regex===!1){x({type:"plus",value:c,output:S});continue}if(a&&(a.type==="bracket"||a.type==="paren"||a.type==="brace")||u.parens>0){x({type:"plus",value:c});continue}x({type:"plus",value:S});continue}if(c==="@"){if(r.noextglob!==!0&&w()==="("&&w(2)!=="?"){x({type:"at",extglob:!0,value:c,output:""});continue}x({type:"text",value:c});continue}if(c!=="*"){(c==="$"||c==="^")&&(c=`\\${c}`);let p=ts.exec(V());p&&(c+=p[0],u.index+=p[0].length),x({type:"text",value:c});continue}if(a&&(a.type==="globstar"||a.star===!0)){a.type="star",a.star=!0,a.value+=c,a.output=k,u.backtrack=!0,u.globstar=!0,K(c);continue}let d=V();if(r.noextglob!==!0&&/^\([^?]/.test(d)){we("star",c);continue}if(a.type==="star"){if(r.noglobstar===!0){K(c);continue}let p=a.prev,b=p.prev,P=p.type==="slash"||p.type==="bos",j=b&&(b.type==="star"||b.type==="globstar");if(r.bash===!0&&(!P||d[0]&&d[0]!=="/")){x({type:"star",value:c,output:""});continue}let H=u.braces>0&&(p.type==="comma"||p.type==="brace"),Je=v.length&&(p.type==="pipe"||p.type==="paren");if(!P&&p.type!=="paren"&&!H&&!Je){x({type:"star",value:c,output:""});continue}for(;d.slice(0,3)==="/**";){let Re=e[u.index+4];if(Re&&Re!=="/")break;d=d.slice(3),K("/**",3)}if(p.type==="bos"&&M()){a.type="globstar",a.value+=c,a.output=N(r),u.output=a.output,u.globstar=!0,K(c);continue}if(p.type==="slash"&&p.prev.type!=="bos"&&!j&&M()){u.output=u.output.slice(0,-(p.output+a.output).length),p.output=`(?:${p.output}`,a.type="globstar",a.output=N(r)+(r.strictSlashes?")":"|$)"),a.value+=c,u.globstar=!0,u.output+=p.output+a.output,K(c);continue}if(p.type==="slash"&&p.prev.type!=="bos"&&d[0]==="/"){let Re=d[1]!==void 0?"|$":"";u.output=u.output.slice(0,-(p.output+a.output).length),p.output=`(?:${p.output}`,a.type="globstar",a.output=`${N(r)}${R}|${R}${Re})`,a.value+=c,u.output+=p.output+a.output,u.globstar=!0,K(c+z()),x({type:"slash",value:"/",output:""});continue}if(p.type==="bos"&&d[0]==="/"){a.type="globstar",a.value+=c,a.output=`(?:^|${R}|${N(r)}${R})`,u.output=a.output,u.globstar=!0,K(c+z()),x({type:"slash",value:"/",output:""});continue}u.output=u.output.slice(0,-a.output.length),a.type="globstar",a.output=N(r),a.value+=c,u.output+=a.output,u.globstar=!0,K(c);continue}let $={type:"star",value:c,output:k};if(r.bash===!0){$.output=".*?",(a.type==="bos"||a.type==="slash")&&($.output=y+$.output),x($);continue}if(a&&(a.type==="bracket"||a.type==="paren")&&r.regex===!0){$.output=c,x($);continue}(u.index===u.start||a.type==="slash"||a.type==="dot")&&(a.type==="dot"?(u.output+=D,a.output+=D):r.dot===!0?(u.output+=G,a.output+=G):(u.output+=y,a.output+=y),w()!=="*"&&(u.output+=g,a.output+=g)),x($)}for(;u.brackets>0;){if(r.strictBrackets===!0)throw new SyntaxError(re("closing","]"));u.output=W.escapeLast(u.output,"["),J("brackets")}for(;u.parens>0;){if(r.strictBrackets===!0)throw new SyntaxError(re("closing",")"));u.output=W.escapeLast(u.output,"("),J("parens")}for(;u.braces>0;){if(r.strictBrackets===!0)throw new SyntaxError(re("closing","}"));u.output=W.escapeLast(u.output,"{"),J("braces")}if(r.strictSlashes!==!0&&(a.type==="star"||a.type==="bracket")&&x({type:"maybe_slash",value:"",output:`${R}?`}),u.backtrack===!0){u.output="";for(let d of u.tokens)u.output+=d.output!=null?d.output:d.value,d.suffix&&(u.output+=d.suffix)}return u};at.fastpaths=(e,t)=>{let r={...t},n=typeof r.maxLength=="number"?Math.min($e,r.maxLength):$e,o=e.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);e=ir[e]||e;let s=W.isWindows(t),{DOT_LITERAL:i,SLASH_LITERAL:l,ONE_CHAR:f,DOTS_SLASH:h,NO_DOT:m,NO_DOTS:E,NO_DOTS_SLASH:S,STAR:R,START_ANCHOR:g}=Te.globChars(s),A=r.dot?E:m,B=r.dot?S:m,D=r.capture?"":"?:",G={negated:!1,prefix:""},C=r.bash===!0?".*?":R;r.capture&&(C=`(${C})`);let q=y=>y.noglobstar===!0?C:`(${D}(?:(?!${g}${y.dot?h:i}).)*?)`,L=y=>{switch(y){case"*":return`${A}${f}${C}`;case".*":return`${i}${f}${C}`;case"*.*":return`${A}${C}${i}${f}${C}`;case"*/*":return`${A}${C}${l}${f}${B}${C}`;case"**":return A+q(r);case"**/*":return`(?:${A}${q(r)}${l})?${B}${f}${C}`;case"**/*.*":return`(?:${A}${q(r)}${l})?${B}${C}${i}${f}${C}`;case"**/.*":return`(?:${A}${q(r)}${l})?${i}${f}${C}`;default:{let _=/^(.*?)\.(\w+)$/.exec(y);if(!_)return;let k=L(_[1]);return k?k+i+_[2]:void 0}}},X=W.removePrefix(e,G),N=L(X);return N&&r.strictSlashes!==!0&&(N+=`${l}?`),N};ar.exports=at});var lr=O((ua,ur)=>{"use strict";var os=require("path"),ss=sr(),ct=cr(),ut=Ce(),is=le(),as=e=>e&&typeof e=="object"&&!Array.isArray(e),I=(e,t,r=!1)=>{if(Array.isArray(e)){let m=e.map(S=>I(S,t,r));return S=>{for(let R of m){let g=R(S);if(g)return g}return!1}}let n=as(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");let o=t||{},s=ut.isWindows(t),i=n?I.compileRe(e,t):I.makeRe(e,t,!1,!0),l=i.state;delete i.state;let f=()=>!1;if(o.ignore){let m={...t,ignore:null,onMatch:null,onResult:null};f=I(o.ignore,m,r)}let h=(m,E=!1)=>{let{isMatch:S,match:R,output:g}=I.test(m,i,t,{glob:e,posix:s}),A={glob:e,state:l,regex:i,posix:s,input:m,output:g,match:R,isMatch:S};return typeof o.onResult=="function"&&o.onResult(A),S===!1?(A.isMatch=!1,E?A:!1):f(m)?(typeof o.onIgnore=="function"&&o.onIgnore(A),A.isMatch=!1,E?A:!1):(typeof o.onMatch=="function"&&o.onMatch(A),E?A:!0)};return r&&(h.state=l),h};I.test=(e,t,r,{glob:n,posix:o}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};let s=r||{},i=s.format||(o?ut.toPosixSlashes:null),l=e===n,f=l&&i?i(e):e;return l===!1&&(f=i?i(e):e,l=f===n),(l===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?l=I.matchBase(e,t,r,o):l=t.exec(f)),{isMatch:!!l,match:l,output:f}};I.matchBase=(e,t,r,n=ut.isWindows(r))=>(t instanceof RegExp?t:I.makeRe(t,r)).test(os.basename(e));I.isMatch=(e,t,r)=>I(t,r)(e);I.parse=(e,t)=>Array.isArray(e)?e.map(r=>I.parse(r,t)):ct(e,{...t,fastpaths:!1});I.scan=(e,t)=>ss(e,t);I.compileRe=(e,t,r=!1,n=!1)=>{if(r===!0)return e.output;let o=t||{},s=o.contains?"":"^",i=o.contains?"":"$",l=`${s}(?:${e.output})${i}`;e&&e.negated===!0&&(l=`^(?!${l}).*$`);let f=I.toRegex(l,t);return n===!0&&(f.state=e),f};I.makeRe=(e,t={},r=!1,n=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(o.output=ct.fastpaths(e,t)),o.output||(o=ct(e,t)),I.compileRe(o,t,r,n)};I.toRegex=(e,t)=>{try{let r=t||{};return new RegExp(e,r.flags||(r.nocase?"i":""))}catch(r){if(t&&t.debug===!0)throw r;return/$^/}};I.constants=is;ur.exports=I});var fr=O((la,pr)=>{"use strict";pr.exports=lr()});var Er=O((pa,xr)=>{"use strict";var de=require("fs"),{Readable:cs}=require("stream"),fe=require("path"),{promisify:Ie}=require("util"),lt=fr(),us=Ie(de.readdir),ls=Ie(de.stat),dr=Ie(de.lstat),ps=Ie(de.realpath),fs="!",gr="READDIRP_RECURSIVE_ERROR",ds=new Set(["ENOENT","EPERM","EACCES","ELOOP",gr]),pt="files",br="directories",Pe="files_directories",ve="all",mr=[pt,br,Pe,ve],ms=e=>ds.has(e.code),[hr,hs]=process.versions.node.split(".").slice(0,2).map(e=>Number.parseInt(e,10)),ys=process.platform==="win32"&&(hr>10||hr===10&&hs>=5),yr=e=>{if(e!==void 0){if(typeof e=="function")return e;if(typeof e=="string"){let t=lt(e.trim());return r=>t(r.basename)}if(Array.isArray(e)){let t=[],r=[];for(let n of e){let o=n.trim();o.charAt(0)===fs?r.push(lt(o.slice(1))):t.push(lt(o))}return r.length>0?t.length>0?n=>t.some(o=>o(n.basename))&&!r.some(o=>o(n.basename)):n=>!r.some(o=>o(n.basename)):n=>t.some(o=>o(n.basename))}}},Oe=class e extends cs{static get defaultOptions(){return{root:".",fileFilter:t=>!0,directoryFilter:t=>!0,type:pt,lstat:!1,depth:2147483648,alwaysStat:!1}}constructor(t={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:t.highWaterMark||4096});let r={...e.defaultOptions,...t},{root:n,type:o}=r;this._fileFilter=yr(r.fileFilter),this._directoryFilter=yr(r.directoryFilter);let s=r.lstat?dr:ls;ys?this._stat=i=>s(i,{bigint:!0}):this._stat=s,this._maxDepth=r.depth,this._wantsDir=[br,Pe,ve].includes(o),this._wantsFile=[pt,Pe,ve].includes(o),this._wantsEverything=o===ve,this._root=fe.resolve(n),this._isDirent="Dirent"in de&&!r.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(n,1)],this.reading=!1,this.parent=void 0}async _read(t){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&t>0;){let{path:r,depth:n,files:o=[]}=this.parent||{};if(o.length>0){let s=o.splice(0,t).map(i=>this._formatEntry(i,r));for(let i of await Promise.all(s)){if(this.destroyed)return;let l=await this._getEntryType(i);l==="directory"&&this._directoryFilter(i)?(n<=this._maxDepth&&this.parents.push(this._exploreDir(i.fullPath,n+1)),this._wantsDir&&(this.push(i),t--)):(l==="file"||this._includeAsFile(i))&&this._fileFilter(i)&&this._wantsFile&&(this.push(i),t--)}}else{let s=this.parents.pop();if(!s){this.push(null);break}if(this.parent=await s,this.destroyed)return}}}catch(r){this.destroy(r)}finally{this.reading=!1}}}async _exploreDir(t,r){let n;try{n=await us(t,this._rdOptions)}catch(o){this._onError(o)}return{files:n,depth:r,path:t}}async _formatEntry(t,r){let n;try{let o=this._isDirent?t.name:t,s=fe.resolve(fe.join(r,o));n={path:fe.relative(this._root,s),fullPath:s,basename:o},n[this._statsProp]=this._isDirent?t:await this._stat(s)}catch(o){this._onError(o)}return n}_onError(t){ms(t)&&!this.destroyed?this.emit("warn",t):this.destroy(t)}async _getEntryType(t){let r=t&&t[this._statsProp];if(r){if(r.isFile())return"file";if(r.isDirectory())return"directory";if(r&&r.isSymbolicLink()){let n=t.fullPath;try{let o=await ps(n),s=await dr(o);if(s.isFile())return"file";if(s.isDirectory()){let i=o.length;if(n.startsWith(o)&&n.substr(i,1)===fe.sep){let l=new Error(`Circular symlink detected: "${n}" points to "${o}"`);return l.code=gr,this._onError(l)}return"directory"}}catch(o){this._onError(o)}}}}_includeAsFile(t){let r=t&&t[this._statsProp];return r&&this._wantsEverything&&!r.isDirectory()}},ne=(e,t={})=>{let r=t.entryType||t.type;if(r==="both"&&(r=Pe),r&&(t.type=r),e){if(typeof e!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(r&&!mr.includes(r))throw new Error(`readdirp: Invalid type passed. Use one of ${mr.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return t.root=e,new Oe(t)},gs=(e,t={})=>new Promise((r,n)=>{let o=[];ne(e,t).on("data",s=>o.push(s)).on("end",()=>r(o)).on("error",s=>n(s))});ne.promise=gs;ne.ReaddirpStream=Oe;ne.default=ne;xr.exports=ne});var Cr=O((da,_r)=>{_r.exports=Rr;Rr.sync=Es;var Ar=require("fs");function xs(e,t){var r=t.pathExt!==void 0?t.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var o=r[n].toLowerCase();if(o&&e.substr(-o.length).toLowerCase()===o)return!0}return!1}function wr(e,t,r){return!e.isSymbolicLink()&&!e.isFile()?!1:xs(t,r)}function Rr(e,t,r){Ar.stat(e,function(n,o){r(n,n?!1:wr(o,e,t))})}function Es(e,t){return wr(Ar.statSync(e),e,t)}});var Or=O((ma,Pr)=>{Pr.exports=$r;$r.sync=Ss;var Tr=require("fs");function $r(e,t,r){Tr.stat(e,function(n,o){r(n,n?!1:vr(o,t))})}function Ss(e,t){return vr(Tr.statSync(e),t)}function vr(e,t){return e.isFile()&&As(e,t)}function As(e,t){var r=e.mode,n=e.uid,o=e.gid,s=t.uid!==void 0?t.uid:process.getuid&&process.getuid(),i=t.gid!==void 0?t.gid:process.getgid&&process.getgid(),l=parseInt("100",8),f=parseInt("010",8),h=parseInt("001",8),m=l|f,E=r&h||r&f&&o===i||r&l&&n===s||r&m&&s===0;return E}});var Lr=O((ya,Ir)=>{var ha=require("fs"),Le;process.platform==="win32"||global.TESTING_WINDOWS?Le=Cr():Le=Or();Ir.exports=ft;ft.sync=ws;function ft(e,t,r){if(typeof t=="function"&&(r=t,t={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,o){ft(e,t||{},function(s,i){s?o(s):n(i)})})}Le(e,t||{},function(n,o){n&&(n.code==="EACCES"||t&&t.ignoreErrors)&&(n=null,o=!1),r(n,o)})}function ws(e,t){try{return Le.sync(e,t||{})}catch(r){if(t&&t.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var Mr=O((ga,Dr)=>{var oe=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",Hr=require("path"),Rs=oe?";":":",Nr=Lr(),kr=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),Gr=(e,t)=>{let r=t.colon||Rs,n=e.match(/\//)||oe&&e.match(/\\/)?[""]:[...oe?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(r)],o=oe?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",s=oe?o.split(r):[""];return oe&&e.indexOf(".")!==-1&&s[0]!==""&&s.unshift(""),{pathEnv:n,pathExt:s,pathExtExe:o}},Br=(e,t,r)=>{typeof t=="function"&&(r=t,t={}),t||(t={});let{pathEnv:n,pathExt:o,pathExtExe:s}=Gr(e,t),i=[],l=h=>new Promise((m,E)=>{if(h===n.length)return t.all&&i.length?m(i):E(kr(e));let S=n[h],R=/^".*"$/.test(S)?S.slice(1,-1):S,g=Hr.join(R,e),A=!R&&/^\.[\\\/]/.test(e)?e.slice(0,2)+g:g;m(f(A,h,0))}),f=(h,m,E)=>new Promise((S,R)=>{if(E===o.length)return S(l(m+1));let g=o[E];Nr(h+g,{pathExt:s},(A,B)=>{if(!A&&B)if(t.all)i.push(h+g);else return S(h+g);return S(f(h,m,E+1))})});return r?l(0).then(h=>r(null,h),r):l(0)},_s=(e,t)=>{t=t||{};let{pathEnv:r,pathExt:n,pathExtExe:o}=Gr(e,t),s=[];for(let i=0;i<r.length;i++){let l=r[i],f=/^".*"$/.test(l)?l.slice(1,-1):l,h=Hr.join(f,e),m=!f&&/^\.[\\\/]/.test(e)?e.slice(0,2)+h:h;for(let E=0;E<n.length;E++){let S=m+n[E];try{if(Nr.sync(S,{pathExt:o}))if(t.all)s.push(S);else return S}catch{}}}if(t.all&&s.length)return s;if(t.nothrow)return null;throw kr(e)};Dr.exports=Br;Br.sync=_s});var Fr=O((ba,dt)=>{"use strict";var jr=(e={})=>{let t=e.env||process.env;return(e.platform||process.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};dt.exports=jr;dt.exports.default=jr});var Wr=O((xa,Kr)=>{"use strict";var Ur=require("path"),Cs=Mr(),Ts=Fr();function qr(e,t){let r=e.options.env||process.env,n=process.cwd(),o=e.options.cwd!=null,s=o&&process.chdir!==void 0&&!process.chdir.disabled;if(s)try{process.chdir(e.options.cwd)}catch{}let i;try{i=Cs.sync(e.command,{path:r[Ts({env:r})],pathExt:t?Ur.delimiter:void 0})}catch{}finally{s&&process.chdir(n)}return i&&(i=Ur.resolve(o?e.options.cwd:"",i)),i}function $s(e){return qr(e)||qr(e,!0)}Kr.exports=$s});var Xr=O((Ea,ht)=>{"use strict";var mt=/([()\][%!^"`<>&|;, *?])/g;function vs(e){return e=e.replace(mt,"^$1"),e}function Ps(e,t){return e=`${e}`,e=e.replace(/(\\*)"/g,'$1$1\\"'),e=e.replace(/(\\*)$/,"$1$1"),e=`"${e}"`,e=e.replace(mt,"^$1"),t&&(e=e.replace(mt,"^$1")),e}ht.exports.command=vs;ht.exports.argument=Ps});var Vr=O((Sa,zr)=>{"use strict";zr.exports=/^#!(.*)/});var Yr=O((Aa,Qr)=>{"use strict";var Os=Vr();Qr.exports=(e="")=>{let t=e.match(Os);if(!t)return null;let[r,n]=t[0].replace(/#! ?/,"").split(" "),o=r.split("/").pop();return o==="env"?n:n?`${o} ${n}`:o}});var Jr=O((wa,Zr)=>{"use strict";var yt=require("fs"),Is=Yr();function Ls(e){let r=Buffer.alloc(150),n;try{n=yt.openSync(e,"r"),yt.readSync(n,r,0,150,0),yt.closeSync(n)}catch{}return Is(r.toString())}Zr.exports=Ls});var nn=O((Ra,rn)=>{"use strict";var Hs=require("path"),en=Wr(),tn=Xr(),Ns=Jr(),ks=process.platform==="win32",Gs=/\.(?:com|exe)$/i,Bs=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Ds(e){e.file=en(e);let t=e.file&&Ns(e.file);return t?(e.args.unshift(e.file),e.command=t,en(e)):e.file}function Ms(e){if(!ks)return e;let t=Ds(e),r=!Gs.test(t);if(e.options.forceShell||r){let n=Bs.test(t);e.command=Hs.normalize(e.command),e.command=tn.command(e.command),e.args=e.args.map(s=>tn.argument(s,n));let o=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${o}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}function js(e,t,r){t&&!Array.isArray(t)&&(r=t,t=null),t=t?t.slice(0):[],r=Object.assign({},r);let n={command:e,args:t,options:r,file:void 0,original:{command:e,args:t}};return r.shell?n:Ms(n)}rn.exports=js});var an=O((_a,sn)=>{"use strict";var gt=process.platform==="win32";function bt(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function Fs(e,t){if(!gt)return;let r=e.emit;e.emit=function(n,o){if(n==="exit"){let s=on(o,t,"spawn");if(s)return r.call(e,"error",s)}return r.apply(e,arguments)}}function on(e,t){return gt&&e===1&&!t.file?bt(t.original,"spawn"):null}function Us(e,t){return gt&&e===1&&!t.file?bt(t.original,"spawnSync"):null}sn.exports={hookChildProcess:Fs,verifyENOENT:on,verifyENOENTSync:Us,notFoundError:bt}});var ln=O((Ca,se)=>{"use strict";var cn=require("child_process"),xt=nn(),Et=an();function un(e,t,r){let n=xt(e,t,r),o=cn.spawn(n.command,n.args,n.options);return Et.hookChildProcess(o,n),o}function qs(e,t,r){let n=xt(e,t,r),o=cn.spawnSync(n.command,n.args,n.options);return o.error=o.error||Et.verifyENOENTSync(o.status,n),o}se.exports=un;se.exports.spawn=un;se.exports.sync=qs;se.exports._parse=xt;se.exports._enoent=Et});var Un=O((Sc,Fn)=>{"use strict";var{PassThrough:ki}=require("stream");Fn.exports=function(){var e=[],t=new ki({objectMode:!0});return t.setMaxListeners(0),t.add=r,t.isEmpty=n,t.on("unpipe",o),Array.prototype.slice.call(arguments).forEach(r),t;function r(s){return Array.isArray(s)?(s.forEach(r),this):(e.push(s),s.once("end",o.bind(null,s)),s.once("error",t.emit.bind(t,"error")),s.pipe(t,{end:!1}),this)}function n(){return e.length==0}function o(s){e=e.filter(function(i){return i!==s}),!e.length&&t.readable&&t.end()}}});var Ze=F(require("node:console"),1),ue=require("node:fs/promises"),te=require("node:path"),bo=F(require("node:process"),1),xo=require("node:util"),Eo=F(Er(),1);var Sr={bugs:"https://github.com/cedx/php-minifier/issues",description:"Minify PHP source code by removing comments and whitespace.",homepage:"https://docs.belin.io/php-minifier",license:"MIT",name:"@cedx/php-minifier",repository:"cedx/php-minifier",type:"module",version:"2.0.0",author:{email:"cedric@belin.io",name:"C\xE9dric Belin",url:"https://belin.io"},bin:{php_minifier:"./bin/php_minifier.cjs"},dependencies:{execa:"^8.0.1","fancy-log":"^2.0.0","get-port":"^7.0.0","plugin-error":"^2.0.1",readdirp:"^3.6.0"},devDependencies:{"@types/eslint__js":"^8.42.3","@types/fancy-log":"^2.0.2","@types/gulp":"^4.0.17","@types/node":"^20.11.28","@types/vinyl":"^2.0.11",del:"^7.1.0",esbuild:"^0.20.2",eslint:"^8.57.0",typedoc:"^0.25.12",typescript:"^5.4.2","typescript-eslint":"^7.2.0",vinyl:"^3.0.0"},engines:{node:">=20.0.0"},exports:{types:"./lib/index.d.ts",import:"./lib/index.js"},files:["lib/","src/","www/"],keywords:["compress","gulp","gulpplugin","minify","php"],optionalDependencies:{gulp:">=4.0.0"},scripts:{build:'tsc --project src && esbuild "--banner:js=#!/usr/bin/env node" --bundle --legal-comments=none --log-override:empty-import-meta=debug --minify --outfile=bin/php_minifier.cjs --platform=node src/cli.ts',clean:"node tool/clean.js",dist:"npm run clean && npm run build && git update-index --chmod=+x bin/php_minifier.cjs",doc:"typedoc --options etc/typedoc.js && node tool/doc.js",lint:"npm run build && tsc --project . && eslint --config=etc/eslint.config.js etc src test tool",prepack:"npm run dist",release:"node tool/publish.js",start:"npm run build && node bin/php_minifier.cjs --help",test:"npm run build && node --test --test-reporter=spec",watch:"esbuild --bundle --legal-comments=none --log-override:empty-import-meta=debug --outfile=bin/php_minifier.cjs --platform=node --watch src/cli.ts"}};var ce=require("node:path"),go=require("node:url");var ao=require("node:buffer"),co=F(require("node:path"),1),Xe=F(require("node:child_process"),1),ge=F(require("node:process"),1),uo=F(ln(),1);function St(e){let t=typeof e=="string"?`
`:10,r=typeof e=="string"?"\r":13;return e[e.length-1]===t&&(e=e.slice(0,-1)),e[e.length-1]===r&&(e=e.slice(0,-1)),e}var me=F(require("node:process"),1),ie=F(require("node:path"),1),At=require("node:url");function He(e={}){let{env:t=process.env,platform:r=process.platform}=e;return r!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"}var Ks=({cwd:e=me.default.cwd(),path:t=me.default.env[He()],preferLocal:r=!0,execPath:n=me.default.execPath,addExecPath:o=!0}={})=>{let s=e instanceof URL?(0,At.fileURLToPath)(e):e,i=ie.default.resolve(s),l=[];return r&&Ws(l,i),o&&Xs(l,n,i),[...l,t].join(ie.default.delimiter)},Ws=(e,t)=>{let r;for(;r!==t;)e.push(ie.default.join(t,"node_modules/.bin")),r=t,t=ie.default.resolve(t,"..")},Xs=(e,t,r)=>{let n=t instanceof URL?(0,At.fileURLToPath)(t):t;e.push(ie.default.resolve(r,n,".."))},pn=({env:e=me.default.env,...t}={})=>{e={...e};let r=He({env:e});return t.path=e[r],e[r]=Ks(t),e};var zs=(e,t,r,n)=>{if(r==="length"||r==="prototype"||r==="arguments"||r==="caller")return;let o=Object.getOwnPropertyDescriptor(e,r),s=Object.getOwnPropertyDescriptor(t,r);!Vs(o,s)&&n||Object.defineProperty(e,r,s)},Vs=function(e,t){return e===void 0||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},Qs=(e,t)=>{let r=Object.getPrototypeOf(t);r!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,r)},Ys=(e,t)=>`/* Wrapped ${e}*/
${t}`,Zs=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),Js=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),ei=(e,t,r)=>{let n=r===""?"":`with ${r.trim()}() `,o=Ys.bind(null,n,t.toString());Object.defineProperty(o,"name",Js),Object.defineProperty(e,"toString",{...Zs,value:o})};function wt(e,t,{ignoreNonConfigurable:r=!1}={}){let{name:n}=e;for(let o of Reflect.ownKeys(t))zs(e,t,o,r);return Qs(e,t),ei(e,t,n),e}var Ne=new WeakMap,fn=(e,t={})=>{if(typeof e!="function")throw new TypeError("Expected a function");let r,n=0,o=e.displayName||e.name||"<anonymous>",s=function(...i){if(Ne.set(s,++n),n===1)r=e.apply(this,i),e=null;else if(t.throw===!0)throw new Error(`Function \`${o}\` can only be called once`);return r};return wt(s,e),Ne.set(s,n),s};fn.callCount=e=>{if(!Ne.has(e))throw new Error(`The given function \`${e.name}\` is not wrapped by the \`onetime\` package`);return Ne.get(e)};var dn=fn;var Sn=F(require("node:process"),1);var xn=require("node:os");var mn=()=>{let e=yn-hn+1;return Array.from({length:e},ti)},ti=(e,t)=>({name:`SIGRT${t+1}`,number:hn+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}),hn=34,yn=64;var bn=require("node:os");var gn=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];var Rt=()=>{let e=mn();return[...gn,...e].map(ri)},ri=({name:e,number:t,description:r,action:n,forced:o=!1,standard:s})=>{let{signals:{[e]:i}}=bn.constants,l=i!==void 0;return{name:e,number:l?i:t,description:r,supported:l,action:n,forced:o,standard:s}};var ni=()=>{let e=Rt();return Object.fromEntries(e.map(oi))},oi=({name:e,number:t,description:r,supported:n,action:o,forced:s,standard:i})=>[e,{name:e,number:t,description:r,supported:n,action:o,forced:s,standard:i}],En=ni(),si=()=>{let e=Rt(),t=65,r=Array.from({length:t},(n,o)=>ii(o,e));return Object.assign({},...r)},ii=(e,t)=>{let r=ai(e,t);if(r===void 0)return{};let{name:n,description:o,supported:s,action:i,forced:l,standard:f}=r;return{[e]:{name:n,number:e,description:o,supported:s,action:i,forced:l,standard:f}}},ai=(e,t)=>{let r=t.find(({name:n})=>xn.constants.signals[n]===e);return r!==void 0?r:t.find(n=>n.number===e)},Ma=si();var ci=({timedOut:e,timeout:t,errorCode:r,signal:n,signalDescription:o,exitCode:s,isCanceled:i})=>e?`timed out after ${t} milliseconds`:i?"was canceled":r!==void 0?`failed with ${r}`:n!==void 0?`was killed with ${n} (${o})`:s!==void 0?`failed with exit code ${s}`:"failed",he=({stdout:e,stderr:t,all:r,error:n,signal:o,exitCode:s,command:i,escapedCommand:l,timedOut:f,isCanceled:h,killed:m,parsed:{options:{timeout:E,cwd:S=Sn.default.cwd()}}})=>{s=s===null?void 0:s,o=o===null?void 0:o;let R=o===void 0?void 0:En[o].description,g=n&&n.code,B=`Command ${ci({timedOut:f,timeout:E,errorCode:g,signal:o,signalDescription:R,exitCode:s,isCanceled:h})}: ${i}`,D=Object.prototype.toString.call(n)==="[object Error]",G=D?`${B}
${n.message}`:B,C=[G,t,e].filter(Boolean).join(`
`);return D?(n.originalMessage=n.message,n.message=C):n=new Error(C),n.shortMessage=G,n.command=i,n.escapedCommand=l,n.exitCode=s,n.signal=o,n.signalDescription=R,n.stdout=e,n.stderr=t,n.cwd=S,r!==void 0&&(n.all=r),"bufferedData"in n&&delete n.bufferedData,n.failed=!0,n.timedOut=!!f,n.isCanceled=h,n.killed=m&&!f,n};var ke=["stdin","stdout","stderr"],ui=e=>ke.some(t=>e[t]!==void 0),An=e=>{if(!e)return;let{stdio:t}=e;if(t===void 0)return ke.map(n=>e[n]);if(ui(e))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${ke.map(n=>`\`${n}\``).join(", ")}`);if(typeof t=="string")return t;if(!Array.isArray(t))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof t}\``);let r=Math.max(t.length,ke.length);return Array.from({length:r},(n,o)=>t[o])};var Rn=F(require("node:os"),1);var ee=[];ee.push("SIGHUP","SIGINT","SIGTERM");process.platform!=="win32"&&ee.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");process.platform==="linux"&&ee.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");var Ge=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",_t=Symbol.for("signal-exit emitter"),Ct=globalThis,li=Object.defineProperty.bind(Object),Tt=class{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(Ct[_t])return Ct[_t];li(Ct,_t,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,r){this.listeners[t].push(r)}removeListener(t,r){let n=this.listeners[t],o=n.indexOf(r);o!==-1&&(o===0&&n.length===1?n.length=0:n.splice(o,1))}emit(t,r,n){if(this.emitted[t])return!1;this.emitted[t]=!0;let o=!1;for(let s of this.listeners[t])o=s(r,n)===!0||o;return t==="exit"&&(o=this.emit("afterExit",r,n)||o),o}},Be=class{},pi=e=>({onExit(t,r){return e.onExit(t,r)},load(){return e.load()},unload(){return e.unload()}}),$t=class extends Be{onExit(){return()=>{}}load(){}unload(){}},vt=class extends Be{#n=Pt.platform==="win32"?"SIGINT":"SIGHUP";#t=new Tt;#e;#r;#i;#s={};#o=!1;constructor(t){super(),this.#e=t,this.#s={};for(let r of ee)this.#s[r]=()=>{let n=this.#e.listeners(r),{count:o}=this.#t,s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(o+=s.__signal_exit_emitter__.count),n.length===o){this.unload();let i=this.#t.emit("exit",null,r),l=r==="SIGHUP"?this.#n:r;i||t.kill(t.pid,l)}};this.#i=t.reallyExit,this.#r=t.emit}onExit(t,r){if(!Ge(this.#e))return()=>{};this.#o===!1&&this.load();let n=r?.alwaysLast?"afterExit":"exit";return this.#t.on(n,t),()=>{this.#t.removeListener(n,t),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#o){this.#o=!0,this.#t.count+=1;for(let t of ee)try{let r=this.#s[t];r&&this.#e.on(t,r)}catch{}this.#e.emit=(t,...r)=>this.#c(t,...r),this.#e.reallyExit=t=>this.#a(t)}}unload(){this.#o&&(this.#o=!1,ee.forEach(t=>{let r=this.#s[t];if(!r)throw new Error("Listener not defined for signal: "+t);try{this.#e.removeListener(t,r)}catch{}}),this.#e.emit=this.#r,this.#e.reallyExit=this.#i,this.#t.count-=1)}#a(t){return Ge(this.#e)?(this.#e.exitCode=t||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#c(t,...r){let n=this.#r;if(t==="exit"&&Ge(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let o=n.call(this.#e,t,...r);return this.#t.emit("exit",this.#e.exitCode,null),o}else return n.call(this.#e,t,...r)}},Pt=globalThis.process,{onExit:wn,load:Xa,unload:za}=pi(Ge(Pt)?new vt(Pt):new $t);var fi=1e3*5,_n=(e,t="SIGTERM",r={})=>{let n=e(t);return di(e,t,r,n),n},di=(e,t,r,n)=>{if(!mi(t,r,n))return;let o=yi(r),s=setTimeout(()=>{e("SIGKILL")},o);s.unref&&s.unref()},mi=(e,{forceKillAfterTimeout:t},r)=>hi(e)&&t!==!1&&r,hi=e=>e===Rn.default.constants.signals.SIGTERM||typeof e=="string"&&e.toUpperCase()==="SIGTERM",yi=({forceKillAfterTimeout:e=!0})=>{if(e===!0)return fi;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},Cn=(e,t)=>{e.kill()&&(t.isCanceled=!0)},gi=(e,t,r)=>{e.kill(t),r(Object.assign(new Error("Timed out"),{timedOut:!0,signal:t}))},Tn=(e,{timeout:t,killSignal:r="SIGTERM"},n)=>{if(t===0||t===void 0)return n;let o,s=new Promise((l,f)=>{o=setTimeout(()=>{gi(e,r,f)},t)}),i=n.finally(()=>{clearTimeout(o)});return Promise.race([s,i])},$n=({timeout:e})=>{if(e!==void 0&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)},vn=async(e,{cleanup:t,detached:r},n)=>{if(!t||r)return n;let o=wn(()=>{e.kill()});return n.finally(()=>{o()})};var Pn=require("node:fs"),On=require("node:child_process");function De(e){return e!==null&&typeof e=="object"&&typeof e.pipe=="function"}function Ot(e){return De(e)&&e.writable!==!1&&typeof e._write=="function"&&typeof e._writableState=="object"}var bi=e=>e instanceof On.ChildProcess&&typeof e.then=="function",It=(e,t,r)=>{if(typeof r=="string")return e[t].pipe((0,Pn.createWriteStream)(r)),e;if(Ot(r))return e[t].pipe(r),e;if(!bi(r))throw new TypeError("The second argument must be a string, a stream or an Execa child process.");if(!Ot(r.stdin))throw new TypeError("The target child process's stdin must be available.");return e[t].pipe(r.stdin),r},In=e=>{e.stdout!==null&&(e.pipeStdout=It.bind(void 0,e,"stdout")),e.stderr!==null&&(e.pipeStderr=It.bind(void 0,e,"stderr")),e.all!==void 0&&(e.pipeAll=It.bind(void 0,e,"all"))};var Ke=require("node:fs"),qn=require("node:timers/promises");var ye=async(e,{init:t,convertChunk:r,getSize:n,truncateChunk:o,addChunk:s,getFinalChunk:i,finalize:l},{maxBuffer:f=Number.POSITIVE_INFINITY}={})=>{if(!Ei(e))throw new Error("The first argument must be a Readable, a ReadableStream, or an async iterable.");let h=t();h.length=0;try{for await(let m of e){let E=Si(m),S=r[E](m,h);Nn({convertedChunk:S,state:h,getSize:n,truncateChunk:o,addChunk:s,maxBuffer:f})}return xi({state:h,convertChunk:r,getSize:n,truncateChunk:o,addChunk:s,getFinalChunk:i,maxBuffer:f}),l(h)}catch(m){throw m.bufferedData=l(h),m}},xi=({state:e,getSize:t,truncateChunk:r,addChunk:n,getFinalChunk:o,maxBuffer:s})=>{let i=o(e);i!==void 0&&Nn({convertedChunk:i,state:e,getSize:t,truncateChunk:r,addChunk:n,maxBuffer:s})},Nn=({convertedChunk:e,state:t,getSize:r,truncateChunk:n,addChunk:o,maxBuffer:s})=>{let i=r(e),l=t.length+i;if(l<=s){Ln(e,t,o,l);return}let f=n(e,s-t.length);throw f!==void 0&&Ln(f,t,o,s),new Me},Ln=(e,t,r,n)=>{t.contents=r(e,t,n),t.length=n},Ei=e=>typeof e=="object"&&e!==null&&typeof e[Symbol.asyncIterator]=="function",Si=e=>{let t=typeof e;if(t==="string")return"string";if(t!=="object"||e===null)return"others";if(globalThis.Buffer?.isBuffer(e))return"buffer";let r=Hn.call(e);return r==="[object ArrayBuffer]"?"arrayBuffer":r==="[object DataView]"?"dataView":Number.isInteger(e.byteLength)&&Number.isInteger(e.byteOffset)&&Hn.call(e.buffer)==="[object ArrayBuffer]"?"typedArray":"others"},{toString:Hn}=Object.prototype,Me=class extends Error{name="MaxBufferError";constructor(){super("maxBuffer exceeded")}};var Lt=e=>e,Ht=()=>{},Nt=({contents:e})=>e,je=e=>{throw new Error(`Streams in object mode are not supported: ${String(e)}`)},Fe=e=>e.length;async function kt(e,t){return ye(e,Pi,t)}var Ai=()=>({contents:new ArrayBuffer(0)}),wi=e=>Ri.encode(e),Ri=new TextEncoder,kn=e=>new Uint8Array(e),Gn=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),_i=(e,t)=>e.slice(0,t),Ci=(e,{contents:t,length:r},n)=>{let o=Mn()?$i(t,n):Ti(t,n);return new Uint8Array(o).set(e,r),o},Ti=(e,t)=>{if(t<=e.byteLength)return e;let r=new ArrayBuffer(Dn(t));return new Uint8Array(r).set(new Uint8Array(e),0),r},$i=(e,t)=>{if(t<=e.maxByteLength)return e.resize(t),e;let r=new ArrayBuffer(t,{maxByteLength:Dn(t)});return new Uint8Array(r).set(new Uint8Array(e),0),r},Dn=e=>Bn**Math.ceil(Math.log(e)/Math.log(Bn)),Bn=2,vi=({contents:e,length:t})=>Mn()?e:e.slice(0,t),Mn=()=>"resize"in ArrayBuffer.prototype,Pi={init:Ai,convertChunk:{string:wi,buffer:kn,arrayBuffer:kn,dataView:Gn,typedArray:Gn,others:je},getSize:Fe,truncateChunk:_i,addChunk:Ci,getFinalChunk:Ht,finalize:vi};async function Ue(e,t){if(!("Buffer"in globalThis))throw new Error("getStreamAsBuffer() is only supported in Node.js");try{return jn(await kt(e,t))}catch(r){throw r.bufferedData!==void 0&&(r.bufferedData=jn(r.bufferedData)),r}}var jn=e=>globalThis.Buffer.from(e);async function Gt(e,t){return ye(e,Ni,t)}var Oi=()=>({contents:"",textDecoder:new TextDecoder}),qe=(e,{textDecoder:t})=>t.decode(e,{stream:!0}),Ii=(e,{contents:t})=>t+e,Li=(e,t)=>e.slice(0,t),Hi=({textDecoder:e})=>{let t=e.decode();return t===""?void 0:t},Ni={init:Oi,convertChunk:{string:Lt,buffer:qe,arrayBuffer:qe,dataView:qe,typedArray:qe,others:je},getSize:Fe,truncateChunk:Li,addChunk:Ii,getFinalChunk:Hi,finalize:Nt};var Kn=F(Un(),1),Wn=e=>{if(e!==void 0)throw new TypeError("The `input` and `inputFile` options cannot be both set.")},Gi=({input:e,inputFile:t})=>typeof t!="string"?e:(Wn(e),(0,Ke.readFileSync)(t)),Xn=e=>{let t=Gi(e);if(De(t))throw new TypeError("The `input` option cannot be a stream in sync mode");return t},Bi=({input:e,inputFile:t})=>typeof t!="string"?e:(Wn(e),(0,Ke.createReadStream)(t)),zn=(e,t)=>{let r=Bi(t);r!==void 0&&(De(r)?r.pipe(e.stdin):e.stdin.end(r))},Vn=(e,{all:t})=>{if(!t||!e.stdout&&!e.stderr)return;let r=(0,Kn.default)();return e.stdout&&r.add(e.stdout),e.stderr&&r.add(e.stderr),r},Bt=async(e,t)=>{if(!(!e||t===void 0)){await(0,qn.setTimeout)(0),e.destroy();try{return await t}catch(r){return r.bufferedData}}},Dt=(e,{encoding:t,buffer:r,maxBuffer:n})=>{if(!(!e||!r))return t==="utf8"||t==="utf-8"?Gt(e,{maxBuffer:n}):t===null||t==="buffer"?Ue(e,{maxBuffer:n}):Di(e,n,t)},Di=async(e,t,r)=>(await Ue(e,{maxBuffer:t})).toString(r),Qn=async({stdout:e,stderr:t,all:r},{encoding:n,buffer:o,maxBuffer:s},i)=>{let l=Dt(e,{encoding:n,buffer:o,maxBuffer:s}),f=Dt(t,{encoding:n,buffer:o,maxBuffer:s}),h=Dt(r,{encoding:n,buffer:o,maxBuffer:s*2});try{return await Promise.all([i,l,f,h])}catch(m){return Promise.all([{error:m,signal:m.signal,timedOut:m.timedOut},Bt(e,l),Bt(t,f),Bt(r,h)])}};var Mi=(async()=>{})().constructor.prototype,ji=["then","catch","finally"].map(e=>[e,Reflect.getOwnPropertyDescriptor(Mi,e)]),Mt=(e,t)=>{for(let[r,n]of ji){let o=typeof t=="function"?(...s)=>Reflect.apply(n.value,t(),s):n.value.bind(t);Reflect.defineProperty(e,r,{...n,value:o})}},Yn=e=>new Promise((t,r)=>{e.on("exit",(n,o)=>{t({exitCode:n,signal:o})}),e.on("error",n=>{r(n)}),e.stdin&&e.stdin.on("error",n=>{r(n)})});var eo=require("node:buffer"),to=require("node:child_process"),ro=(e,t=[])=>Array.isArray(t)?[e,...t]:[e],Fi=/^[\w.-]+$/,Ui=e=>typeof e!="string"||Fi.test(e)?e:`"${e.replaceAll('"','\\"')}"`,jt=(e,t)=>ro(e,t).join(" "),Ft=(e,t)=>ro(e,t).map(r=>Ui(r)).join(" "),qi=/ +/g;var Zn=e=>{let t=typeof e;if(t==="string")return e;if(t==="number")return String(e);if(t==="object"&&e!==null&&!(e instanceof to.ChildProcess)&&"stdout"in e){let r=typeof e.stdout;if(r==="string")return e.stdout;if(eo.Buffer.isBuffer(e.stdout))return e.stdout.toString();throw new TypeError(`Unexpected "${r}" stdout in template expression`)}throw new TypeError(`Unexpected "${t}" in template expression`)},Jn=(e,t,r)=>r||e.length===0||t.length===0?[...e,...t]:[...e.slice(0,-1),`${e.at(-1)}${t[0]}`,...t.slice(1)],Ki=({templates:e,expressions:t,tokens:r,index:n,template:o})=>{let s=o??e.raw[n],i=s.split(qi).filter(Boolean),l=Jn(r,i,s.startsWith(" "));if(n===t.length)return l;let f=t[n],h=Array.isArray(f)?f.map(m=>Zn(m)):[Zn(f)];return Jn(l,h,s.endsWith(" "))},Ut=(e,t)=>{let r=[];for(let[n,o]of e.entries())r=Ki({templates:e,expressions:t,tokens:r,index:n,template:o});return r};var no=require("node:util"),oo=F(require("node:process"),1),so=(0,no.debuglog)("execa").enabled,We=(e,t)=>String(e).padStart(t,"0"),Wi=()=>{let e=new Date;return`${We(e.getHours(),2)}:${We(e.getMinutes(),2)}:${We(e.getSeconds(),2)}.${We(e.getMilliseconds(),3)}`},qt=(e,{verbose:t})=>{t&&oo.default.stderr.write(`[${Wi()}] ${e}
`)};var Xi=1e3*1e3*100,zi=({env:e,extendEnv:t,preferLocal:r,localDir:n,execPath:o})=>{let s=t?{...ge.default.env,...e}:e;return r?pn({env:s,cwd:n,execPath:o}):s},lo=(e,t,r={})=>{let n=uo.default._parse(e,t,r);return e=n.command,t=n.args,r=n.options,r={maxBuffer:Xi,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:r.cwd||ge.default.cwd(),execPath:ge.default.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,verbose:so,...r},r.env=zi(r),r.stdio=An(r),ge.default.platform==="win32"&&co.default.basename(e,".exe")==="cmd"&&t.unshift("/q"),{file:e,args:t,options:r,parsed:n}},be=(e,t,r)=>typeof t!="string"&&!ao.Buffer.isBuffer(t)?r===void 0?void 0:"":e.stripFinalNewline?St(t):t;function xe(e,t,r){let n=lo(e,t,r),o=jt(e,t),s=Ft(e,t);qt(s,n.options),$n(n.options);let i;try{i=Xe.default.spawn(n.file,n.args,n.options)}catch(R){let g=new Xe.default.ChildProcess,A=Promise.reject(he({error:R,stdout:"",stderr:"",all:"",command:o,escapedCommand:s,parsed:n,timedOut:!1,isCanceled:!1,killed:!1}));return Mt(g,A),g}let l=Yn(i),f=Tn(i,n.options,l),h=vn(i,n.options,f),m={isCanceled:!1};i.kill=_n.bind(null,i.kill.bind(i)),i.cancel=Cn.bind(null,i,m);let S=dn(async()=>{let[{error:R,exitCode:g,signal:A,timedOut:B},D,G,C]=await Qn(i,n.options,h),q=be(n.options,D),L=be(n.options,G),X=be(n.options,C);if(R||g!==0||A!==null){let N=he({error:R,exitCode:g,signal:A,stdout:q,stderr:L,all:X,command:o,escapedCommand:s,parsed:n,timedOut:B,isCanceled:m.isCanceled||(n.options.signal?n.options.signal.aborted:!1),killed:i.killed});if(!n.options.reject)return N;throw N}return{command:o,escapedCommand:s,exitCode:0,stdout:q,stderr:L,all:X,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return zn(i,n.options),i.all=Vn(i,n.options),In(i),Mt(i,S),i}function Vi(e,t,r){let n=lo(e,t,r),o=jt(e,t),s=Ft(e,t);qt(s,n.options);let i=Xn(n.options),l;try{l=Xe.default.spawnSync(n.file,n.args,{...n.options,input:i})}catch(m){throw he({error:m,stdout:"",stderr:"",all:"",command:o,escapedCommand:s,parsed:n,timedOut:!1,isCanceled:!1,killed:!1})}let f=be(n.options,l.stdout,l.error),h=be(n.options,l.stderr,l.error);if(l.error||l.status!==0||l.signal!==null){let m=he({stdout:f,stderr:h,error:l.error,signal:l.signal,exitCode:l.status,command:o,escapedCommand:s,parsed:n,timedOut:l.error&&l.error.code==="ETIMEDOUT",isCanceled:!1,killed:l.signal!==null});if(!n.options.reject)return m;throw m}return{command:o,escapedCommand:s,exitCode:0,stdout:f,stderr:h,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}}var Qi=({input:e,inputFile:t,stdio:r})=>e===void 0&&t===void 0&&r===void 0?{stdin:"inherit"}:{},io=(e={})=>({preferLocal:!0,...Qi(e),...e});function po(e){function t(r,...n){if(!Array.isArray(r))return po({...e,...r});let[o,...s]=Ut(r,n);return xe(o,s,io(e))}return t.sync=(r,...n)=>{if(!Array.isArray(r))throw new TypeError("Please use $(options).sync`command` instead of $.sync(options)`command`.");let[o,...s]=Ut(r,n);return Vi(o,s,io(e))},t}var jc=po();var ho=F(require("node:net"),1),yo=F(require("node:os"),1),ze=class extends Error{constructor(t){super(`${t} is locked`)}},ae={old:new Set,young:new Set},Yi=1e3*15;var Ee,Zi=()=>{let e=yo.default.networkInterfaces(),t=new Set([void 0,"0.0.0.0"]);for(let r of Object.values(e))for(let n of r)t.add(n.address);return t},fo=e=>new Promise((t,r)=>{let n=ho.default.createServer();n.unref(),n.on("error",r),n.listen(e,()=>{let{port:o}=n.address();n.close(()=>{t(o)})})}),mo=async(e,t)=>{if(e.host||e.port===0)return fo(e);for(let r of t)try{await fo({port:e.port,host:r})}catch(n){if(!["EADDRNOTAVAIL","EINVAL"].includes(n.code))throw n}return e.port},Ji=function*(e){e&&(yield*e),yield 0};async function Kt(e){let t,r=new Set;if(e&&(e.port&&(t=typeof e.port=="number"?[e.port]:e.port),e.exclude)){let o=e.exclude;if(typeof o[Symbol.iterator]!="function")throw new TypeError("The `exclude` option must be an iterable.");for(let s of o){if(typeof s!="number")throw new TypeError("Each item in the `exclude` option must be a number corresponding to the port you want excluded.");if(!Number.isSafeInteger(s))throw new TypeError(`Number ${s} in the exclude option is not a safe integer and can't be used`)}r=new Set(o)}Ee===void 0&&(Ee=setTimeout(()=>{Ee=void 0,ae.old=ae.young,ae.young=new Set},Yi),Ee.unref&&Ee.unref());let n=Zi();for(let o of Ji(t))try{if(r.has(o))continue;let s=await mo({...e,port:o},n);for(;ae.old.has(s)||ae.young.has(s);){if(o!==0)throw new ze(o);s=await mo({...e,port:o},n)}return ae.young.add(s),s}catch(s){if(!["EADDRINUSE","EACCES"].includes(s.code)&&!(s instanceof ze))throw s}throw new Error("No available ports found")}var ea={},Ve=class e{static#n="127.0.0.1";#t;#e=-1;#r=null;constructor(t="php"){this.#t=(0,ce.normalize)(t)}close(){return this.#r?.kill(),this.#r=null,Promise.resolve()}async listen(){return this.#r?this.#e:(this.#e=await Kt(),new Promise((t,r)=>{let n=typeof module>"u"?(0,go.fileURLToPath)(new URL("../www",ea.url)):(0,ce.join)(__dirname,"../www"),o=["-S",`${e.#n}:${this.#e}`,"-t",n];this.#r=xe(this.#t,o,{stdio:["ignore","pipe","ignore"]}),this.#r.on("error",r),setTimeout(()=>t(this.#e),1e3)}))}async transform(t){let r=await this.listen(),n=new URL(`http://${e.#n}:${r}/index.php`);n.searchParams.set("file",(0,ce.resolve)(t));let o=await fetch(n);if(o.ok)return o.text();throw Error(`An error occurred while processing the script: ${t}`)}};var Ye=require("node:path");var Qe=class{#n;constructor(t="php"){this.#n=(0,Ye.normalize)(t)}close(){return Promise.resolve()}async transform(t){return(await xe(this.#n,["-w",(0,Ye.resolve)(t)])).stdout}};var ta=`
Minify PHP source code by removing comments and whitespace.

Usage:
  npx @cedx/php-minifier [options] <input> <output>

Arguments:
  input            The path to the input directory.
  output           The path to the output directory.

Options:
  -b, --binary     The path to the PHP executable.
  -e, --extension  The extension of the PHP files to process. Defaults to "php".
  -m, --mode       The operation mode of the minifier. Defaults to "safe".
  -s, --silent     Value indicating whether to silence the minifier output.
  -h, --help       Display this help.
  -v, --version    Output the version number.
`;async function ra(){let{positionals:e,values:t}=(0,xo.parseArgs)({allowPositionals:!0,options:{binary:{short:"b",type:"string",default:"php"},extension:{short:"e",type:"string",default:"php"},help:{short:"h",type:"boolean",default:!1},mode:{short:"m",type:"string",default:"safe"},silent:{short:"s",type:"boolean",default:!1},version:{short:"v",type:"boolean",default:!1}}});if(t.help||t.version)return Ze.default.log(t.version?Sr.version:ta.trim());if(!e.length)throw Error("You must provide the path to the input directory.");let r=(0,te.resolve)(e[0]);try{await(0,ue.access)(r)}catch{throw Error("The input directory was not found.")}let n=e.length>1?(0,te.resolve)(e[1]):r;await na(r,n,t)}async function na(e,t,r={}){let n=r.binary??"php",o=r.extension??"php",s=r.mode??"safe",i=r.silent??!1,l=s=="fast"?new Ve(n):new Qe(n);for await(let f of(0,Eo.default)(e,{fileFilter:`*.${o}`})){i||Ze.default.log(`Minifying: ${f.path}`);let h=await l.transform(f.fullPath),m=(0,te.join)(t,f.path);await(0,ue.mkdir)((0,te.dirname)(m),{recursive:!0}),await(0,ue.writeFile)(m,h)}return l.close()}ra().catch(e=>{Ze.default.error(e instanceof Error?e.message:e),bo.default.exitCode=1});
